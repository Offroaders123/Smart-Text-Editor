<!DOCTYPE html>
<html lang="en-US">

<head>

<title>Smart Text Editor</title>
<meta charset="UTF-8">
<meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<meta name="author" content="Brandon Bennett">
<meta name="description" content="The text editor that requires only a browser and a keyboard!">
<meta name="google-site-verification" content="_LrfHy7pIualH1TolkQ5b3Po0dtjYrx-QQsiXelwx20">
<meta property="og:title" content="Smart Text Editor">
<meta property="og:description" content="The text editor that requires only a browser and a keyboard!">
<meta property="og:image" content="resources/share-1200.png">
<meta property="og:url" content="http://offroaders123.github.io/Smart-Text-Editor/">
<meta name="twitter:card" content="summary_large_image">
<meta id="themeColor" name="theme-color" content="#191919">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Smart Text Editor">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="canonical" href="https://offroaders123.github.io/Smart-Text-Editor/">
<link rel="manifest" href="manifest.webmanifest">
<link rel="icon" type="image/svg+xml" href="resources/icon.svg">
<link rel="alternate icon" type="image/png" sizes="16x16" href="resources/icon-16.png">
<link rel="alternate icon" type="image/png" sizes="32x32" href="resources/icon-32.png">
<link rel="apple-touch-icon" sizes="180x180" href="resources/icon-apple-touch-icon.png">
<link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="resources/startup-iphone5-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="resources/startup-iphone5-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="resources/startup-iphone6-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="resources/startup-iphone6-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="resources/startup-iphoneplus-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="resources/startup-iphoneplus-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="resources/startup-iphonex-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="resources/startup-iphonex-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="resources/startup-iphonexr-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="resources/startup-iphonexr-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="resources/startup-iphonexsmax-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="resources/startup-iphonexsmax-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="resources/startup-ipad-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="resources/startup-ipad-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="resources/startup-ipadpro1-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="resources/startup-ipadpro1-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="resources/startup-ipadpro3-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="resources/startup-ipadpro3-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="resources/startup-ipadpro2-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="resources/startup-ipadpro2-portrait.png">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cousine&family=Noto+Sans&family=Rubik&display=swap">
<link rel="stylesheet" href="https://offroaders123.github.io/Numbered-Textarea-Plugin/styles.css">

<script>
  var parentWindow = (window.self == window.top), fileSystemAccess = (("chooseFileSystemEntries" in window) || ("showOpenFilePicker" in window)), fileHandling = (("launchQueue" in window) && ("LaunchParams" in window)), webSharing = (navigator.share), touchDevice = ("ontouchstart" in window), appleDevice = (/(Mac|iPhone|iPad|iPod)/i.test(navigator.platform));
  if (parentWindow) document.documentElement.classList.add("startup-fade");
  if (webSharing) document.documentElement.classList.add("web-sharing");
  if (touchDevice) document.documentElement.classList.add("touch-device");
  if (appleDevice) document.documentElement.classList.add("apple-device");
</script>

<style>
  *, *::before, *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: var(--font-family-interface);
    -webkit-tap-highlight-color: transparent;
  }
  :root {
    --primary-hue: 0;
    --primary-sat: 0%;
    --secondary-sat: calc(var(--primary-sat) * 0.5);
    --tertiary-sat: calc(var(--primary-sat) * 0.125);

    --main: hsl(var(--primary-hue),var(--primary-sat),7.1%);

    --font-family-interface: -apple-system, BlinkMacSystemFont, "Rubik", sans-serif;
    --font-family-sans-serif: -apple-system, BlinkMacSystemFont, "Noto Sans", sans-serif;
    --font-family-monospace: "Cousine", monospace;

    --container-dark: hsl(var(--primary-hue),var(--primary-sat),9.8%);
    --container-medium: hsl(var(--primary-hue),var(--primary-sat),11.4%);
    --container-medium-hover: hsl(var(--primary-hue),var(--primary-sat),17.6%);

    --text-dark: #000000;
    --text-dark-contrast: hsl(var(--primary-hue),var(--tertiary-sat),20%);
    --text-medium: hsl(var(--primary-hue),var(--tertiary-sat),66.7%);
    --text-medium-contrast: hsl(var(--primary-hue),var(--tertiary-sat),80%);
    --text-medium-additional: hsl(var(--primary-hue),var(--secondary-sat),46.7%);
    --text-light: #ffffff;
    --text-hover: #ffffff;

    --border-radius-small: min(0.625vw, 2.5px);
    --border-radius-medium: min(1.25vw, 5px);
    --border-radius-large: min(2.5vw, 10px);
    --box-shadow: #000000bf;
    --outline-dark: var(--text-dark-contrast);
    --outline-medium: var(--text-medium-contrast);

    --transition-slow: 0.5s;
    --transition-medium: 0.25s;
    --transition-fast: 0.125s;
    --transition-delay: 0.5s;

    --selection-color: #000000;
    --selection-background: #b4d5ffbf;

    --scrollbar: hsl(var(--primary-hue),var(--secondary-sat),47.8%);
    --scrollbar-hover: hsl(var(--primary-hue),var(--secondary-sat),60.4%);

    --button: hsl(var(--primary-hue),var(--secondary-sat),22.7%);
    --button-hover: hsl(var(--primary-hue),var(--secondary-sat),29%);
    --button-warning-hover: #bb2222;

    --tab: hsl(var(--primary-hue),var(--secondary-sat),15.3%);
    --tab-hover: hsl(var(--primary-hue),var(--secondary-sat),21.6%);

    --textarea-code-color: var(--text-light);
    --textarea-dark: hsl(var(--primary-hue),var(--secondary-sat),12.2%);
    --textarea-medium: hsl(var(--primary-hue),var(--secondary-sat),14.5%);
    --textarea-light: #eae2d1;
    --textarea-drag-hue: 240;
    --textarea-drag-background: hsla(var(--textarea-drag-hue),100%,50%,25%);
    --textarea-drag-border: hsl(var(--textarea-drag-hue),100%,50%);

    --range-thumb: var(--button);
    --range-thumb-hover: var(--button-hover);
    --range-track: hsl(var(--primary-hue),var(--secondary-sat),12.5%);
    --range-track-hover: hsl(var(--primary-hue),var(--secondary-sat),18.8%);

    --card-backdrop: #19191960;

    --startup-fade-opacity: 0;
    --startup-fade-pointer-events: none;
  }
  :root.reduced-motion, :root.startup-fade {
    --transition-slow: 0s;
    --transition-medium: 0s;
    --transition-fast: 0s
  }
  :root.startup-fade {
    --startup-fade-opacity: 1;
    --startup-fade-pointer-events: all;
  }
  @media (prefers-reduced-motion: reduce) {
    :root {
      --transition-slow: 0s;
      --transition-medium: 0s;
      --transition-fast: 0s
    }
  }
  html {
    position: fixed;
    width: 100%;
    height: 100%;
    background: var(--container-dark);
    overflow: hidden;
  }
  body {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    color: var(--text-medium);
    overflow: hidden;
    user-select: none;
    -webkit-user-select: none;
  }
  body::after {
    content: "";
    position: absolute;
    width: 100%;
    height: 100%;
    background: #191919;
    opacity: var(--startup-fade-opacity);
    pointer-events: var(--startup-fade-pointer-events);
    z-index: 3;
    transition: opacity 0.25s;
  }
  body.camera-left #header {
    padding-left: calc(env(safe-area-inset-left) + min(1.5vw, 12px));
    padding-right: calc(env(safe-area-inset-bottom) + min(1.5vw, 12px));
  }
  body.camera-right #header {
    padding-left: calc(env(safe-area-inset-bottom) + min(1.5vw, 12px));
    padding-right: calc(env(safe-area-inset-right) + min(1.5vw, 12px));
  }
  body.camera-left #workspace [data-numbered-container] {
    padding-left: env(safe-area-inset-left);
  }
  body.camera-left #workspace .files {
    padding-left: calc(env(safe-area-inset-left) + min(1.5vw, 12px));
  }
  body.camera-left #preview.preview {
    border-left-width: env(safe-area-inset-left);
  }
  body.camera-right #workspace [data-numbered-container] {
    padding-right: env(safe-area-inset-right);
  }
  body.camera-right #preview {
    border-right-width: env(safe-area-inset-right);
  }
  body.camera-right .card.notification, body.camera-right .card.action, body.camera-right .card.widget {
    right: env(safe-area-inset-right);
  }
  button {
    padding: min(0.5vw, 2px) min(1vw, 8px);
    min-width: min(8vw, 75px);
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--text-medium);
    font-size: min(2.5vw, 14.5px);
    background: var(--button);
    border: none;
    border-radius: var(--border-radius-medium);
    box-shadow: 0 min(0.75vw, 3px) min(1vw, 4px) calc(min(0.5vw, 2px) * -1) var(--box-shadow), 0 0 0 min(0.25vw, 1px) var(--focus-border) inset;
    --focus-border: transparent;
    outline: none;
    cursor: pointer;
    transition: var(--transition-fast);
    transition-property: color, background, opacity;
  }
  button.menu > svg, .dropdown > button > svg {
    margin-left: min(2vw, 8px);
  }
  button.menu > svg, .dropdown svg {
    width: min(2.75vw, 12px);
    height: min(2.75vw, 12px);
  }
  button:hover, button:focus, .dropdown.active > button, .select:hover .dropdown > button {
    color: var(--text-hover);
    background: var(--button-hover);
  }
  button:focus {
    --focus-border: var(--outline-medium);
  }
  button::-moz-focus-inner {
    border: none;
  }
  button.warning:hover, button.warning:focus {
    background: var(--button-warning-hover);
  }
  button.tab {
    padding: min(1.5vw, 6px);
    padding-left: min(3vw, 12px);
    position: relative;
    min-width: unset;
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--text-medium-contrast);
    font-size: min(3vw, 12px);
    background: var(--tab);
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
  }
  button.tab:hover, button.tab:focus, button.tab:focus-within, button.tab.active {
    color: var(--text-hover);
    background: var(--tab-hover);
  }
  button.tab::after, [data-numbered-container]::after, #workspace .files::after {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    border-radius: inherit;
    pointer-events: none;
    transition: var(--transition-medium);
    transition-property: background, box-shadow;
  }
  button.tab.drag::after, [data-numbered-container].drag::after, #workspace .files.drag::after {
    background: var(--textarea-drag-background);
    box-shadow: 0 0 min(1vw, 4px) min(1vw, 4px) var(--textarea-drag-border) inset;
  }
  button > svg {
    fill: var(--text-medium);
    transition: fill var(--transition-fast);
  }
  button.tab > button, button.nav {
    min-width: unset;
    background: none;
  }
  button.tab > button {
    margin-left: min(1vw, 4px);
    padding: min(0.75vw, 3px);
    width: min(4vw, 16px);
    height: min(4vw, 16px);
    box-shadow: none;
  }
  button.tab > button:first-of-type {
    margin-left: min(3vw, 12px);
  }
  button.tab > button:hover, button.tab > button:focus {
    background: #ffffff3a;
  }
  button.nav > svg, button.tab > button > svg {
    width: 100%;
    height: 100%;
  }
  button.nav {
    padding: min(0.5vw, 2px);
    position: absolute;
    box-shadow: 0 0 0 min(0.25vw, 1px) var(--focus-border);
  }
  button.nav.back {
    left: 0;
  }
  button.nav.close {
    right: 0;
  }
  button.nav.minimize > svg {
    transition: fill var(--transition-fast), transform var(--transition-medium);
  }
  button:hover > svg, button:focus > svg, button.tab:hover > button > svg, button.tab:focus > button > svg, button.tab:focus-within > button > svg, .dropdown:hover button > svg, .dropdown:focus-within button > svg, .dropdown.active button > svg, .dropdown li:hover > svg, .dropdown li:focus > svg, .dropdown li:focus-within > svg, .dropdown li.active > svg {
    fill: var(--text-hover);
  }
  button.hidden, .dropdown li.hidden, .card .options.hidden {
    display: none;
  }
  [data-numbered-container], input[type="text"] {
    font-family: unset;
    font-size: 13px;
    border: none;
    border-radius: 0;
  }
  [data-numbered-container] {
    position: relative;
    resize: none;
  }
  [data-numbered-container]:focus-within, input[type="text"] {
    outline: none;
  }
  [data-numbered-container] ol, [data-numbered-container] textarea, input[type="text"] {
    padding: 8px;
    line-height: normal;
  }
  [data-numbered-container] ol {
    color: inherit;
    background: transparent;
    opacity: 0.55;
  }
  [data-numbered-container] li::before {
    font-family: inherit;
  }
  [data-numbered-container] textarea, input[type="text"] {
    -webkit-appearance: none;
    transition: var(--transition-slow);
    transition-property: caret-color, scrollbar-color;
  }
  [data-numbered-container] textarea {
    overflow-wrap: normal;
    scrollbar-width: inherit;
    scrollbar-color: inherit;
  }
  span.info {
    display: flex;
    align-items: center;
    color: #ffcd00;
  }
  span.info::before {
    content: "\26A0";
    margin-right: min(1.25vw, 5px);
    font-size: 150%;
  }
  img, a {
    -webkit-touch-callout: none;
  }
  a {
    color: inherit;
    font-size: min(2vw, 14.5px);
    border-radius: var(--border-radius-small);
    box-shadow: 0 0 0 min(0.25vw, 1px) var(--focus-border);
    --focus-border: transparent;
    text-decoration-color: transparent;
    outline: none;
    transition: var(--transition-fast);
    transition-property: color, text-decoration-color;
  }
  a:hover, a:focus {
    color: var(--text-hover);
    text-decoration-color: var(--text-hover);
  }
  a:focus {
    --focus-border: var(--outline-medium);
  }
  input[type="range"] {
    padding: min(3vw, 12px) min(0.75vw, 3px);
    width: min(25vw, 130px);
    height: min(5vw, 20px);
    background: none;
    border-radius: var(--border-radius-medium);
    box-shadow: 0 0 0 min(0.25vw, 1px) var(--focus-border) inset;
    --focus-border: transparent;
    outline: none;
    cursor: pointer;
    -webkit-appearance: none;
  }
  input[type="range"]:focus {
    --focus-border: var(--outline-medium);
  }
  input[type="range"]::-webkit-slider-thumb {
    margin-top: calc(min(1.75vw, 7px) * -1);
    width: min(2.75vw, 12px);
    height: min(5vw, 20px);
    background: var(--range-thumb);
    border: none;
    border-radius: var(--border-radius-medium);
    box-shadow: 0 min(0.5vw, 2px) min(2vw, 8px) var(--box-shadow);
    transition: background var(--transition-fast);
    -webkit-appearance: none;
  }
  input[type="range"]:hover::-webkit-slider-thumb, input[type="range"]:focus::-webkit-slider-thumb {
    background: var(--range-thumb-hover);
  }
  input[type="range"]::-webkit-slider-runnable-track {
    height: min(1.5vw, 6px);
    background: var(--range-track);
    border-radius: var(--border-radius-medium);
    box-shadow: 0 min(0.5vw, 2px) min(2vw, 8px) var(--box-shadow);
    transition: background var(--transition-fast);
  }
  input[type="range"]:hover::-webkit-slider-runnable-track, input[type="range"]:focus::-webkit-slider-runnable-track {
    background: var(--range-track-hover);
  }
  input[type="range"]::-moz-range-thumb {
    margin-top: calc(min(1.75vw, 7px) * -1);
    width: min(2.75vw, 12px);
    height: min(5vw, 20px);
    background: var(--range-thumb);
    border: none;
    border-radius: var(--border-radius-medium);
    box-shadow: 0 min(0.5vw, 2px) min(2vw, 8px) var(--box-shadow);
    transition: background var(--transition-fast);
  }
  input[type="range"]:hover::-moz-range-thumb, input[type="range"]:focus::-moz-range-thumb {
    background: var(--range-thumb-hover);
  }
  input[type="range"]::-moz-range-track {
    height: min(1.5vw, 6px);
    background: var(--range-track);
    border-radius: var(--border-radius-medium);
    box-shadow: 0 min(0.5vw, 2px) min(2vw, 8px) var(--box-shadow);
    transition: background var(--transition-fast);
  }
  input[type="range"]:hover::-moz-range-track, input[type="range"]:focus::-moz-range-track {
    background: var(--range-track-hover);
  }
  hr {
    width: 100%;
    height: min(0.5vw, 2px);
    background: var(--text-medium);
    border: none;
    border-radius: var(--border-radius-medium);
  }
  :disabled {
    opacity: 0.5;
    pointer-events: none;
  }
  ::placeholder {
    color: inherit;
    opacity: 0.55;
    white-space: pre-wrap;
  }
  ::selection {
    color: var(--selection-color);
    background: var(--selection-background);
  }
  ::-webkit-scrollbar {
    width: min(3vw, 12px);
    height: min(3vw, 12px);
  }
  ::-webkit-scrollbar-track, ::-webkit-scrollbar-corner {
    background: none;
  }
  ::-webkit-scrollbar-thumb {
    width: min(9vw, 36px);
    height: min(9vw, 36px);
    background-clip: content-box;
    background-color: var(--scrollbar);
    border: min(0.5vw, 2px) solid transparent;
    border-radius: var(--border-radius-large);
  }
  ::-webkit-scrollbar-thumb:hover {
    background-color: var(--scrollbar-hover);
  }
  .dropdown {
    position: relative;
    display: flex;
  }
  .dropdown.context-menu {
    position: fixed;
    left: 0;
    top: 0;
    z-index: 2;
  }
  .dropdown > button > svg {
    transform: rotate(90deg);
  }
  .dropdown ul {
    position: absolute;
    left: 0;
    top: 100%;
    min-width: min(35vw, 155px);
    background: var(--container-medium);
    border-radius: var(--border-radius-medium);
    box-shadow: 0 min(0.5vw, 2px) min(1vw, 4px) var(--box-shadow);
    z-index: 1;
    visibility: hidden;
    opacity: 0;
    pointer-events: none;
    list-style: none;
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar) var(--container-medium);
    transform: scaleY(var(--scale));
    --scale: 0.15;
    transform-origin: center top;
    transition: var(--transition-fast) ease-in;
    transition-property: visibility, opacity, transform;
  }
  .dropdown.context-menu ul {
    transform: scale(var(--scale));
    transform-origin: left top;
  }
  .dropdown.context-menu.window > ul li:not(.window), .dropdown.context-menu.link > ul li:not(.link), .dropdown.context-menu.editing > ul li:not(.editing), :root:not(.web-sharing) .dropdown.context-menu > ul li.web-sharing, :root.web-sharing .dropdown.context-menu > ul li.web-sharing-alt {
    display: none;
  }
  .dropdown li, .dropdown a {
    padding: min(1.75vw, 8px);
    position: relative;
    display: flex;
    align-items: center;
    color: var(--text-medium-contrast);
    font-size: min(2.75vw, 12.5px);
    border-radius: var(--border-radius-medium);
    box-shadow: 0 0 0 min(0.25vw, 1px) var(--focus-border) inset;
    --focus-border: transparent;
    outline: none;
    cursor: pointer;
    white-space: nowrap;
    transition: var(--transition-fast);
    transition-property: color, background;
  }
  .dropdown li {
    justify-content: space-between;
  }
  .dropdown li > span {
    margin-left: min(4vw, 16px);
    color: var(--text-medium-additional);
    font-size: min(2.5vw, 11px);
  }
  .dropdown li > svg {
    fill: var(--text-medium-additional);
    transition: var(--transition-fast);
    transition-property: fill, transform;
  }
  .dropdown li > img, .dropdown a > img {
    margin-right: min(1.75vw, 8px);
    width: min(4vw, 16px);
    height: min(4vw, 16px);
  }
  .dropdown li > img.rounded, .dropdown a > img.rounded {
    border-radius: var(--border-radius-small);
  }
  .dropdown li > img.invert, .dropdown a > img.invert {
    filter: invert() hue-rotate(180deg);
  }
  .dropdown li:hover, .dropdown li:focus, .dropdown li:focus-within, .dropdown li.active, .dropdown a:hover, .dropdown a:focus {
    color: var(--text-hover);
    background: var(--container-medium-hover);
  }
  .dropdown li:focus, .dropdown a:focus {
    --focus-border: var(--outline-medium);
  }
  .dropdown ul ul {
    position: absolute;
    left: 100%;
    top: 0;
    transform: scale(var(--scale));
    transform-origin: left top;
  }
  @media (max-width: 550px), (max-height: 515px) {
    .dropdown ul ul {
      min-width: 100%;
      max-height: min(24vh, 60px);
      left: 0;
      top: 100%;
      transform: scaleY(var(--scale));
      transform-origin: center top;
      overflow-y: auto;
    }
    .dropdown li > svg {
      transform: rotate(90deg);
    }
  }
  @media (max-height: 300px) {
    .dropdown ul {
      max-height: 55vh;
      overflow-y: auto;
    }
    .dropdown ul ul {
      max-height: unset;
      overflow-y: unset;
    }
  }
  .dropdown.active > ul, .dropdown.active li.active > ul {
    visibility: visible;
    opacity: 1;
    pointer-events: all;
    transform: scale(1);
    transition-timing-function: ease-out;
  }
  :root.touch-device .dropdown.context-menu.active > ul {
    transition: var(--transition-medium) ease-out;
  }
  .select {
    margin: min(0.75vw, 3px);
    display: flex;
    justify-content: center;
    cursor: pointer;
    transition: color var(--transition-fast);
  }
  .select:hover, .select:focus-within {
    color: var(--text-hover);
  }
  .select label {
    padding-right: min(1vw, 4px);
    display: flex;
    align-items: center;
    cursor: inherit;
  }
  .select button {
    justify-content: space-between;
  }
  .select ul {
    min-width: 100%;
  }
  .checkbox {
    padding: min(1vw, 4px);
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: var(--border-radius-medium);
    box-shadow: 0 0 0 min(0.25vw, 1px) var(--focus-border) inset;
    --focus-border: transparent;
    outline: none;
    cursor: pointer;
  }
  .checkbox:focus {
    --focus-border: var(--outline-medium);
  }
  .checkbox input[type="checkbox"] {
    display: none;
  }
  .checkbox label {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: min(2.5vw, 14.5px);
    pointer-events: none;
    transition: color var(--transition-fast);
  }
  .checkbox label::before {
    content: "";
    margin-right: min(1vw, 4px);
    padding: min(0.25vw, 1px);
    width: min(3.35vw, 18px);
    height: min(3.35vw, 18px);
    background: var(--range-track);
    border: min(0.35vw, 2px) solid var(--text-medium);
    border-radius: var(--border-radius-medium);
    box-shadow: 0 min(0.75vw, 3px) min(1vw, 4px) calc(min(0.5vw, 2px) * -1) var(--box-shadow);
    transition: var(--transition-fast);
    transition-property: background, border-color;
  }
  .checkbox:hover label, .checkbox:focus label {
    color: var(--text-hover);
  }
  .checkbox:hover label::before, .checkbox:focus label::before {
    background: var(--range-track-hover);
    border-color: var(--text-hover);
  }
  .checkbox label > svg {
    padding: min(0.55vw, 3px);
    position: absolute;
    left: 0;
    width: min(3.35vw, 18px);
    height: min(3.35vw, 18px);
    fill: transparent;
    border-radius: var(--border-radius-medium);
    transform: rotate(-45deg) scale(0);
    transform-origin: 45% 65%;
    transition: var(--transition-fast) ease-in;
    transition-property: fill, transform;
  }
  .checkbox input[type="checkbox"]:checked + label > svg {
    fill: var(--text-medium);
    transform: rotate(0deg) scale(1);
    transition-timing-function: ease-out;
  }
  .checkbox:hover input[type="checkbox"]:checked + label > svg, .checkbox:focus input[type="checkbox"]:checked + label > svg {
    fill: var(--text-hover);
  }
  :root:not(.apple-device) .shortcut.ctrl::before {
    content: "Ctrl + ";
  }
  :root:not(.apple-device) .shortcut.ctrl-shift::before {
    content: "Ctrl + Shift + ";
  }
  :root.apple-device .shortcut {
    font-size: min(3vw, 12px);
  }
  :root.apple-device .shortcut.command::before {
    content: "\2318";
  }
  :root.apple-device .shortcut.shift-command::before {
    content: "\21E7\2318";
  }
  :root.apple-device .shortcut.ctrl-command::before {
    content: "\2303\2318";
  }
  [data-tooltip] {
    position: relative;
  }
  [data-tooltip]::before, [data-tooltip]::after {
    position: absolute;
    left: 50%;
    opacity: 0;
    pointer-events: none;
    z-index: 1;
    transform: translateX(-50%) scale(var(--scale));
    --scale: 0.85;
    transition: var(--transition-fast) ease-in;
    transition-property: opacity, transform;
  }
  [data-tooltip]::before {
    content: attr(data-tooltip);
    padding: min(2vw, 8px);
    bottom: calc(100% + min(3vw, 12px));
    min-width: min(12vw, 48px);
    max-width: 100%;
    color: var(--text-hover);
    font-size: min(2.75vw, 12px);
    background: var(--container-medium-hover);
    border-radius: var(--border-radius-large);
    box-shadow: 0 min(0.5vw, 2px) min(1vw, 4px) var(--box-shadow);
    text-align: center;
    overflow: hidden;
    text-overflow: ellipsis;
    transform-origin: center bottom;
  }
  [data-tooltip]::after {
    content: "";
    top: calc(min(3vw, 12px) * -1);
    border: min(3vw, 12px) solid transparent;
    border-top-color: var(--container-medium-hover);
    filter: drop-shadow(0 min(0.5vw, 2px) min(0.25vw, 1px) var(--box-shadow));
    transform-origin: center top;
  }
  [data-tooltip]:hover::before, [data-tooltip]:hover::after, [data-tooltip]:focus::before, [data-tooltip]:focus::after, [data-tooltip]:focus-within::before, [data-tooltip]:focus-within::after, [data-tooltip].focused::before, [data-tooltip].focused::after {
    opacity: 1;
    --scale: 1;
    transition-timing-function: ease-out;
  }
  .buffering {
    animation: rotate 2s infinite linear;
    animation-play-state: paused;
  }
  .buffering.active {
    animation-play-state: running;
  }
  @keyframes rotate {
    from {
      transform: rotate(-360deg);
    }
  }
  .card {
    display: flex;
    flex-direction: column;
    background: var(--container-dark);
    box-shadow: 0 min(0.75vw, 3px) min(1.5vw, 6px) var(--box-shadow);
    white-space: nowrap;
    visibility: hidden;
    pointer-events: none;
    overflow-y: hidden;
    scrollbar-color: var(--scrollbar) var(--container-dark);
    transition: var(--transition-medium);
    transition-property: top, max-height, visibility, opacity, transform;
  }
  .card.modal, .card.action, .card.widget {
    opacity: 0;
  }
  .card.modal {
    padding: min(2.6vw, 16px);
    position: fixed;
    left: 50%;
    top: 50%;
    max-height: calc(95% - min(4.5vw, 24px));
    border-radius: var(--border-radius-large);
    z-index: 2;
    transform: translate(-50%,-50%) scale(var(--scale));
    --scale: 0.15;
  }
  .card.notification, .card.action, .card.widget {
    padding: min(2.5vw, 12px);
    position: absolute;
    right: 0;
    max-height: calc(100% - min(12vw, 58px));
    border-radius: var(--border-radius-large);
  }
  .card.notification, .card.widget {
    min-width: min(50vw, 250px);
  }
  .card.notification {
    margin: min(4vw, 20px);
    bottom: 0;
    z-index: 3;
    transform: translateX(calc(100% + min(8vw, 40px)));
  }
  .card.action, .card.widget {
    margin: min(2.5vw, 12px);
    top: min(7.5vw, 34px);
    z-index: 1;
    transform: scaleY(var(--scale));
    --scale: 0.15;
    transform-origin: center top;
  }
  .card.action {
    flex-direction: row;
  }
  .card.action > *:not(.hidden) + * {
    margin-left: min(2.5vw, 12px);
  }
  .card.action button {
    padding: min(2.25vw, 10px) min(2vw, 8px);
    min-width: unset;
  }
  .card.action button > svg {
    width: min(2.5vw, 12px);
    height: min(2.5vw, 12px);
  }
  .card.action.active ~ .card.widget {
    max-height: calc(100% - min(12vw, 58px) - min(13.5vw, 68px));
    transform: translateY(min(13.5vw, 68px)) scaleY(var(--scale));
  }
  #main.split.vertical:not(.files-offset) .card.action, #main.split.vertical:not(.files-offset) .card.widget, #main.preview .card.action, #main.preview .card.widget {
    top: 0;
  }
  #main.split.vertical:not(.files-offset) .card.widget:not(.minimize), #main.preview .card.widget:not(.minimize) {
    max-height: calc(100% - min(4.5vw, 24px));
  }
  #main.split.vertical:not(.files-offset) .card.action.active ~ .card.widget:not(.minimize), #main.preview .card.action.active ~ .card.widget:not(.minimize) {
    max-height: calc(100% - min(4.5vw, 24px) - min(13.5vw, 68px));
  }
  .card.action.active ~ .card.widget.active {
    transform: translateY(min(13.5vw, 68px)) scaleY(1);
  }
  .card.active, #backdrop.active {
    visibility: visible;
    pointer-events: all;
  }
  .card.active, #backdrop.active {
    opacity: 1;
  }
  .card.modal.active {
    transform: translate(-50%,-50%) scale(1);
  }
  .card.notification.active {
    animation: pop var(--transition-medium) var(--transition-delay);
    transform: translateX(0);
  }
  @keyframes pop {
    50% {
      transform: scale(1.1);
    }
  }
  .card.action.active, .card.widget.active {
    transform: scaleY(1);
  }
  .card.widget.minimize {
    max-height: min(8vw, 42px);
    transform: translateX(calc(100% - min(3.5vw, 18px) - min(2.5vw, 12px))) scaleY(0);
  }
  .card.widget.minimize.active {
    transform: translateX(calc(100% - min(3.5vw, 18px) - min(2.5vw, 12px))) scaleY(1);
  }
  .card.action.active ~ .card.widget.minimize {
    max-height: min(8vw, 42px);
    transform: translate(calc(100% - min(3.5vw, 18px) - min(2.5vw, 12px)),min(13.5vw, 68px)) scaleY(0);
  }
  .card.action.active ~ .card.widget.minimize.active {
    transform: translate(calc(100% - min(3.5vw, 18px) - min(2.5vw, 12px)),min(13.5vw, 68px)) scaleY(1);
  }
  .card.widget.minimize button.nav.minimize {
    right: calc(100% - min(3.5vw, 18px));
  }
  .card.widget.minimize button.nav.minimize > svg {
    transform: scaleX(-1);
  }
  .card > :not(.content) {
    flex-shrink: 0;
  }
  .card .header {
    position: relative;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .card.modal .header {
    margin-bottom: min(3vw, 16px);
  }
  .card.notification .header, .card.widget .header {
    margin-bottom: min(2.5vw, 12px);
  }
  .card.widget .header > :not(.minimize), .card.widget .content, .card.widget .options {
    transition: var(--transition-medium);
    transition-property: visibility, opacity;
  }
  .card.modal .header span {
    font-size: min(5vw, 24px);
  }
  .card.notification .header span, .card.widget .header span {
    font-size: min(3vw, 16px);
  }
  .card .icon {
    width: min(5vw, 24px);
    height: min(5vw, 24px);
  }
  .card .header .icon {
    margin-right: min(3vw, 10px);
  }
  .card.modal button.nav {
    width: min(4.25vw, 21px);
    height: min(4.25vw, 21px);
  }
  .card.notification button.nav, .card.widget button.nav {
    width: min(3.5vw, 18px);
    height: min(3.5vw, 18px);
  }
  .card.widget button.nav.minimize {
    right: min(4.75vw, 24px);
    transition: right var(--transition-medium);
  }
  .card.widget.minimize .header > :not(.minimize), .card.widget.minimize .content, .card.widget.minimize .options {
    visibility: hidden;
    opacity: 0;
  }
  .card [data-numbered-container], .card input[type="text"] {
    color: var(--text-light);
    caret-color: var(--text-light);
    background: var(--textarea-medium);
    border-radius: var(--border-radius-medium);
    transition: color var(--transition-slow);
  }
  .card [data-numbered-container] {
    position: relative;
    max-width: 50vw;
    height: min(25vw, 75px);
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar) var(--textarea-medium);
  }
  .card [data-numbered-container]::before, .card input[type="text"] {
    box-shadow: 0 2px 4px var(--box-shadow) inset;
  }
  .card [data-numbered-container]::before {
    content: "";
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: inherit;
    pointer-events: none;
    z-index: 1;
  }
  .card [data-numbered-container].expand {
    height: 150px;
  }
  .card.modal > *:not(.header) + * {
    margin-top: min(2.6vw, 16px);
  }
  .card .content {
    width: 100%;
    display: flex;
    justify-content: space-around;
    scrollbar-width: inherit;
    scrollbar-color: inherit;
  }
  .card .content:not(.no-collapse) {
    overflow-y: auto;
  }
  .card.modal .content span {
    font-size: min(2.5vw, 14.5px);
  }
  .card .content .item {
    margin: auto 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: min(3vw, 14.5px);
  }
  .card .content .item + * {
    margin-left: min(2.5vw, 12px);
  }
  .card .content .item.list > * {
    display: flex;
    justify-content: center;
  }
  .card .content .item.list > * + *:not(label):not([type="range"]), .card .content .item.list > *:not(label):not([type="range"]) + label {
    margin-top: min(2.5vw, 12px);
  }
  .card .content .item.list.start {
    align-items: flex-start;
  }
  .card .content .item.expand, .card .content .item.expand > *:not(label) {
    width: 100%;
  }
  .card .options {
    display: flex;
    justify-content: center;
  }
  .card.notification .options, .card.widget .options {
    margin-top: min(2.5vw, 12px);
  }
  .card .options > *:not(.hidden) + * {
    margin-left: min(2.5vw, 12px);
  }
  .card .options button {
    min-width: min(12vw, 75px);
  }
  #symbols {
    position: absolute;
    pointer-events: none;
  }
  #header {
    padding: min(1.5vw, 12px);
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--container-dark);
    z-index: 2;
  }
  @media (display-mode: standalone) {
    #header {
      padding-top: calc(env(safe-area-inset-top) + min(1.5vw, 12px));
    }
  }
  #header.resize, #workspace.resize, #preview.resize {
    pointer-events: none;
    transition: none;
  }
  #header .menubar {
    display: flex;
    align-items: center;
  }
  #header .menubar > * + * {
    margin-left: min(1.5vw, 12px);
  }
  #header .title {
    position: absolute;
    left: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    transform: translateX(-50%);
    transition: transform var(--transition-slow);
  }
  #header .title img {
    width: min(5vw, 24px);
    height: min(5vw, 24px);
    flex-shrink: 0;
  }
  #header .title span {
    margin-left: 5px;
    font-size: min(4vw, 16px);
    white-space: nowrap;
    transform-origin: left center;
    transition: var(--transition-slow);
    transition-property: margin-left, visibility, opacity, transform;
  }
  @media (max-width: 900px) {
    #header .title {
      transform: translateX(calc(min(2.75vw, 12px) * -1));
    }
    #header .title span {
      margin-left: 0;
      visibility: hidden;
      opacity: 0;
      transform: scale(0);
    }
  }
  #header .attribution {
    max-width: 35%;
    display: flex;
    text-align: right;
  }
  #header .attribution span {
    font-size: min(2vw, 14.5px);
  }
  #main {
    position: relative;
    flex: 1;
    background: var(--main);
  }
  #main.text [data-numbered-container], #main.text input[type="text"] {
    font-family: var(--font-family-sans-serif);
  }
  #main:not(.text) [data-numbered-container], #main:not(.text) input[type="text"] {
    font-family: var(--font-family-monospace);
    color: var(--textarea-code-color);
    caret-color: var(--textarea-code-color);
  }
  #main.horizontal.resize {
    cursor: row-resize;
  }
  #main.vertical.resize {
    cursor: col-resize;
  }
  #workspace {
    position: absolute;
    left: 0;
    top: 0;
    display: flex;
    flex-direction: column;
    transition: var(--transition-slow);
  }
  #workspace::before, #workspace::after {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    transition: box-shadow var(--transition-slow);
  }
  #workspace::before {
    box-shadow: 0 9px min(1.5vw, 6px) -8px var(--box-shadow) inset;
    z-index: 1;
  }
  #workspace::after {
    z-index: 1;
  }
  #workspace.text {
    --size: 100%;
    color: var(--text-dark);
    background: var(--textarea-light);
  }
  #workspace.code, #workspace.split, #workspace.preview {
    color: var(--text-light);
    background: var(--textarea-dark);
  }
  #workspace.code {
    --size: 100%;
  }
  #workspace.split {
    --size: calc(50% - 8px);
  }
  #workspace.preview {
    --size: 0;
    visibility: hidden;
    opacity: 0;
  }
  #workspace.horizontal, #preview.horizontal {
    width: 100%;
    height: var(--size);
  }
  #workspace.vertical, #preview.vertical {
    width: var(--size);
    height: 100%;
  }
  #workspace.split.horizontal::after, #workspace.preview.horizontal::after {
    box-shadow: 0 -9px min(1.5vw, 6px) -8px var(--box-shadow) inset;
  }
  #workspace.split.vertical::after, #workspace.preview.vertical::after {
    box-shadow: -9px 0 min(1.5vw, 6px) -8px var(--box-shadow) inset;
  }
  #workspace .files {
    padding-left: min(1.5vw, 12px);
    padding-top: min(0.75vw, 6px);
    position: relative;
    flex-shrink: 0;
    display: flex;
    background: var(--main);
    overflow-x: auto;
    scroll-behavior: smooth;
    scrollbar-width: none;
  }
  #workspace .files::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    box-shadow: 0 -9px min(1.5vw, 6px) -8px var(--box-shadow) inset;
    pointer-events: none;
    z-index: 1;
  }
  #workspace .files::-webkit-scrollbar {
    display: none;
  }
  #workspace .files > * {
    flex-shrink: 0;
  }
  #workspace .files > *:last-child::before {
    content: "";
    position: absolute;
    left: 100%;
    top: 0;
    width: min(1.5vw, 12px);
    height: 100%;
    pointer-events: none;
  }
  #workspace .files > * + * {
    margin-left: min(2vw, 8px);
  }
  #workspace .files button.tab.active {
    cursor: unset;
    z-index: 1;
  }
  #workspace .files button.tab > [data-file-name] {
    display: flex;
    align-items: center;
  }
  #workspace .files button.tab[data-unsaved] {
    padding-left: min(2vw, 8px);
  }
  #workspace .files button.tab[data-unsaved] > [data-file-name] {
    font-style: italic;
  }
  #workspace .files button.tab[data-unsaved] > [data-file-name]::before {
    content: "*";
    margin-right: min(0.5vw, 2px);
    font-size: 125%;
    font-style: normal;
    line-height: min(4vw, 16px);
  }
  #workspace.text .files button.tab.active {
    color: var(--text-dark);
    background: var(--textarea-light);
  }
  #workspace.text .files button.tab.active:focus {
    --focus-border: var(--outline-dark);
  }
  #workspace.text .files button.tab.active > button:hover, #workspace.text .files button.tab.active > button:focus {
    background: #0000004a;
  }
  #workspace.text .files button.tab.active > button > svg {
    fill: var(--text-dark);
  }
  #workspace:not(.text) .files button.tab.active > button > svg {
    fill: var(--text-light);
  }
  #workspace:not(.text) .files button.tab.active {
    color: var(--text-light);
    background: var(--textarea-dark);
  }
  #workspace .files button.tab.active.fade, #workspace .files button.tab.active.fade > button > svg {
    transition-duration: var(--transition-slow);
  }
  #workspace [data-numbered-container] {
    height: 0;
    background: none;
    visibility: hidden;
    opacity: 0;
    transition: var(--transition-slow);
    transition-property: padding, color;
  }
  #workspace.text [data-numbered-container] {
    scrollbar-color: var(--scrollbar) var(--textarea-light);
  }
  #workspace:not(.text) [data-numbered-container] {
    scrollbar-color: var(--scrollbar) var(--textarea-dark);
  }
  #workspace [data-numbered-container].active {
    height: 100%;
    visibility: visible;
    opacity: 1;
  }
  #workspace [data-numbered-container] ol {
    padding-left: 16px;
    padding-right: 16px;
  }
  #workspace.text [data-numbered-container] textarea {
    caret-color: var(--text-dark);
    white-space: pre-wrap;
  }
  #scaler {
    position: absolute;
    display: flex;
    justify-content: center;
    align-items: center;
    background: var(--button);
    transition: var(--transition-slow), background var(--transition-fast);
  }
  #scaler.active, #scaler:hover {
    background: var(--button-hover);
  }
  #scaler.active {
    transition: background var(--transition-fast);
  }
  #scaler.text, #scaler.code {
    --axis: 0;
    --size: 0;
    visibility: hidden;
    opacity: 0;
  }
  #scaler.split {
    --axis: calc(50% - 8px);
    --size: 16px;
  }
  #scaler.preview {
    --axis: 100%;
    --size: 0;
    visibility: hidden;
    opacity: 0;
  }
  #scaler.horizontal {
    bottom: var(--axis);
    width: 100%;
    height: var(--size);
    cursor: row-resize;
    --rotate: 0deg;
  }
  #scaler.vertical {
    right: var(--axis);
    width: var(--size);
    height: 100%;
    cursor: col-resize;
    --rotate: 90deg;
  }
  #scaler .handle {
    padding: min(0.5vw, 2px);
    font-size: min(2.75vw, 12px);
    background: var(--button);
    border-radius: var(--border-radius-medium);
    box-shadow: 0 0 min(1.5vw, 6px) var(--box-shadow);
    visibility: hidden;
    opacity: 0;
    z-index: 1;
    transform: scale(0.25) rotate(var(--rotate));
    transition: var(--transition-fast) ease-in;
    transition-property: color, background, visibility, opacity, transform;
  }
  #scaler:hover .handle, #scaler.active .handle {
    color: var(--text-hover);
    background: var(--button-hover);
    visibility: visible;
    opacity: 1;
    transform: scale(1) rotate(var(--rotate));
    transition-timing-function: ease-out;
  }
  #preview {
    position: absolute;
    right: 0;
    bottom: 0;
    background: #ffffff;
    border: 0 solid var(--container-medium);
    transition: var(--transition-slow);
  }
  #preview.text, #preview.code {
    --size: 0;
    visibility: hidden;
    opacity: 0;
  }
  #preview.split {
    --size: calc(50% - 8px);
  }
  #preview.preview {
    --size: 100%;
  }
  #backdrop {
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: var(--card-backdrop);
    visibility: hidden;
    opacity: 0;
    pointer-events: none;
    z-index: 2;
    transition: var(--transition-medium);
    transition-property: visibility, opacity;
  }
  #installOption > img, #installButton > img {
    margin-right: min(2vw, 8px);
    width: min(4.5vw, 20px);
    height: min(4.5vw, 20px);
  }
  #installOption {
    justify-content: flex-start;
  }
  #installButton + button::before {
    content: "Theme";
  }
  #installButton.hidden + button::before {
    content: "Customize Theme";
  }
  #themeButton {
    padding: min(1.5vw, 6px) min(1vw, 8px);
  }
  #codeColorSetting {
    width: min(45vw, 220px);
    color: var(--textarea-code-color);
  }
  #pickerPreview {
    min-width: min(20vw, 86px);
    min-height: min(20vw, 86px);
    border-radius: var(--border-radius-medium);
    box-shadow: 0 min(0.5vw, 2px) min(1vw, 4px) var(--box-shadow) inset;
  }
  #pickerInput {
    width: min(20vw, 86px);
  }
  #redChannel {
    --range-thumb-hover: #bb2222;
    --range-track-hover: #660000;
  }
  #greenChannel {
    --range-thumb-hover: #22bb22;
    --range-track-hover: #006600;
  }
  #blueChannel {
    --range-thumb-hover: #2222bb;
    --range-track-hover: #000066;
  }
  #loading {
    margin: min(2.5vw, 12px);
    position: absolute;
    right: 0;
    bottom: 0;
    visibility: hidden;
    opacity: 0;
    z-index: 2;
  }
  #loading.active {
    visibility: visible;
    opacity: 1;
  }
  #loading > svg {
    width: 15vmin;
    height: 15vmin;
    transition: fill var(--transition-slow);
  }
  #main.text #loading > svg {
    fill: var(--text-dark);
  }
  #main:not(.text) #loading > svg {
    fill: var(--text-light);
  }
</style>

</head>

<body>

<svg id="symbols">
  <symbol id="arrow" viewBox="0 0 512 512">
    <path d="m112.66 0 286.68 256-286.68 256z"/>
  </symbol>
  <symbol id="check" viewBox="0 0 512 512">
    <path d="m63.346 191.15 192.72 192.72-63.402 63.402-192.72-192.72z"/>
    <path d="m129.5 383.87 319.15-319.15 63.402 63.402-319.15 319.15z"/>
  </symbol>
  <symbol id="back" viewBox="0 0 512 512">
    <path d="m160.8 191.81 254.36 254.36-64 64-254.36-254.36z"/>
    <path d="m96.833 255.86 254.36-254.36 64 64-254.36 254.36z"/>
  </symbol>
  <symbol id="minimize" viewBox="0 0 512 512">
    <path d="m30.33 211.17h451.34v89.669h-451.34z"/>
  </symbol>
  <symbol id="close" viewBox="0 0 512 512">
    <path d="m1.5795 65.78 64.201-64.201 190.22 190.22 190.22-190.22 64.201 64.201-190.22 190.22 190.22 190.22-64.201 64.201-190.22-190.22-190.22 190.22-64.201-64.201 190.22-190.22z"/>
  </symbol>
  <symbol id="rename" viewBox="0 0 512 512">
    <path d="m-0.0618 512.07v-128.63l128.63 128.63z"/>
    <path d="m383.21 0.052969 128.72 128.72-88.63 88.63-128.72-128.72z"/>
    <path d="m252.59 130.63 128.72 128.72-210.68 210.68-128.72-128.72z"/>
  </symbol>
  <symbol id="undo" viewBox="0 0 512 512">
    <path d="m133.64 437.65-133.64-133.64h267.28z"/>
    <path d="m512 249c-0.72363-111.33-91.271-201.16-202.61-200.98-111.33 0.17137-201.61 90.272-201.99 201.61l52.695 0.18028c0.28168-82.334 67.039-148.97 149.37-149.09 82.334-0.12673 149.3 66.299 149.83 148.63z"/>
    <path d="m107.4 246.77h52.472v57.48h-52.472z"/>
    <path d="m459.53 246.77h52.472v190.87h-52.472z"/>
  </symbol>
  <symbol id="redo" viewBox="0 0 512 512">
    <path d="m378.36 437.65 133.64-133.64h-267.28z"/>
    <path d="m0.0044544 249c0.72363-111.33 91.271-201.16 202.61-200.98 111.33 0.17137 201.61 90.272 201.99 201.61l-52.695 0.18028c-0.28168-82.334-67.039-148.97-149.37-149.09-82.334-0.12673-149.3 66.299-149.83 148.63z"/>
    <path d="m404.6 246.77h-52.472v57.48h52.472z"/>
    <path d="m52.473 246.77h-52.472v190.87h52.472z"/>
  </symbol>
  <symbol id="refresh" viewBox="0 0 512 512">
    <path d="m510.27 285.75c-13.893 118.73-108.1 212.04-226.96 224.79-118.86 12.751-230.71-58.451-269.47-171.53-38.761-113.08 5.8941-237.93 107.58-300.78 101.68-62.846 233.32-46.955 317.13 38.282l-37.067 36.446c-66.79-67.929-171.7-80.593-252.74-30.508-81.036 50.084-116.62 149.58-85.733 239.7 30.89 90.117 120.03 146.86 214.75 136.7 94.721-10.161 169.8-84.522 180.87-179.14z"/>
    <path d="m512 189.01v-189.01l-188.98 189.01z"/>
  </symbol>
  <symbol id="buffering" viewBox="0 0 512 512">
    <path d="m229.78 8.7403c0-4.8272 3.9132-8.7403 8.7403-8.7403h34.96c2.3181 0 4.5412 0.92085 6.1804 2.56 1.6391 1.6391 2.56 3.8623 2.56 6.1803v88.126c0 4.8272-3.9132 8.7403-8.7403 8.7403h-34.96c-4.8272 0-8.7403-3.9132-8.7403-8.7403z"/>
    <path d="m356.92 28.764c2.4126-4.1803 7.7575-5.6138 11.938-3.2016l30.278 17.47c2.0076 1.1583 3.4727 3.0667 4.0731 5.3053 0.60034 2.2386 0.28674 4.624-0.87186 6.6314l-44.051 76.326c-2.4126 4.1803-7.7575 5.6138-11.938 3.2016l-30.278-17.47c-4.1806-2.4121-5.6139-7.7564-3.2013-11.937z" opacity="0.083"/>
    <path d="m457.03 109.66c4.1804-2.4126 9.5246-0.97937 11.937 3.2013l17.47 30.278c1.1584 2.0076 1.4718 4.3932 0.87137 6.6321-0.60043 2.2388-2.0655 4.1475-4.073 5.3061l-76.326 44.051c-4.1804 2.4126-9.5246 0.97937-11.937-3.2013l-17.47-30.278c-2.4121-4.1806-0.9787-9.5255 3.2017-11.938z" opacity="0.16"/>
    <path d="m503.26 229.78c4.8271 0 8.7403 3.9132 8.7403 8.7403v34.96c0 2.3181-0.92087 4.5412-2.56 6.1804-1.6391 1.6391-3.8622 2.56-6.1803 2.56h-88.126c-4.8271 0-8.7403-3.9132-8.7403-8.7403v-34.96c0-4.8272 3.9132-8.7403 8.7403-8.7403z" opacity="0.25"/>
    <path d="m483.25 356.93c4.1806 2.4151 5.6119 7.7619 3.1969 11.943l-17.491 30.278c-1.1597 2.0076-3.0695 3.4723-5.3091 4.0718-2.2396 0.59955-4.6257 0.28482-6.6333-0.87494l-76.294-44.073c-4.1806-2.4151-5.6119-7.7619-3.1969-11.943l17.491-30.278c2.415-4.1806 7.7618-5.6119 11.942-3.1969z" opacity="0.33"/>
    <path d="m402.34 457.03c2.4126 4.1804 0.97937 9.5246-3.2013 11.937l-30.278 17.47c-2.0076 1.1584-4.3932 1.4718-6.6321 0.87137-2.2388-0.60043-4.1475-2.0655-5.3061-4.073l-44.051-76.326c-2.4126-4.1804-0.97937-9.5246 3.2013-11.937l30.278-17.47c4.1806-2.4121 9.5255-0.9787 11.938 3.2017z" opacity="0.42"/>
    <path d="m229.78 503.26c0 4.8271 3.9132 8.7403 8.7403 8.7403h34.96c2.3181 0 4.5412-0.92087 6.1804-2.56 1.6391-1.6391 2.56-3.8622 2.56-6.1803v-88.126c0-4.8271-3.9132-8.7403-8.7403-8.7403h-34.96c-4.8272 0-8.7403 3.9132-8.7403 8.7403z" opacity="0.5"/>
    <path d="m109.66 457.03c-2.4126 4.1804-0.97936 9.5246 3.2013 11.937l30.278 17.47c2.0076 1.1584 4.3932 1.4718 6.6321 0.87137 2.2388-0.60043 4.1475-2.0655 5.3061-4.073l44.051-76.326c2.4126-4.1804 0.97937-9.5246-3.2013-11.937l-30.278-17.47c-4.1806-2.4121-9.5255-0.9787-11.938 3.2017z" opacity="0.58"/>
    <path d="m28.765 356.92c-4.1803 2.4126-5.6138 7.7575-3.2016 11.938l17.47 30.278c1.1583 2.0076 3.0667 3.4727 5.3053 4.0731 2.2386 0.60034 4.624 0.28674 6.6314-0.87186l76.326-44.051c4.1803-2.4126 5.6138-7.7575 3.2016-11.938l-17.47-30.278c-2.4121-4.1806-7.7564-5.6139-11.937-3.2013z" opacity="0.66"/>
    <path d="m8.7403 282.22c-4.8272 0-8.7403-3.9132-8.7403-8.7403v-34.96c0-2.3181 0.92085-4.5412 2.56-6.1804 1.6391-1.6391 3.8623-2.56 6.1803-2.56h88.126c4.8272 0 8.7403 3.9132 8.7403 8.7403v34.96c0 4.8271-3.9132 8.7403-8.7403 8.7403z" opacity="0.75"/>
    <path d="m54.982 109.67c-4.1806-2.4151-9.5274-0.98376-11.942 3.1969l-17.491 30.278c-1.1597 2.0076-1.4745 4.3937-0.87492 6.6334 0.59953 2.2397 2.0642 4.1494 4.0718 5.3092l76.294 44.073c4.1806 2.415 9.5274 0.98376 11.942-3.1969l17.491-30.278c2.415-4.1806 0.98373-9.5275-3.1969-11.943z" opacity="0.83"/>
    <path d="m155.08 28.764c-2.4126-4.1803-7.7575-5.6138-11.938-3.2016l-30.278 17.47c-2.0076 1.1583-3.4727 3.0667-4.0731 5.3053-0.60036 2.2386-0.28674 4.624 0.87183 6.6314l44.051 76.326c2.4126 4.1803 7.7575 5.6138 11.938 3.2016l30.278-17.47c4.1806-2.4121 5.6139-7.7564 3.2013-11.937z" opacity="0.91"/>
  </symbol>
</svg>

<header id="header">
  <section class="menubar">
    <div class="dropdown">
      <button>File</button>
      <ul>
        <li onclick="createFile();">New File<span class="shortcut ctrl-shift shift-command">X</span></li>
        <li onclick="openEditorWindow();">New Window<span class="shortcut ctrl-shift shift-command">C</span></li>
        <li onclick="loadFiles();">Open<span class="shortcut ctrl command">O</span></li>
        <li onclick="saveFile();">Save<span class="shortcut ctrl command">S</span></li>
        <li>Save As...
          <svg><use href="#arrow"/></svg>
          <ul>
            <li onclick="saveFile('txt');">Plain Text<span>.txt</span></li>
            <li onclick="saveFile('html');">HTML<span>.html</span></li>
            <li onclick="saveFile('css');">CSS<span>.css</span></li>
            <li onclick="saveFile('js');">JavaScript<span>.js</span></li>
            <li onclick="saveFile('json');">JSON<span>.json</span></li>
            <li onclick="saveFile('svg');">SVG<span>.svg</span></li>
          </ul>
        </li>
      </ul>
    </div>
    <div class="dropdown">
      <button>View</button>
      <ul>
        <li onclick="changeView('text');">Text<span class="shortcut ctrl-shift ctrl-command">1</span></li>
        <li onclick="changeView('code');">Code<span class="shortcut ctrl-shift ctrl-command">2</span></li>
        <li onclick="changeView('split');">Split<span class="shortcut ctrl-shift ctrl-command">3</span></li>
        <li onclick="changeView('preview');">Preview<span class="shortcut ctrl-shift ctrl-command">4</span></li>
        <li onclick="changeOrientation();">Orientation<span class="shortcut ctrl-shift ctrl-command">5</span></li>
        <li onclick="openDisplay();">Display<span class="shortcut ctrl-shift ctrl-command">6</span></li>
      </ul>
    </div>
    <div class="dropdown">
      <button>Tools</button>
      <ul>
        <li onclick="openCard(editingTools);">Editing Tools<span class="shortcut ctrl-shift shift-command">E</span></li>
        <li onclick="openCard(replacer);">Replace Text<span class="shortcut ctrl-shift shift-command">F</span></li>
        <li onclick="openCard(picker);">Color Picker<span class="shortcut ctrl-shift shift-command">K</span></li>
        <li onclick="openCard(formatter);">JSON Formatter<span class="shortcut ctrl-shift shift-command">R</span></li>
        <li onclick="openCard(encoder);">URI Encoder<span class="shortcut ctrl-shift shift-command">Y</span></li>
        <li onclick="confirmOverwrite(insertTemplate);">Import HTML Template<span class="shortcut ctrl-shift shift-command">H</span></li>
        <li>Online Resources...
          <svg><use href="#arrow"/></svg>
          <ul>
            <a href="https://webformatter.com"><img src="resources/web-formatter.svg">Code Formatter</a>
            <a href="https://www.sharedrop.io"><img class="invert" src="resources/sharedrop.svg">File Transferer</a>
            <a href="https://www.diffchecker.com/"><img src="resources/diffchecker.svg">Difference Finder</a>
            <a href="https://caniuse.com/"><img src="resources/caniuse.svg">Compatibility Checker</a>
            <a href="https://web.dev/measure/"><img src="resources/webdev.svg">Performance Tester</a>
            <a href="https://realfavicongenerator.net/"><img class="rounded" src="resources/real-favicon-generator.svg">Favicon Generator</a>
            <a href="https://appsco.pe/developer/splash-screens/"><img class="invert" src="resources/appscope.svg">Splash Generator</a>
            <a href="https://www.svgminify.com/"><img src="resources/svgminify.svg">SVG Simplifier</a>
            <a href="https://www.uuidgenerator.net/"><img src="resources/online-uuid-generator.svg">UUID Generator</a>
            <a href="https://cryptii.com/"><img src="resources/cryptii.svg">Text Encryptor</a>
          </ul>
        </li>
      </ul>
    </div>
    <div class="dropdown alternate">
      <button id="settingsButton" onclick="openCard(settings);">Settings</button>
      <ul>
        <li id="installOption" class="hidden" onclick="installApp();"><img src="resources/icon.svg">Install</button>
        <li onclick="openCard(theme); editor.modal_previous = this.closest('.dropdown').querySelector('button');">Theme Settings</li>
        <li id="clearCacheOption" class="hidden" onclick="clearCache();">Clear Cache</li>
        <li onclick="resetSettings();">Reset Settings</li>
      </ul>
    </div>
  </section>
  <section class="title">
    <img src="resources/icon.svg">
    <span>Smart Text Editor</span>
  </section>
  <section class="attribution">
    <span>Inspired by <a href="https://htmledit.squarefree.com/">Real-Time HTML Editor</a> and <a href="https://www.editpad.org/">Edit Pad</a>!</span>
  </section>
</header>

<main id="main" class="text horizontal">
  <section id="workspace" class="text horizontal">
    <section id="files" class="files"></section>
  </section>
  <section id="scaler" class="text horizontal">
    <div class="handle"><br></div>
  </section>
  <iframe id="preview" class="text horizontal" src="about:blank"></iframe>
  <section id="backdrop"></section>
  <section id="settings" class="card modal">
    <div class="header">
      <span>Settings</span>
      <button class="nav close"><svg><use href="#close"/></svg></button>
    </div>
    <div class="content">
      <div class="item list start">
        <div class="select">
          <label for="viewSetting">Default View:</label>
          <div class="dropdown">
            <button id="viewSetting">Text<svg><use href="#arrow"/></svg></button>
            <ul>
              <li onclick="updateSelect('view','text');">Text</li>
              <li onclick="updateSelect('view','code');">Code</li>
              <li onclick="updateSelect('view','split');">Split</li>
            </ul>
          </div>
        </div>
        <div class="select">
          <label for="orientationSetting">Default Orientation:</label>
          <div class="dropdown">
            <button id="orientationSetting">Horizontal<svg><use href="#arrow"/></svg></button>
            <ul>
              <li onclick="updateSelect('orientation','horizontal');">Horizontal</li>
              <li onclick="updateSelect('orientation','vertical');">Vertical</li>
            </ul>
          </div>
        </div>
        <div class="checkbox">
          <input id="refreshSetting" type="checkbox" oninput="updateCheckbox('refresh');" checked>
          <label for="refreshSetting"><svg><use href="#check"/></svg>Automatically Refresh Preview</label>
        </div>
        <div class="checkbox">
          <input id="responsiveSetting" type="checkbox" oninput="updateCheckbox('responsive');" checked>
          <label for="responsiveSetting"><svg><use href="#check"/></svg>Screen Density Scaling</label>
        </div>
        <div class="checkbox">
          <input id="editingToolsSetting" type="checkbox" oninput="updateCheckbox('editingTools');">
          <label for="editingToolsSetting"><svg><use href="#check"/></svg>Open Editing Tools</label>
        </div>
      </div>
    </div>
    <div class="options">
      <button id="installButton" class="hidden" onclick="installApp();"><img src="resources/icon.svg">Install</button>
      <button id="themeButton" class="menu" onclick="openCard(theme);" data-previous="theme"><svg><use href="#arrow"/></svg></button>
    </div>
    <div class="options">
      <button id="clearCacheButton" class="warning hidden" onclick="clearCache();">Clear Cache</button>
      <button class="warning" onclick="resetSettings();">Reset Settings</button>
    </div>
  </section>
  <section id="theme" class="card modal">
    <div class="header">
      <span>Theme</span>
      <button class="nav back" data-parent="settings"><svg><use href="#back"/></svg></button>
      <button class="nav close"><svg><use href="#close"/></svg></button>
    </div>
    <div class="content">
      <div class="item list expand">
        <label for="primaryHueSetting">Primary Hue</label>
        <input id="primaryHueSetting" type="range" value="0" min="0" max="360" data-display="#value">
        <label for="primarySatSetting">Primary Saturation</label>
        <input id="primarySatSetting" type="range" value="0" min="0" max="100" data-display="#value%">
        <label for="dragHueSetting">Drag and Drop Hue</label>
        <input id="dragHueSetting" type="range" value="240" min="0" max="360" data-display="#value">
        <label for="codeColorSetting">Code Text Color</label>
        <input id="codeColorSetting" type="text" placeholder="Any color format...">
      </div>
    </div>
    <div class="options">
      <button onclick="resetTheme();">Reset Theme</button>
    </div>
  </section>
  <section id="reset" class="card notification">
    <div class="header">
      <img class="icon" src="resources/settings.svg">
      <span>Reset Settings</span>
    </div>
    <div class="content">
      <div class="item">Your settings have been reset!</div>
    </div>
  </section>
  <section id="clearCacheSuccess" class="card notification">
    <div class="header">
      <img class="icon" src="resources/template.svg">
      <span>Cleared Cache</span>
    </div>
    <div class="content">
      <div class="item">Successfully cleared offline cache!</div>
    </div>
  </section>
  <section id="editingTools" class="card action">
    <button id="undoTool" onclick="callCommand(getCurrentEditor(),'undo'); this.focus();"><svg><use href="#undo"/></svg></button>
    <button id="redoTool" onclick="callCommand(getCurrentEditor(),'redo'); this.focus();"><svg><use href="#redo"/></svg></button>
    <button id="refreshTool" onclick="forceRefresh();" disabled><svg><use href="#refresh"/></svg></button>
  </section>
  <section id="replacer" class="card widget">
    <div class="header">
      <span>Replace Text</span>
      <button class="nav minimize"><svg><use href="#minimize"/></svg></button>
      <button class="nav close"><svg><use href="#close"/></svg></button>
    </div>
    <div class="content">
      <div class="item list expand">
        <div data-numbered-container>
          <textarea id="replacerFind" placeholder="Text to find..."></textarea>
        </div>
        <div data-numbered-container>
          <textarea id="replacerReplace" placeholder="Replace with..."></textarea>
        </div>
      </div>
    </div>
    <div class="options">
      <button onclick="activateReplacer();">Replace</button>
      <button onclick="flipReplacer();">Flip</button>
      <button onclick="clearReplacer();">Clear</button>
    </div>
  </section>
  <section id="picker" class="card widget">
    <div class="header">
      <span>Color Picker</span>
      <button class="nav minimize"><svg><use href="#minimize"/></svg></button>
      <button class="nav close"><svg><use href="#close"/></svg></button>
    </div>
    <div class="content">
      <div class="item list">
        <div id="pickerPreview"></div>
        <input id="pickerInput" type="text" value="#ee8800" maxlength="7" placeholder="#rrggbb">
      </div>
      <div class="item list">
        <label for="redChannel">Red</label>
        <input id="redChannel" type="range">
        <label for="greenChannel">Green</label>
        <input id="greenChannel" type="range">
        <label for="blueChannel">Blue</label>
        <input id="blueChannel" type="range">
      </div>
    </div>
    <div class="options">
      <button onclick="copyPicker();">Copy</button>
      <button onclick="insertPicker();">Insert</button>
      <button onclick="deletePicker();">Delete</button>
    </div>
  </section>
  <section id="formatter" class="card widget">
    <div class="header">
      <span>JSON Formatter</span>
      <button class="nav minimize"><svg><use href="#minimize"/></svg></button>
      <button class="nav close"><svg><use href="#close"/></svg></button>
    </div>
    <div class="content">
      <div class="item expand">
        <div class="expand" data-numbered-container>
          <textarea id="formatterInput" placeholder="JSON data to format..."></textarea>
        </div>
      </div>
    </div>
    <div class="options">
      <button onclick="activateFormatter('  ');">Format</button>
      <button onclick="activateFormatter('');">Collapse</button>
      <button onclick="changeTextarea(formatterInput,'');">Clear</button>
    </div>
  </section>
  <section id="encoder" class="card widget">
    <div class="header">
      <span>URI Encoder</span>
      <button class="nav minimize"><svg><use href="#minimize"/></svg></button>
      <button class="nav close"><svg><use href="#close"/></svg></button>
    </div>
    <div class="content">
      <div class="item expand">
        <div class="expand" data-numbered-container>
          <textarea id="encoderInput" placeholder="Text to encode..."></textarea>
        </div>
      </div>
    </div>
    <div class="options">
      <button onclick="activateEncoder(true);">Encode</button>
      <button onclick="activateEncoder(false);">Decode</button>
      <button onclick="changeTextarea(encoderInput,'');">Clear</button>
    </div>
    <div class="options">
      <div class="checkbox">
        <input id="componentSetting" type="checkbox">
        <label for="componentSetting"><svg><use href="#check"/></svg>Enable URI Component</label>
      </div>
    </div>
  </section>
  <section id="contextMenu" class="dropdown context-menu">
    <ul>
      <li class="window" onclick="window.location.reload();">Reload<span class="shortcut ctrl command">R</span></li>
      <li class="link" onclick="editor.context_menu_previous.click();">Open in New Tab</li>
      <li class="web-sharing link" onclick="shareLink(editor.context_menu_previous);">Share Link</li>
      <li class="web-sharing-alt link" onclick="navigator.clipboard.writeText(editor.context_menu_previous.href).catch(function(error){ alert('Clipboard could not be written to, please check site permissions for clipboard use.'); });">Copy Link</li>
      <li class="editing" onclick="callCommand(editor.context_menu_previous,'undo');">Undo<span class="shortcut ctrl command">Z</span></li>
      <li class="editing" onclick="callCommand(editor.context_menu_previous,'redo');">Redo<span class="shortcut ctrl-shift shift-command">Z</span></li>
      <li class="editing" onclick="callCommand(editor.context_menu_previous,'cut');">Cut<span class="shortcut ctrl command">X</span></li>
      <li class="editing" onclick="callCommand(editor.context_menu_previous,'copy');">Copy<span class="shortcut ctrl command">C</span></li>
      <li class="editing" onclick="callCommand(editor.context_menu_previous,'paste');">Paste<span class="shortcut ctrl command">V</span></li>
      <li class="editing" onclick="editor.context_menu_previous.select();">Select All<span class="shortcut ctrl command">A</span></li>
      <li class="web-sharing editing" onclick="shareText(window.getSelection());">Share Text</li>
    </ul>
  </section>
  <section id="loading">
    <svg class="buffering"><use href="#buffering"/></svg>
  </section>
</main>

<script src="https://offroaders123.github.io/Numbered-Textarea-Plugin/script.js"></script>

<script>
  var editor = {
    storage: window.localStorage,
    files: {},
    view: "text",
    orientation: "horizontal",
    refresh: "true",
    responsive: "true",
    active_editing_tools: false,
    active_modal: false,
    modal_previous: null,
    active_widget: false,
    context_menu_previous: null,
    long_touch: null,
    picker_color: null,
    insert_color: false,
    install_prompt: null
  };
  var sourceChange = false;
  window.addEventListener("load",function(){
    createFile();
    if (fileHandling && fileSystemAccess){
      window.launchQueue.setConsumer(function(launchParams){
        if (!launchParams.files.length) return;
        closeFile(getCurrentTab());
        launchParams.files.forEach(async function(fileHandle){
          var file = await fileHandle.getFile(), identifier = createFile(await file.name,await file.text());
          editor.files[identifier] = await fileHandle;
        });
      });
    }
    if (parentWindow){
      loadSettings("initial");
      loadTheme();
      window.setTimeout(function(){
        document.documentElement.classList.remove("startup-fade");
      },50);
      if (!touchDevice) getCurrentEditor().focus();
    }
    setOffsetOrientation();
    pickerInputRefresh();
    var queryParameters = new URLSearchParams(window.location.search);
    if (queryParameters.get("template")){
      confirmOverwrite(insertTemplate);
      removeQueryParameters(["template"]);
    }
    if (queryParameters.get("settings")){
      openCard(settings);
      removeQueryParameters(["settings"]);
    }
    if ("serviceWorker" in navigator && parentWindow && window.location.protocol == "https:"){
      navigator.serviceWorker.register("service-worker.js");
      if (!(navigator.serviceWorker.controller)) return;
      navigator.serviceWorker.addEventListener("message",function(event){
        if (event.data.action == "load-files"){
          var files = Array.from(event.data.files);
          files.forEach(function(file){
            var reader = new FileReader();
            reader.readAsText(file,"UTF-8");
            reader.addEventListener("loadend",function(){
              createFile(file.name,reader.result);
            });
          });
        }
        if (event.data.action == "clear-cache-success") openCard(clearCacheSuccess);
      });
      clearCacheOption.classList.remove("hidden");
      clearCacheButton.classList.remove("hidden");
    }
  });
  window.addEventListener("beforeinstallprompt",function(event){
    event.preventDefault();
    editor.install_prompt = event;
    installOption.classList.remove("hidden");
    installButton.classList.remove("hidden");
  });
  window.addEventListener("beforeunload",function(event){
    if (parentWindow && (files.querySelectorAll("button.tab[data-unsaved]").length > 0)){
      event.preventDefault();
      event.returnValue = "";
    }
  });
  window.addEventListener("resize",function(event){
    if (contextMenu.classList.contains("active")) closeContextMenu();
    if (editor.view != "split" || !main.hasAttribute("data-scaling-offset")) return;
    var currentWidth = window.innerWidth, currentHeight = window.innerHeight;
    window.setTimeout(function(){
      if ((editor.orientation == "horizontal" && window.innerHeight == currentHeight) || (editor.orientation == "vertical" && window.innerWidth == currentWidth)) return;
      changeView("split");
    },50);
  });
  window.addEventListener("orientationchange",setOffsetOrientation);
  document.body.addEventListener("keydown",function(event){
    var pressed = key => (event.key.toLowerCase() == key.toLowerCase()), ctrl = (event.ctrlKey && !appleDevice), command = (event.metaKey && appleDevice), shift = (event.shiftKey || ((event.key.toUpperCase() == event.key) && (event.key + event.key == event.key * 2))), ctrlShift = (ctrl && shift), shiftCommand = (shift && command), ctrlCommand = (event.ctrlKey && command);
    if (pressed("Escape")){
      event.preventDefault();
      if (event.repeat) return;
      event.stopPropagation();
      if (contextMenu.classList.contains("active")) return closeContextMenu();
      if (editor.active_modal) closeCard(editor.active_modal);
    }
    if ((ctrlShift || shiftCommand) && pressed("x")){
      event.preventDefault();
      if (event.repeat) return;
      createFile();
    }
    if ((ctrlShift || shiftCommand) && pressed("d")){
      event.preventDefault();
      if (event.repeat) return;
      closeFile(getCurrentTab());
    }
    if ((ctrlShift || ctrlCommand) && (pressed("[") || pressed("{"))){
      event.preventDefault();
      if (event.repeat) return;
      var activeTab = getCurrentTab(), tabs = Array.from(files.querySelectorAll("button.tab")), newTab, withinEditor = (document.activeElement == getCurrentEditor());
      if (activeTab == tabs[0]){
        newTab = tabs[tabs.length - 1];
      } else newTab = tabs[tabs.indexOf(activeTab) - 1];
      openFile(newTab);
      if (withinEditor) getCurrentEditor().focus();
    }
    if ((ctrlShift || ctrlCommand) && (pressed("]") || pressed("}"))){
      event.preventDefault();
      if (event.repeat) return;
      var activeTab = getCurrentTab(), tabs = Array.from(files.querySelectorAll("button.tab")), newTab, withinEditor = (document.activeElement == getCurrentEditor());
      if (activeTab == tabs[tabs.length - 1]){
        newTab = tabs[0];
      } else newTab = tabs[tabs.indexOf(activeTab) + 1];
      openFile(newTab);
      if (withinEditor) getCurrentEditor().focus();
    }
    if ((ctrlShift || shiftCommand) && pressed("c")){
      event.preventDefault();
      if (event.repeat) return;
      openEditorWindow();
    }
    if ((ctrl || command) && pressed("o")){
      event.preventDefault();
      if (event.repeat) return;
      loadFiles();
    }
    if ((ctrl || command) && pressed("s")){
      event.preventDefault();
      if (event.repeat) return;
      saveFile();
    }
    if ((ctrlShift || ctrlCommand) && (pressed("1") || pressed("!"))){
      event.preventDefault();
      if (event.repeat) return;
      changeView("text");
    }
    if ((ctrlShift || ctrlCommand) && (pressed("2") || pressed("@"))){
      event.preventDefault();
      if (event.repeat) return;
      changeView("code");
    }
    if ((ctrlShift || ctrlCommand) && (pressed("3") || pressed("#"))){
      event.preventDefault();
      if (event.repeat) return;
      changeView("split");
    }
    if ((ctrlShift || ctrlCommand) && (pressed("4") || pressed("$"))){
      event.preventDefault();
      if (event.repeat) return;
      changeView("preview");
    }
    if ((ctrlShift || ctrlCommand) && (pressed("5") || pressed("%"))){
      event.preventDefault();
      if (event.repeat) return;
      changeOrientation();
    }
    if ((ctrlShift || ctrlCommand) && (pressed("6") || pressed("^"))){
      event.preventDefault();
      if (event.repeat) return;
      openDisplay();
    }
    if ((ctrlShift || shiftCommand) && pressed("Enter")){
      event.preventDefault();
      if (event.repeat) return;
      if (editor.view == "split" || editor.view == "preview") forceRefresh();
    }
    if ((ctrlShift || shiftCommand) && pressed("e")){
      event.preventDefault();
      if (event.repeat) return;
      openCard(editingTools);
    }
    if ((ctrlShift || shiftCommand) && pressed("f")){
      event.preventDefault();
      if (event.repeat) return;
      openCard(replacer);
    }
    if ((ctrlShift || shiftCommand) && pressed("k")){
      event.preventDefault();
      if (event.repeat) return;
      openCard(picker);
    }
    if ((ctrlShift || shiftCommand) && pressed("g")){
      event.preventDefault();
      if (event.repeat) return;
      importColor();
    }
    if ((ctrlShift || shiftCommand) && pressed("r")){
      event.preventDefault();
      if (event.repeat) return;
      openCard(formatter);
    }
    if ((ctrlShift || shiftCommand) && pressed("y")){
      event.preventDefault();
      if (event.repeat) return;
      openCard(encoder);
    }
    if ((ctrlShift || shiftCommand) && pressed("h")){
      event.preventDefault();
      if (event.repeat) return;
      confirmOverwrite(insertTemplate);
    }
    if ((ctrlShift || shiftCommand) && pressed("m")){
      event.preventDefault();
      if (!editor.active_widget || event.repeat) return;
      minimizeCard(editor.active_widget);
    }
    if ((ctrlShift || shiftCommand) && (pressed(".") || pressed(">"))){
      event.preventDefault();
      if (event.repeat) return;
      openCard(settings);
    }
  });
  document.body.addEventListener("contextmenu",function(event){
    event.preventDefault();
  });
  var textareas = document.getElementsByTagName("textarea");
  Array.from(textareas).forEach(function(textarea){
    addInputCharacteristics(textarea);
    disableLineCount(textarea);
  });
  var inputTexts = Array.from(document.querySelectorAll("input[type='text']"));
  inputTexts.forEach(function(inputText){
    addInputCharacteristics(inputText);
  });
  var anchors = Array.from(document.querySelectorAll("a[href]"));
  anchors.forEach(function(anchor){
    anchor.rel = "noopener";
    anchor.target = "_blank";
    anchor.addEventListener("contextmenu",function(event){
      openContextMenu(event,"link");
    });
    anchor.addEventListener("touchstart",function(event){
      editor.long_touch = window.setTimeout(function(){
        openContextMenu(event,"link");
      },750);
    });
    anchor.addEventListener("touchmove",cancelLongTouch);
    anchor.addEventListener("touchend",cancelLongTouch);
  });
  var images = Array.from(document.querySelectorAll("img:not([alt])"));
  images.forEach(function(image){
    image.alt = "";
  });
  var dropdowns = Array.from(document.getElementsByClassName("dropdown"));
  dropdowns.forEach(function(dropdown){
    var button = dropdown.getElementsByTagName("button")[0], menus = Array.from(dropdown.getElementsByTagName("ul")), submenus = Array.from(dropdown.querySelectorAll("li > ul")), options = Array.from(dropdown.querySelectorAll("li, a"));
    dropdown.addEventListener("click",function(event){
      event.stopPropagation();
    });
    dropdown.addEventListener("keydown",function(event){
      if (!dropdown.classList.contains("active")) return;
      if ((event.key == "Escape" || event.key == "Tab") && dropdown != contextMenu){
        event.preventDefault();
        event.stopPropagation();
        if (event.key == "Tab") return;
        closeDropdown(dropdown);
        if (button) button.focus();
      }
    });
    if (button){
      if (!dropdown.classList.contains("alternate")){
        button.addEventListener("click",function(){
          openDropdown(dropdown);
        });
      } else {
        button.addEventListener("contextmenu",function(){
          openDropdown(dropdown);
        });
        button.addEventListener("touchstart",function(){
          editor.long_touch = window.setTimeout(function(){
            openDropdown(dropdown);
          },750);
        });
        button.addEventListener("touchmove",cancelLongTouch);
        button.addEventListener("touchend",cancelLongTouch);
      }
      button.addEventListener("keydown",function(event){
        if (!dropdown.classList.contains("active")) return;
        var navigable = getNavigableElements(menus[0],true);
        if (event.key == "ArrowDown"){
          event.preventDefault();
          navigable[0].focus();
        }
        if (event.key == "ArrowUp"){
          event.preventDefault();
          navigable[navigable.length - 1].focus();
        }
      });
    }
    menus.forEach(function(menu){
      menu.addEventListener("keydown",function(event){
        var navigable = getNavigableElements(menu,true);
        if (event.key == "ArrowDown"){
          if (document.activeElement == navigable[navigable.length - 1]){
            event.preventDefault();
            event.stopPropagation();
            navigable[0].focus();
          } else {
            event.preventDefault();
            event.stopPropagation();
            navigable[navigable.indexOf(document.activeElement) + 1].focus();
          }
        }
        if (event.key == "ArrowUp"){
          if (document.activeElement == navigable[0]){
            event.preventDefault();
            event.stopPropagation();
            navigable[navigable.length - 1].focus();
          } else {
            event.preventDefault();
            event.stopPropagation();
            navigable[navigable.indexOf(document.activeElement) - 1].focus();
          }
        }
        if (event.key == "Tab") event.preventDefault();
      });
    });
    submenus.forEach(function(submenu){
      submenu.parentElement.addEventListener("click",function(event){
        openSubmenu(event);
      });
      submenu.parentElement.addEventListener("keydown",function(event){
        if (event.key == "Enter" || event.key == " " || event.key == "ArrowRight") openSubmenu(event);
        if (event.key == "ArrowLeft"){
          if (submenu.parentElement.classList.contains("active")) event.stopPropagation();
          submenu.parentElement.focus();
          submenu.parentElement.classList.remove("active");
        }
      });
      submenu.parentElement.addEventListener("mouseenter",function(){
        submenu.parentElement.classList.add("active");
      });
      function openSubmenu(event){
        event.stopPropagation();
        if (submenu.contains(document.activeElement)) return;
        submenu.parentElement.classList.add("active");
        var navigable = getNavigableElements(submenu,true);
        window.setTimeout(function(){
          navigable[0].focus();
        },50);
      }
    });
    options.forEach(function(option){
      option.addEventListener("click",function(){
        if (option.querySelector(":scope > ul") != null) return;
        if (dropdown == contextMenu){
          closeContextMenu();
        } else closeDropdown(dropdown);
      });
      option.addEventListener("keydown",function(event){
        if (option.querySelector(":scope > ul") != null) return;
        if (event.key == "Enter" || event.key == " "){
          event.preventDefault();
          event.stopPropagation();
          option.click();
          if (button) button.focus();
        }
        if (!dropdown.parentElement.classList.contains("select")) return;
        if (event.key == "Escape" || event.key == "Tab"){
          event.preventDefault();
          event.stopPropagation();
          closeDropdown(dropdown);
          button.focus();
        }
      });
      option.addEventListener("mouseenter",function(){
        submenus.forEach(function(submenu){
          if (option == submenu.parentElement || submenu.contains(option) || submenu.contains(document.activeElement)) return;
          submenu.parentElement.classList.remove("active");
        });
      });
      if (option.tagName.toLowerCase() != "a") option.setAttribute("tabindex","0");
    });
  });
  var checkboxes = Array.from(document.getElementsByClassName("checkbox"));
  checkboxes.forEach(function(checkbox){
    checkbox.addEventListener("click",function(){
      input.click();
    });
    checkbox.addEventListener("keydown",function(event){
      if (event.key == "Enter" || event.key == " "){
        event.preventDefault();
        input.click();
      }
    });
    checkbox.setAttribute("tabindex","0");
    checkbox.setAttribute("aria-label","Checkbox");
    var input = checkbox.querySelector("input[type='checkbox']");
    input.addEventListener("click",function(event){
      event.stopPropagation();
    });
  });
  var cards = Array.from(document.getElementsByClassName("card"));
  cards.forEach(function(card){
    var backButton = card.querySelector("button.nav.back");
    if (backButton != null){
      backButton.addEventListener("click",function(){
        openCard(document.getElementById(backButton.getAttribute("data-parent")),card.id);
      });
      backButton.setAttribute("aria-label","Back");
    }
    var minimizeButton = card.querySelector("button.nav.minimize");
    if (minimizeButton != null){
      minimizeButton.addEventListener("click",function(){
        minimizeCard(card);
      });
      minimizeButton.addEventListener("keydown",function(event){
        if (event.key != "Enter") return;
        event.preventDefault();
        if (event.repeat) return;
        minimizeButton.click();
      });
      minimizeButton.setAttribute("aria-label","Minimize");
    }
    var closeButton = card.querySelector("button.nav.close");
    if (closeButton != null){
      closeButton.addEventListener("click",function(){
        closeCard(closeButton.parentElement.parentElement);
      });
      closeButton.setAttribute("aria-label","Close");
    }
    var navigable = getNavigableElements(card);
    card.addEventListener("keydown",function(event){
      if (!card.classList.contains("modal")) return;
      if (event.key == "Tab"){
        if (event.shiftKey){
          if (document.activeElement == navigable[0]){
            event.preventDefault();
            navigable[navigable.length - 1].focus();
          }
        } else if (document.activeElement == navigable[navigable.length - 1]){
          event.preventDefault();
          navigable[0].focus();
        }
      }
    });
  });
  var themeChannels = Array.from(theme.querySelectorAll("input[type='range']"));
  themeChannels.forEach(function(themeChannel){
    var label = themeChannel.parentElement.querySelector(`label[for="${themeChannel.id}"]`);
    themeChannel.addEventListener("input",function(){
      label.setAttribute("data-tooltip",themeChannel.getAttribute("data-display").split("#value").join(themeChannel.value));
    });
    themeChannel.addEventListener("mouseenter",function(){
      label.classList.add("focused");
    });
    themeChannel.addEventListener("mouseout",function(){
      if (document.activeElement != themeChannel) label.classList.remove("focused");
    });
    themeChannel.addEventListener("focus",function(){
      label.classList.add("focused");
    });
    themeChannel.addEventListener("blur",function(){
      label.classList.remove("focused");
    });
    label.setAttribute("data-tooltip",themeChannel.getAttribute("data-display").split("#value").join(themeChannel.value));
  });
  var pickerChannels = Array.from(picker.querySelectorAll("input[type='range']"));
  pickerChannels.forEach(function(pickerChannel){
    pickerChannel.addEventListener("input",channelRefresh);
    pickerChannel.min = "0";
    pickerChannel.max = "255";
  });
  files.addEventListener("dragover",function(event){
    event.preventDefault();
    files.classList.add("drag");
    event.dataTransfer.dropEffect = "copy";
  });
  files.addEventListener("dragleave",function(){
    files.classList.remove("drag");
  });
  files.addEventListener("drop",function(event){
    event.preventDefault();
    files.classList.remove("drag");
    if (event.dataTransfer.types.includes("Files")){
      var dataTransferFiles = Array.from(event.dataTransfer.files);
      dataTransferFiles.forEach(function(file){
        var reader = new FileReader();
        reader.readAsText(file,"UTF-8");
        reader.addEventListener("loadend",function(){
          createFile(file.name,reader.result);
        });
      });
    } else createFile(undefined,event.dataTransfer.getData("text"));
  });
  scaler.addEventListener("touchstart",function(){
    toggleScaling();
    document.addEventListener("touchmove",setScaling,{ passive: true });
    document.addEventListener("touchend",removeScaling,{ passive: true });
  },{ passive: true });
  scaler.addEventListener("mousedown",function(){
    toggleScaling();
    document.addEventListener("mousemove",setScaling);
    document.addEventListener("mouseup",removeScaling);
  });
  backdrop.addEventListener("click",function(){
    closeCard(editor.active_modal);
  });
  primaryHueSetting.addEventListener("input",function(){
    tempReducedMotion();
    document.documentElement.style.setProperty("--primary-hue",primaryHueSetting.value);
    themeColor.content = getElementStyle(document.documentElement,"--container-dark");
    updateSetting("primaryHue",primaryHueSetting.value);
  });
  primarySatSetting.addEventListener("input",function(){
    tempReducedMotion();
    document.documentElement.style.setProperty("--primary-sat",`${primarySatSetting.value}%`);
    themeColor.content = getElementStyle(document.documentElement,"--container-dark");
    updateSetting("primarySat",primarySatSetting.value);
  });
  dragHueSetting.addEventListener("input",function(){
    tempReducedMotion();
    document.documentElement.style.setProperty("--textarea-drag-hue",dragHueSetting.value);
    updateSetting("dragHue",dragHueSetting.value);
  });
  dragHueSetting.addEventListener("focus",function(){
    getCurrentEditor().parentElement.classList.add("drag");
  });
  dragHueSetting.addEventListener("blur",function(){
    getCurrentEditor().parentElement.classList.remove("drag");
  });
  codeColorSetting.addEventListener("input",function(){
    tempReducedMotion();
    document.documentElement.style.setProperty("--textarea-code-color",codeColorSetting.value);
    updateSetting("codeColor",codeColorSetting.value);
  });
  pickerInput.addEventListener("input",function(){
    pickerInputRefresh();
    if (editor.insert_color){
      textEdit("insert",editor.picker_color,true);
      pickerInput.focus();
    }
  });
  function createFile(name,value){
    var identifier = Math.random(), tab = document.createElement("button"), container = document.createElement("div");
    container.setAttribute("data-identifier",identifier);
    container.setAttribute("data-numbered-container",true);
    var textarea = document.createElement("textarea");
    textarea.placeholder = "Welcome to Smart Text Editor, the text editor that requires only a browser and a keyboard!";
    textarea.addEventListener("input",function(){
      sourceChange = true;
      if (!tab.hasAttribute("data-unsaved")) tab.setAttribute("data-unsaved",true);
      if (editor.view == "split" || editor.view == "preview") previewRefresh();
    });
    textarea.addEventListener("click",function(){
      if (editor.insert_color) editor.insert_color = false;
    });
    container.appendChild(textarea);
    workspace.appendChild(container);
    if (!name) name = "Untitled.txt";
    if (value) textarea.value = value;
    addInputCharacteristics(textarea);
    establishNumberedContainer(container);
    if (editor.view == "text") disableLineCount(textarea);
    tab.classList.add("tab");
    tab.setAttribute("data-identifier",identifier);
    var fileName = document.createElement("span");
    fileName.innerText = name;
    fileName.setAttribute("data-file-name",true);
    tab.appendChild(fileName);
    var renameButton = document.createElement("button");
    renameButton.innerHTML = "<svg><use href='#rename'/></svg>";
    renameButton.addEventListener("click",function(event){
      event.stopPropagation();
      var newFileName = prompt(`Enter a new file name for "${fileName.innerText}"`,fileName.innerText);
      if (!newFileName) return;
      fileName.innerText = `${newFileName}`;
      if (tab == getCurrentTab()) titleRefresh(newFileName);
    });
    tab.appendChild(renameButton);
    var closeButton = document.createElement("button");
    closeButton.innerHTML = "<svg><use href='#close'/></svg>";
    closeButton.addEventListener("click",function(event){
      event.stopPropagation();
      closeFile(tab);
    });
    tab.appendChild(closeButton);
    files.appendChild(tab);
    tab.addEventListener("click",function(){
      if (!tab.classList.contains("active")) openFile(tab);
    });
    tab.addEventListener("dragover",function(event){
      event.preventDefault();
      event.stopPropagation();
      tab.classList.add("drag");
      event.dataTransfer.dropEffect = "copy";
      if (!tab.classList.contains("active")) openFile(tab);
    });
    tab.addEventListener("dragleave",function(){
      tab.classList.remove("drag");
    });
    tab.addEventListener("drop",function(event){
      event.preventDefault();
      event.stopPropagation();
      tab.classList.remove("drag");
    });
    var withinEditor = (document.activeElement == getCurrentEditor());
    openFile(tab);
    if (withinEditor) getCurrentEditor().focus();
    return identifier;
  }
  function openFile(tab){
    var identifier = tab.getAttribute("data-identifier"), tabs = Array.from(files.querySelectorAll("button.tab"));
    tabs.forEach(function(tab){
      tab.classList.remove("active");
      tab.classList.remove("fade");
    });
    tab.classList.add("active");
    var transitionDuration = parseInt(getElementStyle(tab,"transition-duration").split("s").join("") * 1000);
    window.setTimeout(function(){
      tab.classList.add("fade");
    },transitionDuration);
    var activeFiles = Array.from(workspace.querySelectorAll("[data-numbered-container].active"));
    activeFiles.forEach(function(activeFile){
      activeFile.classList.remove("active");
    });
    var container = workspace.querySelector(`[data-numbered-container][data-identifier="${identifier}"]`);
    container.classList.add("active");
    setFileTabVisibility(tab);
    forceRefresh();
    titleRefresh(tab.querySelector("[data-file-name]").innerText);
  }
  function closeFile(tab){
    if (tab.hasAttribute("data-unsaved")){
      var ask = confirm(`Are you sure you would like to close "${getFileName(undefined,tab)}"?\nRecent changes have not yet been saved.`);
      if (!ask) return;
    }
    var identifier = tab.getAttribute("data-identifier"), tabs = Array.from(files.querySelectorAll("button.tab")), withinEditor = (document.activeElement == getCurrentEditor());
    if (tab == tabs[0] && tabs[1] && tab.classList.contains("active")) openFile(tabs[1]);
    if (tab == tabs[tabs.length - 1] && tab != tabs[0] && tab.classList.contains("active")) openFile(tabs[tabs.length - 2]);
    if (tab != tabs[0] && tab.classList.contains("active")) openFile(tabs[tabs.indexOf(tab) + 1]);
    if (withinEditor) getCurrentEditor().focus();
    files.removeChild(tab);
    var container = workspace.querySelector(`[data-numbered-container][data-identifier="${identifier}"]`);
    workspace.removeChild(container);
    if (editor.files[identifier]) delete editor.files[identifier];
  }
  function setFileTabVisibility(tab){
    var obstructedLeft = (tab.offsetLeft <= files.scrollLeft), obstructedRight = (tab.offsetLeft + tab.clientWidth >= files.scrollLeft + files.clientWidth);
    if (!obstructedLeft && !obstructedRight) return;
    var spacingOffset = 0;
    if (obstructedLeft){
      if (!tab.previousElementSibling){
        spacingOffset = parseInt(getElementStyle(files,"padding-left").split("px").join(""));
      } else spacingOffset = parseInt(getElementStyle(tab,"margin-left").split("px").join("") * 2);
      files.scrollTo(tab.offsetLeft - spacingOffset,0);
    }
    if (obstructedRight){
      if (tab.nextElementSibling){
        spacingOffset = parseInt(getElementStyle(tab.nextElementSibling,"margin-left").split("px").join("") * 2);
      } else spacingOffset = parseInt(getElementStyle(tab,"::before","width").split("px").join(""));
      files.scrollTo(tab.offsetLeft + tab.clientWidth + spacingOffset - files.clientWidth,0);
    }
  }
  function setFilesSectionOffset(){
    if (editor.view != "split" || editor.orientation != "vertical" || !editor.active_widget && !editor.active_editing_tools) return;
    var overflowOverlap, scalingOffset = parseInt(main.getAttribute("data-scaling-offset"));
    if (!scalingOffset) return main.classList.remove("files-offset");
    if (editor.active_editing_tools) overflowOverlap = parseInt(getElementStyle(editingTools,"width").split("px").join("")) + parseInt(getElementStyle(editingTools,"margin").split("px").join("")) + scalingOffset > parseInt(getElementStyle(main,"width").split("px").join(""));
    if (editor.active_widget && !editor.active_widget.classList.contains("minimize") && !editor.active_editing_tools) overflowOverlap = parseInt(getElementStyle(editor.active_widget,"width").split("px").join("")) + parseInt(getElementStyle(editor.active_widget,"margin").split("px").join("")) + scalingOffset > parseInt(getElementStyle(main,"width").split("px").join(""));
    if (overflowOverlap){
      main.classList.add("files-offset");
    } else main.classList.remove("files-offset");
  }
  function getCurrentEditor(){
    return workspace.querySelector("[data-numbered-container].active textarea");
  }
  function getCurrentTab(){
    return files.querySelector("button.tab.active");
  }
  function getFileName(result,tab){
    if (!tab) tab = getCurrentTab();
    var fileName = tab.textContent;
    if (!result) return fileName;
    if (result == "name"){
      var name = getFileName().split(".");
      name.pop();
      return name.join(".");
    }
    if (result == "extension") return fileName.split(".").pop();
  }
  function titleRefresh(value){
    document.title = `${value} - Smart Text Editor`;
  }
  function installApp(){
    editor.install_prompt.prompt();
    editor.install_prompt.userChoice.then(function(result){
      if (result.outcome == "accepted"){
        installOption.classList.add("hidden");
        installButton.classList.add("hidden");
      }
    });
  }
  function loadSettings(input){
    if (!parentWindow) return;
    var savedView = editor.storage.getItem("view");
    if (savedView){
      if (input == "initial") changeView(savedView);
      updateSelect("view",savedView);
    }
    var savedOrientation = editor.storage.getItem("orientation");
    if (savedOrientation){
      if (input == "initial") changeOrientation(savedOrientation);
      updateSelect("orientation",savedOrientation);
    }
    var savedEditingTools = editor.storage.getItem("editingTools");
    if (savedEditingTools){
      if (input == "initial"){
        if (savedEditingTools == "true") openCard(editingTools);
      }
      updateCheckbox("editingTools",savedEditingTools);
    }
    var savedRefresh = editor.storage.getItem("refresh");
    if (savedRefresh){
      editor.refresh = savedRefresh;
      if (editor.refresh == "true") previewRefresh();
      updateCheckbox("refresh",savedRefresh);
    }
    var savedResponsive = editor.storage.getItem("responsive");
    if (savedResponsive){
      if (savedResponsive == "true") viewport.content = "width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no";
      if (savedResponsive == "false") viewport.content = "user-scalable=no";
      editor.responsive = savedResponsive;
      updateCheckbox("responsive",savedResponsive);
    }
  }
  function resetSettings(){
    var ask = confirm("Are you sure you want to reset all settings?\nThis cannot be undone.");
    if (!ask) return;
    closeCard(reset);
    window.setTimeout(function(){
      updateSelect("view","text");
      updateSelect("orientation","horizontal");
      updateSelect("editingTools","no");
      editor.refresh = "true";
      updateCheckbox("refresh","true");
      editor.responsive = "true";
      updateCheckbox("responsive","true");
      viewport.content = "width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no";
      resetTheme();
      editor.storage.clear();
    },50);
    openCard(reset);
  }
  function updateSetting(item,value){
    editor.storage.setItem(item,value);
  }
  function updateSelect(item,value){
    updateSetting(item,value);
    var settingButton = document.getElementById(`${item}Setting`);
    settingButton.innerHTML = settingButton.innerHTML.replace(settingButton.textContent,updateCapitalization(value));
  }
  function updateCheckbox(item,value){
    if (value == undefined){
      value = document.getElementById(`${item}Setting`).checked;
    } else {
      if (value == "true") document.getElementById(`${item}Setting`).checked = "true";
      if (value == "false") document.getElementById(`${item}Setting`).removeAttribute("checked");
    }
    updateSetting(item,value);
  }
  function updateCapitalization(value){
    return value.charAt(0).toUpperCase() + value.slice(1);
  }
  function clearCache(){
    var ask = confirm("Are you sure you want to clear all cache?\nThis site will no longer work offline.");
    if (!ask) return;
    navigator.serviceWorker.controller.postMessage({
      action: "clear-cache"
    });
  }
  function loadTheme(){
    if (!parentWindow) return;
    var savedPrimaryHue = editor.storage.getItem("primaryHue");
    if (savedPrimaryHue){
      document.documentElement.style.setProperty("--primary-hue",savedPrimaryHue);
      themeColor.content = getElementStyle(document.documentElement,"--container-dark");
      primaryHueSetting.value = parseInt(savedPrimaryHue);
      var label = primaryHueSetting.parentElement.querySelector("label[for='primaryHueSetting']");
      label.setAttribute("data-tooltip",primaryHueSetting.getAttribute("data-display").split("#value").join(primaryHueSetting.value));
    }
    var savedPrimarySat = editor.storage.getItem("primarySat");
    if (savedPrimarySat){
      document.documentElement.style.setProperty("--primary-sat",`${savedPrimarySat}%`);
      themeColor.content = getElementStyle(document.documentElement,"--container-dark");
      primarySatSetting.value = parseInt(savedPrimarySat);
      var label = primarySatSetting.parentElement.querySelector("label[for='primarySatSetting']");
      label.setAttribute("data-tooltip",primarySatSetting.getAttribute("data-display").split("#value").join(primarySatSetting.value));
    }
    var savedDragHue = editor.storage.getItem("dragHue");
    if (savedDragHue){
      document.documentElement.style.setProperty("--textarea-drag-hue",savedDragHue);
      dragHueSetting.value = savedDragHue;
      var label = dragHueSetting.parentElement.querySelector("label[for='dragHueSetting']");
      label.setAttribute("data-tooltip",dragHueSetting.getAttribute("data-display").split("#value").join(dragHueSetting.value));
    }
    var savedCodeColor = editor.storage.getItem("codeColor");
    if (savedCodeColor){
      document.documentElement.style.setProperty("--textarea-code-color",savedCodeColor);
      codeColorSetting.value = savedCodeColor;
    }
  }
  function resetTheme(){
    tempReducedMotion();
    document.documentElement.style.removeProperty("--primary-hue");
    document.documentElement.style.removeProperty("--primary-sat");
    document.documentElement.style.removeProperty("--textarea-drag-hue");
    document.documentElement.style.removeProperty("--textarea-code-color");
    themeColor.content = getElementStyle(document.documentElement,"--container-dark");
    primaryHueSetting.value = 0;
    primarySatSetting.value = 0;
    dragHueSetting.value = 240;
    codeColorSetting.value = "";
    themeChannels.forEach(function(themeChannel){
      var label = themeChannel.parentElement.querySelector(`label[for="${themeChannel.id}"]`);
      label.setAttribute("data-tooltip",themeChannel.getAttribute("data-display").split("#value").join(themeChannel.value));
    });
    editor.storage.removeItem("primaryHue");
    editor.storage.removeItem("primarySat");
    editor.storage.removeItem("dragHue");
    editor.storage.removeItem("codeColor");
  }
  function tempReducedMotion(){
    document.documentElement.classList.add("reduced-motion");
    window.setTimeout(function(){
      document.documentElement.classList.remove("reduced-motion");
    },500);
  }
  function setOffsetOrientation(){
    document.body.classList.remove("camera-left");
    document.body.classList.remove("camera-right");
    var angle = window.orientation;
    if (angle == 90) document.body.classList.add("camera-left");
    if (angle == -90) document.body.classList.add("camera-right");
  }
  function addInputCharacteristics(input){
    input.spellcheck = false;
    input.autocomplete = "off";
    input.autocapitalize = "off";
    input.setAttribute("autocorrect","off");
    if (input.tagName.toLowerCase() == "input"){
      input.addEventListener("mousedown",function(event){
        if (event.button == "2") event.preventDefault();
      });
      input.addEventListener("contextmenu",function(event){
        openContextMenu(event,"editing");
      });
      input.addEventListener("touchstart",function(event){
        editor.long_touch = window.setTimeout(function(){
          openContextMenu(event,"editing");
        },750);
      });
      input.addEventListener("touchmove",cancelLongTouch);
      input.addEventListener("touchend",cancelLongTouch);
    }
    if (input.tagName.toLowerCase() == "textarea"){
      var container = input.parentElement;
      container.addEventListener("mousedown",function(event){
        if (event.button == "2") event.preventDefault();
      });
      container.addEventListener("contextmenu",function(event){
        openContextMenu(event,"editing");
      });
      container.addEventListener("touchstart",function(event){
        editor.long_touch = window.setTimeout(function(){
          openContextMenu(event,"editing");
        },750);
      });
      container.addEventListener("touchmove",cancelLongTouch);
      container.addEventListener("touchend",cancelLongTouch);
      container.addEventListener("dragover",function(event){
        container.classList.add("drag");
        event.dataTransfer.dropEffect = "copy";
      });
      container.addEventListener("dragleave",function(){
        container.classList.remove("drag");
      });
      container.addEventListener("drop",function(event){
        container.classList.remove("drag");
        if (!event.dataTransfer.types.includes("Files")) return updateLineCount(input);
        event.preventDefault();
        var reader = new FileReader();
        reader.readAsText(event.dataTransfer.files[0],"UTF-8");
        reader.addEventListener("loadend",function(){
          changeTextarea(input,reader.result);
          input.scrollTop = 0;
        });
      });
    }
  }
  function addQueryParameters(queryEntries){
    var queryParameters = new URLSearchParams(window.location.search);
    queryEntries.forEach(function(queryEntry){
      queryParameters.set(queryEntry,true);
    });
    changeQueryParameters(queryParameters);
  }
  function removeQueryParameters(queryEntries){
    var queryParameters = new URLSearchParams(window.location.search);
    queryEntries.forEach(function(queryEntry){
      queryParameters.delete(queryEntry);
    });
    changeQueryParameters(queryParameters);
  }
  function changeQueryParameters(queryParameters){
    var queryString = queryParameters.toString();
    if (queryString) queryString = "?" + queryString;
    var completeAddress = window.location.pathname + queryString;
    history.pushState(null,"",completeAddress);
  }
  function changeView(newView){
    if (main.classList.contains("resize")) return;
    if (newView != "preview") workspace.addEventListener("transitionend",setViewVisibility);
    var elements = [main,workspace,scaler,preview];
    elements.forEach(function(element){
      changeClass(element,editor.view,newView);
    });
    if (main.hasAttribute("data-scaling-offset")) main.removeAttribute("data-scaling-offset");
    if (main.classList.contains("files-offset")) main.classList.remove("files-offset");
    if (newView == "text" || newView == "code"){
      undoTool.disabled = false;
      redoTool.disabled = false;
      refreshTool.disabled = true;
    }
    if (newView == "text"){
      Array.from(textareas).forEach(function(textarea){
        disableLineCount(textarea);
      });
    }
    if (newView != "text"){
      Array.from(textareas).forEach(function(textarea){
        enableLineCount(textarea);
      });
    }
    if (newView == "split"){
      undoTool.disabled = false;
      redoTool.disabled = false;
      refreshTool.disabled = false;
    }
    if (newView == "preview"){
      undoTool.disabled = true;
      redoTool.disabled = true;
      refreshTool.disabled = false;
    }
    editor.view = newView;
    previewRefresh();
    function setViewVisibility(){
      workspace.removeEventListener("transitionend",setViewVisibility);
      setFileTabVisibility(getCurrentTab());
      setFilesSectionOffset();
    }
  }
  function changeOrientation(newOrientation){
    if (main.classList.contains("resize")) return;
    var elements = [main,workspace,scaler,preview];
    if (!newOrientation){
      if (editor.orientation == "horizontal"){
        newOrientation = "vertical";
      } else newOrientation = "horizontal";
      var transitionDuration;
      if (editor.view == "split" || editor.view == "preview"){
        changeView("code");
        transitionDuration = parseInt(getElementStyle(workspace,"transition-duration").split("s").join("") * 1000);
      } else transitionDuration = 0;
      window.setTimeout(function(){
        elements.forEach(function(element){
          changeClass(element,editor.orientation,newOrientation);
        });
        scaler.style.transition = "none";
        preview.style.transition = "none";
        editor.orientation = newOrientation;
        window.setTimeout(function(){
          changeView("split");
        },25);
      },transitionDuration);
    } else {
      elements.forEach(function(element){
        changeClass(element,editor.orientation,newOrientation);
      });
      editor.orientation = newOrientation;
    }
  }
  function changeClass(element,style,newStyle){
    element.classList.remove(style);
    element.removeAttribute("style");
    element.classList.add(newStyle);
  }
  function getNavigableElements(container,scope){
    var navigable;
    if (scope){
      navigable = Array.from(container.querySelectorAll(":scope > button:not([disabled]), :scope > textarea:not([disabled]), :scope > input:not([disabled]), :scope > select:not([disabled]), :scope > a[href]:not([disabled]), :scope > [tabindex]:not([tabindex='-1'])"));
    } else navigable = Array.from(container.querySelectorAll("button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), a[href]:not([disabled]), [tabindex]:not([tabindex='-1'])"));
    return navigable.filter(element => (getElementStyle(element,"display") != "none"));
  }
  function getElementStyle(element,pseudo,property){
    if (!property){
      property = pseudo;
      pseudo = null;
    }
    return window.getComputedStyle(element,pseudo).getPropertyValue(property);
  }
  function confirmOverwrite(action,event){
    if (getCurrentTab().hasAttribute("data-unsaved")){
      var ask = confirm("Changes you made may not be saved.");
      if (!ask) return;
      action(event);
      closeCard(editor.active_modal);
    } else {
      action(event);
      closeCard(editor.active_modal);
    }
  }
  function changeTextarea(textarea,value){
    textarea.value = value;
    updateLineCount(textarea);
  }
  function openEditorWindow(){
    var windowFeatures = "", standalone = (window.matchMedia("(display-mode: standalone)").matches || "standalone" in navigator || !window.menubar.visible), hiddenChrome = (window.outerWidth == window.innerWidth && window.outerHeight == window.innerHeight), fullscreen = (window.matchMedia("(display-mode: fullscreen)").matches || (!window.screenY && !window.screenTop && hiddenChrome) || (!window.screenY && !window.screenTop && standalone));
    if (standalone || fullscreen) windowFeatures = "popup";
    var newEditor = window.open(window.location.href,"_blank",windowFeatures);
    if (fullscreen){
      newEditor.resizeTo(window.screen.width * 2/3,window.screen.height * 2/3);
      newEditor.moveTo(window.screen.width / 6,window.screen.height / 6);
    } else if (standalone){
      newEditor.resizeTo(window.outerWidth,window.outerHeight);
      newEditor.moveTo(window.screenX,window.screenY);
    }
  }
  async function loadFiles(){
    if (!fileSystemAccess){
      var input = document.createElement("input");
      input.type = "file";
      input.multiple = true;
      input.accept = "text/*,.html,.css,.js,.json,.svg,.webmanifest,.md,.mcmeta";
      input.click();
      input.addEventListener("change",function(){
        var files = Array.from(input.files);
        files.forEach(function(file){
          var reader = new FileReader();
          reader.readAsText(file,"UTF-8");
          reader.addEventListener("loadend",function(){
            createFile(file.name,reader.result);
          });
        });
        input.value = null;
      });
    } else {
      var fileHandles;
      if ("chooseFileSystemEntries" in window){
        fileHandles = await window.chooseFileSystemEntries({
          type: "open-file",
          multiple: true,
          accepts: [
            {
              mimeTypes: ["text/*","image/svg+xml"],
              extensions: ["txt","html","css","js","json","svg","webmanifest","md","mcmeta"]
            }
          ]
        }).catch(function(error){
          return;
        });
      }
      if ("showOpenFilePicker" in window){
        fileHandles = await window.showOpenFilePicker({
          multiple: true,
          types: [
            {
              accept: {
                "text/*": [".txt",".html",".css",".js",".json",".webmanifest",".md",".mcmeta"],
                "image/svg+xml": [".svg"]
              }
            }
          ]
        }).catch(function(error){
          return;
        });
      }
      if (!fileHandles) return;
      fileHandles.forEach(async function(fileHandle){
        var file = await fileHandle.getFile(), identifier = createFile(await file.name,await file.text());
        editor.files[identifier] = await fileHandle;
      });
    }
  }
  async function saveFile(extension){
    if (!fileSystemAccess || extension){
      var blob = new Blob([getCurrentEditor().value],{
        type: "text/plain"
      }), save = document.createElement("a");
      save.href = window.URL.createObjectURL(blob);
      if (!extension){
        save.download = getFileName();
      } else save.download = `${getFileName("name")}.${extension}`;
      save.click();
    } else {
      var identifier = getCurrentTab().getAttribute("data-identifier"), fileHandle;
      if (!editor.files[identifier]){
        if ("chooseFileSystemEntries" in window){
          fileHandle = await window.chooseFileSystemEntries().catch(function(error){
            return;
          });
        }
        if ("showOpenFilePicker" in window){
          fileHandle = await window.showSaveFilePicker().catch(function(error){
            return;
          });
        }
        if (!fileHandle) return;
        editor.files[identifier] = await fileHandle;
      }
      var writable = await editor.files[identifier].createWritable().catch(function(error){
        alert(`"${getFileName()}" could not be saved.`);
      });
      if (!writable) return;
      await writable.write(getCurrentEditor().value);
      await writable.close();
    }
    getCurrentTab().removeAttribute("data-unsaved");
    forceRefresh();
  }
  function openDisplay(){
    var windowFeatures = "", standalone = (window.matchMedia("(display-mode: standalone)").matches || "standalone" in navigator || !window.menubar.visible), hiddenChrome = (window.outerWidth == window.innerWidth && window.outerHeight == window.innerHeight), fullscreen = (window.matchMedia("(display-mode: fullscreen)").matches || (!window.screenY && !window.screenTop && hiddenChrome) || (!window.screenY && !window.screenTop && standalone));
    if (standalone || fullscreen) windowFeatures = "popup";
    var display = window.open("","_blank",windowFeatures);
    if (standalone || fullscreen){
      display.resizeTo(window.screen.width * 2/3,window.screen.height * 2/3);
      display.moveTo(window.screen.width / 6,window.screen.height / 6);
    }
    display.document.open();
    display.document.write(getCurrentEditor().value);
    display.document.close();
  }
  function textEdit(type,text,focus,textarea){
    if (!textarea) textarea = getCurrentEditor();
    var cursor = textarea.selectionStart;
    if (focus) textarea.focus();
    if (type == "insert"){
      textarea.setRangeText(text);
      textarea.setSelectionRange(cursor,cursor + text.length);
    }
    if (type == "delete"){
      textarea.setSelectionRange(cursor,cursor + text);
      textarea.setRangeText("");
    }
    updateLineCount(textarea);
    sourceChange = true;
    getCurrentTab().setAttribute("data-unsaved",true);
    previewRefresh();
  }
  function openCard(card,previous){
    if (!card) return;
    if (card.classList.contains("active")) return closeCard(card);
    var cardType = card.classList[1];
    if (cardType != "notification"){
      var activeCards = Array.from(document.querySelectorAll(".card.active"));
      activeCards.forEach(function(activeCard){
        var activeCardType = activeCard.classList[1];
        if (activeCardType == cardType || activeCardType == "modal"){
          activeCard.classList.remove("active");
          if (!activeCard.classList.contains("minimize")) return;
          var transitionDuration = parseInt(getElementStyle(activeCard,"transition-duration").split("s").join("") * 1000);
          window.setTimeout(function(){
            minimizeCard(activeCard);
          },transitionDuration);
        }
      });
    }
    card.classList.add("active");
    if (cardType != ("notification" || "modal")) backdrop.classList.remove("active");
    if (cardType == "notification"){
      window.setTimeout(function(){
        closeCard(card);
      },4000);
    }
    if (card == editingTools) editor.active_editing_tools = true;
    if (cardType == "modal"){
      document.body.addEventListener("keydown",catchCardNavigation);
      backdrop.classList.add("active");
      if (!editor.active_modal && !editor.modal_previous){
        var dropdownChild = (document.activeElement.closest(".dropdown"));
        if (dropdownChild){
          editor.modal_previous = document.activeElement.closest(".dropdown").querySelector("button");
        } else editor.modal_previous = document.activeElement;
      }
      var activeDropdowns = Array.from(document.querySelectorAll(".dropdown.active"));
      if (activeDropdowns){
        activeDropdowns.forEach(function(activeDropdown){
          if (activeDropdown == contextMenu){
            closeContextMenu();
          } else closeDropdown(activeDropdown);
        });
      }
      var transitionDuration = parseInt(getElementStyle(card,"transition-duration").split("s").join("") * 500);
      window.setTimeout(function(){
        document.activeElement.blur();
        var previousElement = card.querySelector(`[data-previous="${previous}"]`);
        if (previousElement) previousElement.focus();
      },transitionDuration);
      editor.active_modal = card;
    }
    if (cardType == "widget") editor.active_widget = card;
    setFilesSectionOffset();
  }
  function closeCard(card){
    if (!card) return;
    var cardType = card.classList[1];
    card.classList.remove("active");
    if (card.classList.contains("minimize")){
      var transitionDuration = parseInt(getElementStyle(card,"transition-duration").split("s").join("") * 1000);
      window.setTimeout(function(){
        minimizeCard(card);
      },transitionDuration);
    }
    if (cardType == "modal"){
      document.body.removeEventListener("keydown",catchCardNavigation);
      backdrop.classList.remove("active");
      editor.active_modal = false;
      if (editor.modal_previous){
        if (workspace.contains(editor.modal_previous) && getElementStyle(editor.modal_previous,"visibility") == "hidden"){
          getCurrentEditor().focus();
        } else editor.modal_previous.focus();
        editor.modal_previous = null;
      }
    }
    if (card == editingTools) editor.active_editing_tools = false;
    if (cardType == "widget") editor.active_widget = false;
    if (card == settings) loadSettings();
    if (card == theme) loadTheme();
    setFilesSectionOffset();
  }
  function minimizeCard(card){
    card.classList.toggle("minimize");
    var minimizeButton = card.querySelector("button.nav.minimize");
    var minimizeButtonIcon = minimizeButton.querySelector("svg");
    var minimizeButtonIconLink = minimizeButtonIcon.querySelector("use");
    var transitionDuration = parseInt(getElementStyle(minimizeButtonIcon,"transition-duration").split(" ")[1].split("s").join("") * 275);
    if (!card.classList.contains("minimize")){
      window.setTimeout(function(){
        minimizeButton.setAttribute("aria-label","Minimize");
        minimizeButtonIconLink.setAttribute("href","#minimize");
      },transitionDuration);
    } else {
      if (card.contains(document.activeElement) && document.activeElement != minimizeButton) minimizeButton.focus();
      window.setTimeout(function(){
        minimizeButton.setAttribute("aria-label","Maximize");
        minimizeButtonIconLink.setAttribute("href","#arrow");
      },transitionDuration);
    }
    setFilesSectionOffset();
  }
  function catchCardNavigation(event){
    if (!editor.active_modal || contextMenu.classList.contains("active") || event.key != "Tab" || document.activeElement != document.body) return;
    var navigable = getNavigableElements(editor.active_modal);
    if (event.shiftKey){
      event.preventDefault();
      navigable[navigable.length - 1].focus();
    } else {
      event.preventDefault();
      navigable[0].focus();
    }
  }
  function openDropdown(event,dropdown){
    if (editor.long_touch) editor.long_touch = null;
    var currentDropdown;
    if (!dropdown){
      currentDropdown = event;
    } else currentDropdown = dropdown;
    dropdowns.forEach(function(dropdown){
      if (dropdown == currentDropdown || dropdown.contains(event.target)) return;
      closeDropdown(dropdown);
    });
    currentDropdown.classList.toggle("active");
    if (currentDropdown.classList.contains("active")){
      document.body.addEventListener("click",catchDropdownExit);
      if (currentDropdown == contextMenu) document.body.addEventListener("contextmenu",catchDropdownExit);
    } else {
      document.body.removeEventListener("click",catchDropdownExit);
      if (currentDropdown == contextMenu) document.body.removeEventListener("contextmenu",catchDropdownExit);
    }
    function catchDropdownExit(){
      if (currentDropdown.contains(document.activeElement)) return;
      closeDropdown(currentDropdown);
      document.body.removeEventListener("click",catchDropdownExit);
      if (currentDropdown == contextMenu) document.body.removeEventListener("contextmenu",catchDropdownExit);
    }
  }
  function closeDropdown(dropdown){
    var submenus = Array.from(dropdown.querySelectorAll("li > ul"));
    submenus.forEach(function(submenu){
      submenu.parentElement.classList.remove("active");
    });
    dropdown.classList.remove("active");
    if (dropdown != contextMenu) return;
    var menu = dropdown.querySelectorAll("ul")[0], transitionDuration = parseInt(getElementStyle(menu,"transition-duration").split("s").join("") * 1000);
    window.setTimeout(function(){
      var types = ["window","link","editing"];
      types.forEach(function(type){
        if (dropdown.classList.contains(type)) dropdown.classList.remove(type);
      });
    },transitionDuration);
  }
  function openContextMenu(event,type){
    event.preventDefault();
    event.stopPropagation();
    if (editor.long_touch) editor.long_touch = null;
    if (contextMenu.classList.contains("active")){
      closeContextMenu();
      var menu = contextMenu.querySelectorAll("ul")[0], transitionDuration = parseInt(getElementStyle(menu,"transition-duration").split("s").join("") * 1000);
      window.setTimeout(function(){
        openContextMenu(event,type);
      },transitionDuration);
      return;
    }
    editor.context_menu_previous = event.target;
    openDropdown(event,contextMenu);
    contextMenu.classList.add(type);
    var pageLocation = {}, transformOrigin = {};
    if (touchDevice && event instanceof TouchEvent){
      pageLocation.left = event.touches[0].pageX;
      pageLocation.top = event.touches[0].pageY;
    } else {
      pageLocation.left = event.pageX;
      pageLocation.top = event.pageY;
    }
    transformOrigin.left = pageLocation.left;
    transformOrigin.top = pageLocation.top;
    var menu = contextMenu.querySelectorAll("ul")[0];
    if (pageLocation.left + menu.offsetWidth > window.innerWidth) pageLocation.left = window.innerWidth - menu.offsetWidth;
    if (pageLocation.top + menu.offsetHeight > window.innerHeight) pageLocation.top = window.innerHeight - menu.offsetHeight;
    transformOrigin.left -= pageLocation.left;
    transformOrigin.top -= pageLocation.top;
    contextMenu.style.left = `${pageLocation.left}px`;
    contextMenu.style.top = `${pageLocation.top}px`;
    menu.style.transformOrigin = `${transformOrigin.left}px ${transformOrigin.top}px`;
    document.body.addEventListener("keydown",catchContextMenuNavigation);
    var transitionDuration = parseInt(getElementStyle(menu,"transition-duration").split("s").join("") * 500);
    window.setTimeout(function(){
      document.activeElement.blur();
    },transitionDuration);
  }
  function closeContextMenu(){
    closeDropdown(contextMenu);
    editor.context_menu_previous.focus();
    editor.context_menu_previous = null;
    document.body.removeEventListener("keydown",catchContextMenuNavigation);
  }
  function catchContextMenuNavigation(event){
    event.stopPropagation();
    if (!contextMenu.classList.contains("active") || document.activeElement != document.body) return;
    var navigable = getNavigableElements(contextMenu);
    if (event.key == "Tab") event.preventDefault();
    if (event.key == "ArrowUp"){
      event.preventDefault();
      navigable[navigable.length - 1].focus();
    }
    if (event.key == "ArrowDown"){
      event.preventDefault();
      navigable[0].focus();
    }
  }
  function cancelLongTouch(){
    if (!editor.long_touch) return;
    window.clearTimeout(editor.long_touch);
    editor.long_touch = null;
  }
  function toggleLoadingOverlay(){
    loading.classList.toggle("active");
    var buffering = loading.querySelector("svg");
    if (loading.classList.contains("active")){
      buffering.classList.add("active");
    } else {
      var transitionDuration = parseInt(getElementStyle(loading,"transition-duration").split("s").join("") * 1000);
      window.setTimeout(function(){
        if (loading.classList.contains("active")) return;
        buffering.classList.remove("active");
      },transitionDuration);
    }
  }
  async function callCommand(element,action){
    element.focus();
    if (action == "paste"){
      var clipboardText = await navigator.clipboard.readText().catch(function(error){
        alert("Clipboard text could not be read, please check site permissions for clipboard use.");
      });
      document.execCommand("insertText",false,await clipboardText);
    } else document.execCommand(action);
    if ((action == "undo" || action == "redo" || action == "paste") && element.parentElement.hasAttribute("data-numbered-container")) updateLineCount(element);
  }
  function shareText(value){
    if (!webSharing) return;
    navigator.share({
      text: value
    });
  }
  function shareLink(anchor){
    if (!webSharing) return;
    navigator.share({
      url: anchor.href
    });
  }
  function activateReplacer(){
    changeTextarea(getCurrentEditor(),getCurrentEditor().value.split(replacerFind.value).join(replacerReplace.value));
    sourceChange = true;
    getCurrentTab().setAttribute("data-unsaved",true);
    previewRefresh();
  }
  function flipReplacer(){
    var findContent = replacerFind.value;
    changeTextarea(replacerFind,replacerReplace.value);
    changeTextarea(replacerReplace,findContent);
  }
  function clearReplacer(){
    changeTextarea(replacerFind,"");
    changeTextarea(replacerReplace,"");
  }
  function pickerInputRefresh(){
    var get = pickerInput.value.replace("#","");
    if (!(get.length == 3 || get.length == 6)) return;
    editor.picker_color = get;
    if (editor.picker_color.length == 3){
      editor.picker_color = editor.picker_color.match(/.{1}/g);
      editor.picker_color.forEach(function(item,index){
        editor.picker_color[index] = item + item;
      });
    }
    if (editor.picker_color.length == 6) editor.picker_color = editor.picker_color.match(/.{1,2}/g);
    editor.picker_color.forEach(function(item,index){
      editor.picker_color[index] = parseInt(item,16);
    });
    redChannel.value = editor.picker_color[0];
    greenChannel.value = editor.picker_color[1];
    blueChannel.value = editor.picker_color[2];
    editor.picker_color = `#${convertHex(redChannel.value)}${convertHex(greenChannel.value)}${convertHex(blueChannel.value)}`;
    pickerPreview.style.background = editor.picker_color;
  }
  function channelRefresh(){
    editor.picker_color = `#${convertHex(redChannel.value)}${convertHex(greenChannel.value)}${convertHex(blueChannel.value)}`;
    pickerPreview.style.background = editor.picker_color;
    pickerInput.value = editor.picker_color;
    if (editor.insert_color) textEdit("insert",editor.picker_color,true);
  }
  function convertHex(channel){
    var hex = parseInt(channel).toString(16);
    if (hex.length == 1) hex = 0 + hex;
    return hex;
  }
  function importColor(){
    editor.insert_color = true;
    if (!picker.classList.contains("active")) openCard(picker);
    if (window.getSelection().toString().length > 0) pickerInput.value = window.getSelection();
    pickerInput.focus();
    pickerInputRefresh();
  }
  function copyPicker(){
    pickerInput.select();
    document.execCommand("copy");
  }
  function insertPicker(){
    textEdit("insert",editor.picker_color,true);
    channelRefresh();
    editor.insert_color = true;
  }
  function deletePicker(){
    var selectionCount = getCurrentEditor().selectionEnd - getCurrentEditor().selectionStart;
    if (selectionCount) textEdit("delete",selectionCount,true);
    editor.insert_color = false;
  }
  function activateFormatter(format){
    try {
      changeTextarea(formatterInput,JSON.stringify(JSON.parse(formatterInput.value),false,format));
    } catch (error){
      alert("Invalid JSON data.");
    }
  }
  function activateEncoder(encode){
    if (componentSetting.checked){
      if (encode) changeTextarea(encoderInput,encodeURIComponent(encoderInput.value));
      if (!encode) changeTextarea(encoderInput,decodeURIComponent(encoderInput.value));
    } else {
      if (encode) changeTextarea(encoderInput,encodeURI(encoderInput.value));
      if (!encode) changeTextarea(encoderInput,decodeURI(encoderInput.value));
    }
  }
  function insertTemplate(){
    changeTextarea(getCurrentEditor(),decodeURI("%3C!DOCTYPE%20html%3E%0A%3Chtml%20lang=%22en-US%22%3E%0A%0A%3Chead%3E%0A%0A%3Ctitle%3E%3C/title%3E%0A%3Cmeta%20charset=%22UTF-8%22%3E%0A%3Cmeta%20name=%22viewport%22%20content=%22width=device-width,%20initial-scale=1%22%3E%0A%0A%3Cstyle%3E%0A%20%20*,%20*::before,%20*::after%20%7B%0A%20%20%20%20box-sizing:%20border-box;%0A%20%20%20%20font-family:%20sans-serif;%0A%20%20%7D%0A%3C/style%3E%0A%0A%3C/head%3E%0A%0A%3Cbody%3E%0A%0A%3Cscript%3E%0A%3C/script%3E%0A%0A%3C/body%3E%0A%0A%3C/html%3E"));
    sourceChange = true;
    if (editor.view == "text") changeView("code");
    if (editor.view == "preview") changeView("split");
  }
  function forceRefresh(){
    var currentSetting = editor.refresh;
    editor.refresh = "true";
    sourceChange = true;
    preview.contentWindow.location.reload();
    previewRefresh();
    editor.refresh = currentSetting;
  }
  function previewRefresh(){
    if (editor.refresh != "true" || !sourceChange) return;
    preview.src = "about:blank";
    preview.contentWindow.document.open();
    preview.contentWindow.document.write(getCurrentEditor().value);
    preview.contentWindow.document.close();
    sourceChange = false;
  }
  function toggleScaling(){
    header.classList.toggle("resize");
    main.classList.toggle("resize");
    workspace.classList.toggle("resize");
    scaler.classList.toggle("active");
    preview.classList.toggle("resize");
  }
  function setScaling(event){
    var scalingOffset, scalingRange = {};
    if (touchDevice && event instanceof TouchEvent){
      if (editor.orientation == "horizontal") scalingOffset = event.touches[0].clientY - header.offsetHeight;
      if (editor.orientation == "vertical") scalingOffset = event.touches[0].clientX;
    } else {
      if (editor.orientation == "horizontal") scalingOffset = event.clientY - header.offsetHeight;
      if (editor.orientation == "vertical") scalingOffset = event.clientX;
    }
    if (editor.orientation == "horizontal"){
      scalingRange.minimum = files.offsetHeight + 80;
      scalingRange.maximum = window.innerHeight - header.offsetHeight - 80;
    }
    if (editor.orientation == "vertical"){
      scalingRange.minimum = 80;
      scalingRange.maximum = window.innerWidth - 80;
    }
    if (scalingOffset < scalingRange.minimum) scalingOffset = scalingRange.minimum;
    if (scalingOffset > scalingRange.maximum) scalingOffset = scalingRange.maximum;
    main.setAttribute("data-scaling-offset",scalingOffset);
    if (editor.orientation == "horizontal"){
      workspace.style.height = `calc(${scalingOffset}px - 8px)`;
      scaler.style.bottom = `calc(100% - ${scalingOffset}px - 8px)`;
      preview.style.height = `calc(100% - ${scalingOffset}px - 8px)`;
    }
    if (editor.orientation == "vertical"){
      workspace.style.width = `calc(${scalingOffset}px - 8px)`;
      scaler.style.right = `calc(100% - ${scalingOffset}px - 8px)`;
      preview.style.width = `calc(100% - ${scalingOffset}px - 8px)`;
      setFilesSectionOffset();
    }
  }
  function removeScaling(event){
    if (touchDevice && event instanceof TouchEvent){
      document.removeEventListener("touchmove",setScaling);
      document.removeEventListener("touchend",removeScaling);
      toggleScaling();
    } else {
      document.removeEventListener("mousemove",setScaling);
      document.removeEventListener("mouseup",removeScaling);
      toggleScaling();
    }
  }
</script>

</body>

</html>