<!DOCTYPE html>
<html lang="en-US">

<head>

<title>Smart Text Editor</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#dddddd">
<base href="https://stedit.app" target="_blank">
<link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cousine&family=Rubik&display=swap">
<link rel="preload" as="fetch" crossorigin href="https://offroaders123.github.io/Num-Text-Component/vanilla-layout.css">
<link rel="preload" as="fetch" crossorigin href="https://offroaders123.github.io/Num-Text-Component/vanilla-appearance.css">
<link rel="preload" as="fetch" crossorigin href="https://offroaders123.github.io/Num-Text-Component/vanilla-highlighting.css">
<script src="https://offroaders123.github.io/Menu-Drop-Component/script.js"></script>
<script src="https://offroaders123.github.io/Num-Text-Component/script.js"></script>
<!--script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js" data-manual></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-json.min.js"></script-->

<script>
  const STE = {
  };
</script>

<style>
  *, *::before, *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  :root {
    --safe-area-inset-left: env(safe-area-inset-left,0px);
    --safe-area-inset-right: env(safe-area-inset-right,0px);
    --safe-area-inset-top: env(safe-area-inset-top,0px);
    --safe-area-inset-bottom: env(safe-area-inset-bottom,0px);

    --titlebar-area-inset-top: env(titlebar-area-y,0px);
    --titlebar-area-inset-left: env(titlebar-area-x,0px);
    --titlebar-area-inset-right: calc(100vw - env(titlebar-area-width,100vw) - var(--titlebar-area-inset-left));
    --titlebar-area-inset-height: env(titlebar-area-height,0px);
  }
  :root:not(.window-controls-overlay) {
    --titlebar-area-inset-left: 0px;
    --titlebar-area-inset-right: 0px;
    --titlebar-area-inset-top: 0px;
    --titlebar-area-inset-height: 0px;
  }
  html {
    width: 100%;
    height: 100%;
    background: #ffffff;
    overflow: hidden;
  }
  body {
    position: fixed;
    width: 100%;
    height: 100%;
    display: grid;
    grid-template-rows: min-content auto;
    font-family: -apple-system, BlinkMacSystemFont, "Rubik", sans-serif;
    background: inherit;
    cursor: default;
    overflow: auto;
    -webkit-user-select: none;
    user-select: none;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }
  button {
    color: inherit;
    font: inherit;
    display: flex;
    align-items: center;
    background: none;
    border: 0 solid transparent;
    border-radius: 0;
    outline: none;
  }
  a {
    display: flex;
    align-items: center;
    color: inherit;
    text-decoration: none;
  }
  img {
    -webkit-touch-callout: none;
  }
  iframe {outline: 2px solid;outline-offset: -2px;
    background: #ffffff;
    border: 0 solid transparent;
  }
  menu-drop {
    color: inherit;
    font: inherit;
    line-height: 16px;
  }
  menu-drop {
    --list-padding-x: 6px;
    --list-padding-y: 6px;
    --list-border-width: 1px;
    --option-padding-x: 8px;
    --option-padding-y: 4px;
    --option-icon-gap: 10px;
    --option-selected-icon-gap: 8px;
    --option-selected-icon-width: 5px;
  }
  menu-drop::part(opener) {
    background: none;
    border: 0 solid transparent;
    outline: none;
  }
  menu-drop::part(body) {
    font-size: 13px;
  }
  menu-drop::part(list) {
    --list-position-x: 100%;
    border: var(--list-border-width) solid transparent;
    border-radius: calc(var(--list-padding-y) + var(--list-border-width));
    box-shadow: 0 5px 10px #00000040;
    visibility: hidden;
    opacity: 0.25;
    transform: scale(0.5);
    transition-property: opacity, transform;
  }
  menu-drop::part(list left) {
    transform-origin: left calc(var(--list-position-y) * -1);
  }
  menu-drop::part(list right) {
    transform-origin: right calc(var(--list-position-y) * -1);
  }
  menu-drop::part(list main) {
    --list-position-x: 0;
    border-top: none;
    border-top-left-radius: 0;
    border-top-right-radius: 0;
    transform: scaleY(0.5);
    transform-origin: center top;
  }
  menu-drop::part(list open) {
    visibility: visible;
    opacity: 1;
    transform: scale(1);
    transition-duration: 130ms;
  }
  menu-drop::part(option) {
    --option-color-interact: #ffffff;
    text-decoration: none;
    --option-background-color-interact: #0763d5bf;
    --sub-list-option-color-interact: revert;
    --sub-list-option-background-color-interact: #0000001c;
    border: 1px solid transparent;
    border-radius: calc(var(--list-padding-y) - 2px);
  }
  menu-drop[data-select]::part(option)::before {
    content: "";
    height: var(--option-selected-icon-width);
    background: currentColor;
    -webkit-mask: var(--option-selected-icon-mask);
    mask: var(--option-selected-icon-mask);
    --option-selected-icon-mask: url("data:image/svg+xml,%3Csvg%20viewBox%3D%220%200%20512%20512%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%20%20%3Cpath%20d%3D%22m63.346%20191.15%20192.72%20192.72-63.402%2063.402-192.72-192.72z%22%2F%3E%0A%20%20%3Cpath%20d%3D%22m129.5%20383.87%20319.15-319.15%2063.402%2063.402-319.15%20319.15z%22%2F%3E%0A%3C%2Fsvg%3E");
    transform: translateX(-25%) scale(2);
    transform-origin: center;
  }
  menu-drop::part(icon) {
    width: 16px;
    aspect-ratio: 1 / 1;
  }
  menu-drop::part(shortcut) {
    font-size: 12px;
    --shortcut-opacity: 0.5;
  }
  menu-drop::part(divider) {
    opacity: 0.6;
  }
  num-text {
    --padding: 8px;
    height: unset;
    caret-color: var(--color);
    font-family: ui-monospace, "Noto Sans Mono", "Cousine", monospace;
    line-height: 1.4;
    background: var(--background);
    --background: #ffffff;
    scrollbar-color: #808080 var(--background);
  }
  num-text::part(container) {
    border-radius: inherit;
  }
  header {
    box-sizing: content-box;
    height: max(var(--titlebar-area-inset-height),34px);
    display: flex;
    gap: 8px;
    align-items: center;
    font-size: 13px;
    background: #dddddd;
    border: 0 solid transparent;
    border-top-width: calc(var(--safe-area-inset-top) + var(--titlebar-area-inset-top));
    border-bottom: 1px solid #00000060;
  }
  header::before, header::after {
    content: "";
    height: 100%;
    flex-shrink: 0;
  }
  header::before {
    width: calc(var(--safe-area-inset-left) + var(--titlebar-area-inset-left));
  }
  header::after {
    width: calc(var(--safe-area-inset-right) + var(--titlebar-area-inset-right));
  }
  app-icon {/* Cymande */
    flex-shrink: 0;
    display: flex;
  }
  app-icon img {
    width: 16px;
    aspect-ratio: 1 / 1;
  }
  app-menubar {
    min-width: 0;
    align-self: stretch;
    display: flex;
    z-index: 3;
  }
  app-menubar menu-drop {
    min-width: 0;
  }
  app-menubar menu-drop::part(opener) {
    min-width: unset;
    padding: 0 8px;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  app-menubar menu-drop::part(opener):where(:hover,:focus-visible), app-menubar menu-drop[data-open]::part(opener) {
    background: #00000014;
  }
  app-menubar menu-drop::part(list main) {
    --list-position-y: 1px;
  }
  app-omnibox {
    margin-left: auto;
    height: 100%;
    align-self: flex-start;
    flex-shrink: 0;
    display: flex;
    gap: inherit;
    align-items: center;
  }
  app-omnibox .option {
    padding: 5px;
    box-sizing: content-box;
    width: 14px;
    aspect-ratio: 1 / 1;
    border-radius: 12px;
    transition: background-color 250ms linear;
  }
  app-omnibox .option:hover {
    background-color: #00000014;
  }
  app-omnibox .option:is(:active,:focus-visible) {
    background-color: #00000022;
  }
  app-omnibox .option svg {
    width: 100%;
    height: 100%;
    flex-shrink: 0;
    fill: currentColor;
  }
  main {background: #00f4;
    display: grid;
    grid-template-rows: min-content 1fr 16px 1fr;
  }
  workspace-tabs {
    padding: 0 6px;
    padding-bottom: 1px;
    display: flex;
    box-shadow: 0 -1px 0 #00000060 inset, 0 -1px 0 #ffffff inset;
    overflow-x: auto;
    scroll-behavior: smooth;
    scrollbar-width: none;
  }
  workspace-tabs::-webkit-scrollbar {
    display: none;
  }
  workspace-tab {
    margin-right: -1px;
    margin-top: 3px;
    margin-bottom: -1px;
    padding-left: 11px;
    padding-right: 11px;
    padding-top: 5px;
    padding-bottom: 7px;
    position: relative;
    min-width: 80px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    gap: 9px;
    font-size: 13px;
    border: 0 solid transparent;
    border-width: 1px;
    border-radius: 7px 7px 0 0;
    isolation: isolate;
  }
  workspace-tab:not([open]) + workspace-tab:not([open])::before,
  workspace-tab:not([open]) + :nth-last-child(2):not([open])::before,
  workspace-tab + :nth-last-child(2):not([open])::after {
    content: "";
    position: absolute;
    right: 100%;
    width: 1px;
    height: 14px;
    background: currentColor;
    opacity: 0.5;
    pointer-events: none;
    z-index: 1;
  }
  workspace-tab + :nth-last-child(2):not([open])::after {
    left: 100%;
    right: unset;
  }
  workspace-tab[open] {
    background: #ffffff;
    border-color: #00000060;
    border-bottom-color: transparent;
  }
  workspace-tab .opener {
    position: absolute;
    inset: -1px;
    width: calc(100% + 2px);
    border-radius: inherit;
  }
  workspace-tab .closer {
    margin: 0 -6px;
    padding: 4px;
    box-sizing: content-box;
    width: 1em;
    height: 1em;
    justify-content: center;
    font-size: 10px;
    line-height: 1em;
    border-radius: 4px;
    z-index: 1;
  }
  workspace-tab .closer:hover {
    background-color: #00000024;
  }
  workspace-editors {
    display: grid;
  }
  workspace-scaler {
    display: flex;
  }
  workspace-scaler button {
    width: 100%;
    height: 100%;
    background: #808080;
    cursor: row-resize;
  }
  workspace-previews {
    display: grid;
  }
  workspace-previews iframe {
    width: 100%;
    height: 100%;
  }
  #symbol_definitions {
    display: none;
  }
</style>

</head>

<body ontouchstart>

<svg id="symbol_definitions">
  <symbol id="install_icon" viewBox="0 0 512 512">
    <path d="m198.36 18v43.917h-154.81v308.88h424.9v-75.391h43.551v66.242c-0.029 13.167-4.952 25.852-13.813 35.592-8.86 9.739-21.025 15.837-34.13 17.108l-5.123 0.366h-65.876l23.788 26.351v52.7h-321.69v-52.7l23.788-26.351h-66.241c-13.19 0.054-25.922-4.84-35.679-13.717-9.7572-8.876-15.831-21.089-17.022-34.225v-296.07c-0.053852-13.19 4.8408-25.922 13.717-35.679 8.8764-9.7572 21.089-15.831 34.226-17.022h150.42zm174.94 0v186.65l64.046-66.241 38.427 39.525-128.09 132.85-128.09-132.85 38.427-39.891 64.046 66.607v-186.65h51.236z"/>
  </symbol>
  <symbol id="refresh_icon" viewBox="0 0 512 512">
    <path d="m510.27 285.75c-13.893 118.73-108.1 212.04-226.96 224.79-118.86 12.751-230.71-58.451-269.47-171.53-38.761-113.08 5.8941-237.93 107.58-300.78 101.68-62.846 233.32-46.955 317.13 38.282l-37.067 36.446c-66.79-67.929-171.7-80.593-252.74-30.508-81.036 50.084-116.62 149.58-85.733 239.7 30.89 90.117 120.03 146.86 214.75 136.7 94.721-10.161 169.8-84.522 180.87-179.14z"/>
    <path d="m512 189.01v-189.01l-188.98 189.01z"/>
  </symbol>
  <symbol id="github_icon" viewBox="0 0 512 512">
    <path d="m255.95 6c-141.33 0-255.95 114.62-255.95 256.05 0 113.04 73.338 209.01 175.07 242.85 12.782 2.357 17.496-5.553 17.496-12.31 0-6.077-0.262-22.211-0.367-43.531-47.459 10.319-76.218-1.153-86.223-34.312-7.7532-19.748-17.235-32.216-28.445-37.454-15.506-10.582-14.877-15.768 1.7811-15.558 17.13 1.205 30.173 10.005 39.183 26.349 22.84 39.131 59.927 27.816 74.543 21.268 2.304-16.501 8.905-27.816 16.239-34.207-56.837-6.443-116.61-28.444-116.61-126.51 0-27.973 9.9529-50.812 26.349-68.727-2.619-6.444-11.419-32.478 2.515-67.733 14.3-4.557 37.768 4.191 70.404 26.245 20.377-5.658 42.326-8.487 64.065-8.591 21.739 0.104 43.636 2.933 64.118 8.591 32.583-22.054 55.998-30.802 70.299-26.245 13.986 35.255 5.186 61.289 2.567 67.733 16.396 17.915 26.297 40.754 26.297 68.727 0 98.325-59.875 119.96-116.87 126.3 9.167 7.91 17.392 23.52 17.392 47.407 0 34.259-0.315 61.865-0.315 70.247 0 6.81 4.61 14.824 17.601 12.31 101.62-33.945 174.91-129.81 174.91-242.85 0-141.44-114.67-256.05-256.05-256.05z"/>
  </symbol>
</svg>

<header>
  <app-icon>
    <img src="resources/icon.svg" alt="">
  </app-icon>
  <app-menubar>
    <menu-drop>
      <button>File</button>
      <ul>
        <li data-shortcuts='{ "default": "Ctrl+Shift+X", "macOS": "Shift+Cmd+X" }'>New File</li>
        <li data-shortcuts='{ "default": "Ctrl+Shift+C", "macOS": "Shift+Cmd+C" }'>New Window</li>
        <li><hr></li>
        <li data-shortcuts='{ "default": "Ctrl+O", "macOS": "Cmd+O" }'>Open</li>
        <li data-shortcuts='{ "default": "Ctrl+Shift+R", "macOS": "Shift+Cmd+R" }'>Rename</li>
        <li data-shortcuts='{ "default": "Ctrl+S", "macOS": "Cmd+S" }'>Save</li>
        <li data-shortcuts='{ "default": "Ctrl+Shift+S", "macOS": "Shift+Cmd+S" }'>Save As...</li>
        <li><hr></li>
        <li data-shortcuts='{ "default": "Ctrl+Shift+D", "macOS": "Shift+Cmd+D" }'>Close File</li>
        <li data-shortcuts='{ "default": "Ctrl+Shift+W", "macOS": "Shift+Cmd+W" }'>Close Window</li>
      </ul>
    </menu-drop>
    <menu-drop data-select="no-appearance">
      <button>View</button>
      <ul>
        <li data-value="code" data-selected data-shortcuts='{ "default": "Ctrl+Shift+1", "macOS": "Ctrl+Cmd+1" }'>Code</li>
        <li data-value="split" data-shortcuts='{ "default": "Ctrl+Shift+2", "macOS": "Ctrl+Cmd+2" }'>Split</li>
        <li data-value="preview" data-shortcuts='{ "default": "Ctrl+Shift+3", "macOS": "Ctrl+Cmd+3" }'>Preview</li>
        <li><hr></li>
        <li data-no-select data-shortcuts='{ "default": "Ctrl+Shift+4", "macOS": "Ctrl+Cmd+4" }'>Orientation</li>
        <li data-no-select data-shortcuts='{ "default": "Ctrl+Shift+5", "macOS": "Ctrl+Cmd+5" }'>Display</li>
      </ul>
    </menu-drop>
    <menu-drop>
      <button>Preview</button>
      <ul>
        <li></li>
      </ul>
    </menu-drop>
    <menu-drop>
      <button>Tools</button>
      <ul>
        <li></li>
      </ul>
    </menu-drop>
    <menu-drop data-alternate>
      <button>Settings</button>
    </menu-drop>
  </app-menubar>
  <app-omnibox>
    <button style="display: none;" class="option" title="Install"><svg><use href="#install_icon"/></svg></button>
    <button class="option" title="Refresh Preview"><svg><use href="#refresh_icon"/></svg></button>
    <a class="option" href="https://github.com/Offroaders123/Smart-Text-Editor" title="Smart Text Editor on GitHub"><svg><use href="#github_icon"/></svg></a>
  </app-omnibox>
</header>

<main>
  <workspace-tabs>
    <workspace-tab>File 1.html</workspace-tab>
    <workspace-tab>File 2.html</workspace-tab>
    <workspace-tab open>File 3.html</workspace-tab>
    <workspace-tab>File 4.html</workspace-tab>
    <workspace-tab>File 5.html</workspace-tab>
  </workspace-tabs>
  <workspace-editors>
    <num-text></num-text>
  </workspace-editors>
  <workspace-scaler>
    <button></button>
  </workspace-scaler>
  <workspace-previews>
    <iframe></iframe>
  </workspace-previews>
</main>

<script>console.clear();
  // Window
  window.addEventListener("blur",() => {
    //if (window.self == window.top) document.querySelectorAll("menu-drop[data-open]").forEach(menu => menu.close());
  });

  // Body
  document.body.addEventListener("mousedown",event => {
    if (event.button != 2) return;
    event.preventDefault();
    event.stopPropagation();
  });
  document.body.addEventListener("contextmenu",event => event.preventDefault());
  document.body.addEventListener("dragstart",event => {
    if (event.target.matches("img")) event.preventDefault();
  });
  document.body.addEventListener("dragover",event => {
    event.preventDefault();
    event.dataTransfer.dropEffect = (event.target.matches("menu-drop, header") || event.target.closest("menu-drop, header")) ? "none" : "copy";
  });

  // Menubar
  const menubar = document.querySelector("app-menubar");
  menubar.addEventListener("pointerover",event => {
    if (event.pointerType != "mouse") return;
    if (!menubar.querySelectorAll("menu-drop:not([data-alternate])[data-open]").length || event.target.matches("[data-alternate], [data-open]")) return;
    event.target.opener.focus();
    event.target.open();
  });

  // Omnibox
  const omnibox = document.querySelector("app-omnibox");
  omnibox.querySelectorAll(".option").forEach(option => {
    option.tabIndex = -1;
    option.addEventListener("pointerdown",event => event.preventDefault());
  });

  // NumText Elements
  const editors = document.getElementsByTagName("num-text");
  Array.from(editors).forEach(element => setEditorAppearance(element));
  function setEditorAppearance(element){
    element.themes.remove("vanilla-appearance");
  }

  // Workspace
  class WorkspaceTabElement extends HTMLElement {
    constructor(){
      super();
      this.defined = false;
    }
    connectedCallback(){
      if (this.defined || !this.isConnected) return;
      this.defined = true;
      window.requestAnimationFrame(() => {
        this.opener = document.createElement("button");
        this.opener.classList.add("opener");
        this.name = document.createElement("span");
        this.name.classList.add("name");
        this.name.textContent = this.getTextNodes(this)[0].textContent;
        this.getTextNodes(this)[0].textContent = "";
        this.closer = document.createElement("button");
        this.closer.classList.add("closer");
        this.closer.title = "Close File";
        this.closer.innerHTML = "✕";
        this.appendChild(this.opener);
        this.appendChild(this.name);
        this.appendChild(this.closer);
      });
    }
    getTextNodes(element){
      return Array.from(element.childNodes).filter(node => node.nodeType == Node.TEXT_NODE && node.textContent.replace(/\s/g,"").length);
    }
  }
  window.customElements.define("workspace-tab",WorkspaceTabElement);
</script>

</body>

</html>