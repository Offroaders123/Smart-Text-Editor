<!DOCTYPE html>
<html lang="en-US">

<head>

<title>Smart Text Editor</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<meta name="author" content="Brandon Bennett">
<meta name="description" content="The text editor that requires only a browser and a keyboard!">
<meta name="google-site-verification" content="_LrfHy7pIualH1TolkQ5b3Po0dtjYrx-QQsiXelwx20">
<meta property="og:title" content="Smart Text Editor">
<meta property="og:description" content="The text editor that requires only a browser and a keyboard!">
<meta property="og:image" content="resources/share-1200.png">
<meta property="og:url" content="https://offroaders123.github.io/Smart-Text-Editor/">
<meta name="twitter:card" content="summary_large_image">
<meta id="theme_color" name="theme-color" content="#191919">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Smart Text Editor">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="canonical" href="https://offroaders123.github.io/Smart-Text-Editor/">
<link rel="manifest" href="manifest.webmanifest">
<link rel="icon" type="image/svg+xml" href="resources/icon.svg">
<link rel="alternate icon" type="image/png" sizes="16x16" href="resources/icon-16.png">
<link rel="alternate icon" type="image/png" sizes="32x32" href="resources/icon-32.png">
<link rel="apple-touch-icon" sizes="180x180" href="resources/icon-apple-touch-icon.png">
<link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="resources/startup-iphone5-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="resources/startup-iphone5-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="resources/startup-iphone6-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="resources/startup-iphone6-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="resources/startup-iphoneplus-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="resources/startup-iphoneplus-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="resources/startup-iphonex-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="resources/startup-iphonex-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="resources/startup-iphonexr-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="resources/startup-iphonexr-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="resources/startup-iphonexsmax-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="resources/startup-iphonexsmax-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="resources/startup-ipad-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="resources/startup-ipad-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="resources/startup-ipadpro1-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="resources/startup-ipadpro1-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="resources/startup-ipadpro3-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="resources/startup-ipadpro3-portrait.png">
<link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="resources/startup-ipadpro2-landscape.png">
<link rel="apple-touch-startup-image" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="resources/startup-ipadpro2-portrait.png">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cousine&family=Noto+Sans&family=Rubik&display=swap">
<link rel="stylesheet" href="https://offroaders123.github.io/Numbered-Textarea-Plugin/styles.css">
<script src="https://offroaders123.github.io/Numbered-Textarea-Plugin/script.js"></script>

<script>
  window.Editor = {
    appearance: () => {
      var parent_window = (window.self == window.top),
          standalone = (window.matchMedia("(display-mode: standalone)").matches || "standalone" in navigator || !window.menubar.visible),
          hidden_chrome = (window.outerWidth == window.innerWidth && window.outerHeight == window.innerHeight),
          fullscreen = (window.matchMedia("(display-mode: fullscreen)").matches || (!window.screenY && !window.screenTop && hidden_chrome) || (!window.screenY && !window.screenTop && standalone));
      return { parent_window, standalone, hidden_chrome, fullscreen };
    },
    environment: () => ({
      touch_device: ("ontouchstart" in window),
      apple_device: (/(Mac|iPhone|iPad|iPod)/i.test(navigator.platform)),
      macOS_device: (/(Mac)/i.test(navigator.platform) && navigator.standalone == undefined),
      mozilla_browser: (CSS.supports("-moz-appearance: none"))
    }),
    support: () => ({
      file_system: ("chooseFileSystemEntries" in window || "showOpenFilePicker" in window),
      file_handling: ("launchQueue" in window && "LaunchParams" in window),
      web_sharing: ("share" in navigator)
    }),
    query: (identifier = Editor.active_editor) => ({
      textarea: (workspace.querySelector(`[data-numbered-container][data-identifier="${identifier}"] textarea`)),
      tab: (files.querySelector(`.tab[data-identifier="${identifier}"]`)),
      name: section => {
        if (document.querySelectorAll(`[data-identifier="${identifier}"]`).length == 0 && identifier != Editor.active_editor) return null;
        var name = files.querySelector(`.tab[data-identifier="${identifier}"]`).innerText;
        if (!section) return name;
        if (section == "name"){
          name = name.split(".");
          name.pop();
          return name.join(".");
        } else if (section == "extension") return name.split(".").pop();
      }
    }),
    view: () => document.body.getAttribute("data-view"),
    orientation: () => document.body.getAttribute("data-orientation"),
    preapproved_extensions: ["txt","html","css","js","php","json","webmanifest","xml","yaml","yml","dist","config","ini","md","markdown","mcmeta","lang","properties","uidx","material","h","fragment","vertex","fxh","hlsl","ihlsl","svg"],
    active_editor: null,
    preview_editor: null,
    file_handles: {},
    storage: window.localStorage,
    refresh: "true",
    active_editing_tools: false,
    active_dialog: false,
    dialog_previous: null,
    active_widget: false,
    context_menu_previous: null,
    long_touch: {
      timeout: null,
      selection: null
    },
    picker_color: null,
    insert_color: false,
    install_prompt: null
  };
  var sourceChange = false;
  if (Editor.appearance().parent_window) document.documentElement.classList.add("startup-fade");
  if (Editor.environment.touch_device) document.documentElement.classList.add("touch-device");
  if (Editor.environment.apple_device) document.documentElement.classList.add("apple-device");
  if (Editor.environment.macOS_device) document.documentElement.classList.add("macOS-device");
  if (Editor.support.web_sharing) document.documentElement.classList.add("web-sharing");
</script>

<style>svg, img { width: 16px; height: 16px; } #context_menu { display: none; }
  *, *::before, *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  :root {
  }
  html {
    position: fixed;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
  body {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    font-family: sans-serif;
    overflow: auto;
    user-select: none;
    -webkit-user-select: none;
  }
  header {
    position: relative;
    display: flex;
  }
  body.scaling-active header {
    pointer-events: none;
  }
  header .app-region {
    margin: var(--app-region-margin);
    --app-region-margin: 2px;
    position: absolute;
    width: calc(100% - var(--app-region-margin) * 2);
    height: calc(100% - var(--app-region-margin) * 2);
    z-index: -1;
    -webkit-app-region: drag;
  }
  header .menubar {
    display: flex;
  }
  header .menubar .menu .opener {
    background: none;
    border: none;
    outline: none;
  }
  header .window-controls {
    margin-left: auto;
    height: 100%;
    display: flex;
  }
  header .window-controls [data-control] {
    background: none;
    border: none;
    outline: none;
  }
  main {
    position: relative;
    flex-grow: 1;
  }
  main .workspace {
    position: absolute;
    left: 0;
    top: 0;
    display: flex;
    flex-direction: column;
  }
  body[data-view="code"] main .workspace {
    width: 100%;
    height: 100%;
  }
  body[data-view="split"][data-orientation="horizontal"] main .workspace {
    width: 50%;
    height: 100%;
  }
  body[data-view="split"][data-orientation="vertical"] main .workspace {
    width: 100%;
    height: 50%;
  }
  body[data-view="split"][data-orientation="horizontal"][data-scaling-offset] main .workspace {
    width: var(--scaling-offset);
  }
  body[data-view="split"][data-orientation="vertical"][data-scaling-offset] main .workspace {
    height: var(--scaling-offset);
  }
  body[data-view="preview"][data-orientation="horizontal"] main .workspace {
    width: 0%;
    height: 100%;
  }
  body[data-view="preview"][data-orientation="vertical"] main .workspace {
    width: 100%;
    height: 0%;
  }
  body.scaling-active main .workspace {
    pointer-events: none;
  }
  main .workspace .editor-tabs {
    flex-shrink: 0;
    display: flex;
    overflow-x: auto;
    scroll-behavior: smooth;
    scrollbar-width: none;
  }
  main .workspace .editor-tabs::-webkit-scrollbar {
    display: none;
  }
  main .workspace .editor {
    height: 0;
  }
  main .workspace .editor.active {
    height: 100%;
  }
  main .workspace-scaler {
    position: absolute;
    background: gray;
    touch-action: none;
    z-index: 1;
  }
  body[data-orientation="horizontal"] main .workspace-scaler {
    top: 0;
    width: 12px;
    height: 100%;
  }
  body[data-orientation="vertical"] main .workspace-scaler {
    left: 0;
    width: 100%;
    height: 12px;
  }
  body[data-view="code"][data-orientation="horizontal"] main .workspace-scaler {
    left: 0;
    transform: translateX(-100%);
  }
  body[data-view="code"][data-orientation="vertical"] main .workspace-scaler {
    top: 0;
    transform: translateY(-100%);
  }
  body[data-view="split"][data-orientation="horizontal"] main .workspace-scaler {
    left: 50%;
    transform: translateX(-50%);
  }
  body[data-view="split"][data-orientation="vertical"] main .workspace-scaler {
    top: 50%;
    transform: translateY(-50%);
  }
  body[data-view="split"][data-orientation="horizontal"][data-scaling-offset] main .workspace-scaler {
    left: var(--scaling-offset);
  }
  body[data-view="split"][data-orientation="vertical"][data-scaling-offset] main .workspace-scaler {
    top: var(--scaling-offset);
  }
  body[data-view="preview"][data-orientation="horizontal"] main .workspace-scaler {
    left: 100%;
    transform: translateX(0);
  }
  body[data-view="preview"][data-orientation="vertical"] main .workspace-scaler {
    top: 100%;
    transform: translateY(0);
  }
  main .workspace-preview {
    position: absolute;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 50%;
    background: #ffffff;
    border: none;background: lightgray;
  }
  body[data-view="code"][data-orientation="horizontal"] main .workspace-preview {
    width: 0%;
    height: 100%;
  }
  body[data-view="code"][data-orientation="vertical"] main .workspace-preview {
    width: 100%;
    height: 0%;
  }
  body[data-view="split"][data-orientation="horizontal"] main .workspace-preview {
    width: 50%;
    height: 100%;
  }
  body[data-view="split"][data-orientation="vertical"] main .workspace-preview {
    width: 100%;
    height: 50%;
  }
  body[data-view="split"][data-orientation="horizontal"][data-scaling-offset] main .workspace-preview {
    width: calc(100% - var(--scaling-offset));
  }
  body[data-view="split"][data-orientation="vertical"][data-scaling-offset] main .workspace-preview {
    height: calc(100% - var(--scaling-offset));
  }
  body[data-view="preview"] main .workspace-preview {
    width: 100%;
    height: 100%;
  }
  body.scaling-active main .workspace-preview {
    pointer-events: none;
  }
  [data-numbered-container], input[type="text"] {
    font-size: 13px;
    font-family: monospace;
    border: none;
    outline: none;
  }
  [data-numbered-container] {
    position: relative;
  }
  input[type="text"] {
    border-radius: 0;
    -webkit-appearance: none;
  }
  [data-numbered-container] ol, [data-numbered-container] textarea, input[type="text"] {
    padding: 8px;
    line-height: normal;
  }
  [data-numbered-container] ol {
    color: inherit;
    background: transparent;
    opacity: 0.55;
  }
  [data-numbered-container] textarea {
    resize: none;
    scrollbar-width: inherit;
    scrollbar-color: inherit;
  }
  .tab {
    display: flex;
    justify-content: center;
    align-items: center;
    border: 2px solid gray;
    border-radius: 6px 6px 0 0;
  }
  .menu {
    position: relative;
    display: flex;
  }
  .menu .opener {
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .menu .list {background: gray;
    position: absolute;
    left: 0;
    top: 100%;
    visibility: hidden;
    z-index: 1;
    list-style: none;
  }
  .menu .list-item {
    position: relative;
    display: flex;
    align-items: center;
    white-space: nowrap;
  }
  .menu .list-item.hidden {
    display: none;
  }
  .menu .list-item .info {
    margin-left: auto;
  }
  .menu .list .list {
    left: 100%;
    top: 0;
  }
  .menu.active > .list, .menu .list-parent.active > .list {
    visibility: visible;
  }
  :root:not(.apple-device) .shortcut.ctrl::before {
    content: "Ctrl + ";
  }
  :root:not(.apple-device) .shortcut.ctrl-shift::before {
    content: "Ctrl + Shift + ";
  }
  :root.apple-device .shortcut.command::before {
    content: "\2318";
  }
  :root.apple-device .shortcut.shift-command::before {
    content: "\21E7\2318";
  }
  :root.apple-device .shortcut.ctrl-command::before {
    content: "\2303\2318";
  }
  .select {
    display: flex;
    justify-content: center;
  }
  .select label {
    display: flex;
    align-items: center;
  }
  .select .menu .opener {
    justify-content: space-between;
  }
  .checkbox {
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .checkbox input[type="checkbox"] {
    display: none;
  }
  .checkbox label {
    display: flex;
    justify-content: center;
    align-items: center;
    pointer-events: none;
  }
  .checkbox label .check {
    fill: transparent;
  }
  .checkbox input[type="checkbox"]:checked + label .check {
    fill: unset;
  }
  .card {
    display: flex;
    flex-direction: column;
    background: gray;
    visibility: hidden;
  }
  .card.active {
    visibility: visible;
  }
  .card.alert {
    position: absolute;
    right: 0;
    bottom: 0;
    z-index: 3;
  }
  .card.tool {
    position: absolute;
    right: 0;
    top: 0;
    z-index: 1;
  }
  .card.dialog {
    position: fixed;
    left: 50%;
    top: 50%;
    z-index: 2;
    transform: translate(-50%,-50%);
  }
  .card .header {
    display: flex;
    align-items: center;
  }
  .card .header .card-back:not([data-parent-card]) {
    display: none;
  }
  .card .header .title {
    margin: 0 auto;
  }
  .card .header .card-controls {
    display: flex;
  }
  .card:not(.tool) .header .card-controls [data-control="minimize"] {
    display: none;
  }
  :root.macOS-device .card .header .card-controls [data-control] svg {
    fill: transparent;
  }
  :root.macOS-device .card .header .card-controls:hover [data-control] svg {
    fill: unset;
  }
  .card .main {
    display: flex;
    flex-direction: column;
  }
  .card .main .content {
    display: flex;
    justify-content: space-around;
  }
  .card .main .content .item {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .card .options {
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .card-backdrop {
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: #00000040;
    visibility: hidden;
    z-index: 2;
  }
  .card-backdrop.active {
    visibility: visible;
  }
  #symbol_definitions {
    display: none;
  }
</style>

<style id="theme_styles"></style>

</head>

<body data-view="code" data-orientation="horizontal">

<svg id="symbol_definitions">
  <symbol id="arrow_icon" viewBox="0 0 512 512">
    <path d="m112.66 0 286.68 256-286.68 256z"/>
  </symbol>
  <symbol id="check_icon" viewBox="0 0 512 512">
    <path d="m63.346 191.15 192.72 192.72-63.402 63.402-192.72-192.72z"/>
    <path d="m129.5 383.87 319.15-319.15 63.402 63.402-319.15 319.15z"/>
  </symbol>
  <symbol id="back_icon" viewBox="0 0 512 512">
    <path d="m160.8 191.81 254.36 254.36-64 64-254.36-254.36z"/>
    <path d="m96.833 255.86 254.36-254.36 64 64-254.36 254.36z"/>
  </symbol>
  <symbol id="minimize_icon" viewBox="0 0 512 512">
    <path d="m30.33 211.17h451.34v89.669h-451.34z"/>
  </symbol>
  <symbol id="close_icon" viewBox="0 0 512 512">
    <path d="m1.5795 65.78 64.201-64.201 190.22 190.22 190.22-190.22 64.201 64.201-190.22 190.22 190.22 190.22-64.201 64.201-190.22-190.22-190.22 190.22-64.201-64.201 190.22-190.22z"/>
  </symbol>
  <symbol id="rename_icon" viewBox="0 0 512 512">
    <path d="m-0.0618 512.07v-128.63l128.63 128.63z"/>
    <path d="m383.21 0.052969 128.72 128.72-88.63 88.63-128.72-128.72z"/>
    <path d="m252.59 130.63 128.72 128.72-210.68 210.68-128.72-128.72z"/>
  </symbol>
  <symbol id="undo_icon" viewBox="0 0 512 512">
    <path d="m133.64 437.65-133.64-133.64h267.28z"/>
    <path d="m512 249c-0.72363-111.33-91.271-201.16-202.61-200.98-111.33 0.17137-201.61 90.272-201.99 201.61l52.695 0.18028c0.28168-82.334 67.039-148.97 149.37-149.09 82.334-0.12673 149.3 66.299 149.83 148.63z"/>
    <path d="m107.4 246.77h52.472v57.48h-52.472z"/>
    <path d="m459.53 246.77h52.472v190.87h-52.472z"/>
  </symbol>
  <symbol id="redo_icon" viewBox="0 0 512 512">
    <path d="m378.36 437.65 133.64-133.64h-267.28z"/>
    <path d="m0.0044544 249c0.72363-111.33 91.271-201.16 202.61-200.98 111.33 0.17137 201.61 90.272 201.99 201.61l-52.695 0.18028c-0.28168-82.334-67.039-148.97-149.37-149.09-82.334-0.12673-149.3 66.299-149.83 148.63z"/>
    <path d="m404.6 246.77h-52.472v57.48h52.472z"/>
    <path d="m52.473 246.77h-52.472v190.87h52.472z"/>
  </symbol>
  <symbol id="refresh_icon" viewBox="0 0 512 512">
    <path d="m510.27 285.75c-13.893 118.73-108.1 212.04-226.96 224.79-118.86 12.751-230.71-58.451-269.47-171.53-38.761-113.08 5.8941-237.93 107.58-300.78 101.68-62.846 233.32-46.955 317.13 38.282l-37.067 36.446c-66.79-67.929-171.7-80.593-252.74-30.508-81.036 50.084-116.62 149.58-85.733 239.7 30.89 90.117 120.03 146.86 214.75 136.7 94.721-10.161 169.8-84.522 180.87-179.14z"/>
    <path d="m512 189.01v-189.01l-188.98 189.01z"/>
  </symbol>
</svg>

<header id="header">
  <section class="app-region"></section>
  <section class="app-icon">
    <img src="resources/icon.svg">
  </section>
  <section class="menubar">
    <div class="menu">
      <button class="opener">File</button>
      <ul class="list">
        <li class="list-item" onclick="createFile();">New File<span class="info shortcut ctrl-shift shift-command">X</span></li>
        <li class="list-item" onclick="openEditorWindow();">New Window<span class="info shortcut ctrl-shift shift-command">C</span></li>
        <li class="list-item" onclick="loadFiles();">Open<span class="info shortcut ctrl command">O</span></li>
        <li class="list-item" onclick="saveFile();">Save<span class="info shortcut ctrl command">S</span></li>
        <li class="list-item list-parent">Save As...<svg class="info"><use href="#arrow_icon"/></svg>
          <ul class="list">
            <li class="list-item" onclick="saveFile('txt');">Plain Text<span class="info">.txt</span></li>
            <li class="list-item" onclick="saveFile('html');">HTML<span class="info">.html</span></li>
            <li class="list-item" onclick="saveFile('css');">CSS<span class="info">.css</span></li>
            <li class="list-item" onclick="saveFile('js');">JavaScript<span class="info">.js</span></li>
            <li class="list-item" onclick="saveFile('json');">JSON<span class="info">.json</span></li>
            <li class="list-item list-parent">More...<svg class="info"><use href="#arrow_icon"/></svg>
              <ul class="list">
                <li class="list-item" onclick="saveFile('webmanifest');">Web Manifest<span class="info">.webmanifest</span></li>
                <li class="list-item" onclick="saveFile('md');">Markdown<span class="info">.md</span></li>
                <li class="list-item" onclick="saveFile('mcmeta');">MCMETA<span class="info">.mcmeta</span></li>
                <li class="list-item" onclick="saveFile('xml');">XML<span class="info">.xml</span></li>
                <li class="list-item" onclick="saveFile('svg');">SVG<span class="info">.svg</span></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </div>
    <div class="menu">
      <button class="opener">View</button>
      <ul class="list">
        <li class="list-item" onclick="changeView('code');">Code<span class="info shortcut ctrl-shift ctrl-command">2</span></li>
        <li class="list-item" onclick="changeView('split');">Split<span class="info shortcut ctrl-shift ctrl-command">3</span></li>
        <li class="list-item" onclick="changeView('preview');">Preview<span class="info shortcut ctrl-shift ctrl-command">4</span></li>
        <li class="list-item" onclick="changeOrientation();">Orientation<span class="info shortcut ctrl-shift ctrl-command">5</span></li>
        <li class="list-item" onclick="openDisplay();">Display<span class="info shortcut ctrl-shift ctrl-command">6</span></li>
      </ul>
    </div>
    <div class="menu">
      <button class="opener">Preview</button>
      <ul id="preview_files" class="list">
        <li class="list-item" onclick="Editor.preview_editor = null; forceRefresh();">Active Editor</li>
      </ul>
    </div>
    <div class="menu">
      <button class="opener">Tools</button>
      <ul class="list">
        <li class="list-item" onclick="openCard(editing_tools_card);">Editing Tools<span class="info shortcut ctrl-shift shift-command">E</span></li>
        <li class="list-item" onclick="openCard(replacer_card);">Replace Text<span class="info shortcut ctrl-shift shift-command">F</span></li>
        <li class="list-item" onclick="openCard(picker_card);">Color Picker<span class="info shortcut ctrl-shift shift-command">P</span></li>
        <li class="list-item" onclick="openCard(formatter_card);">JSON Formatter<span class="info shortcut ctrl-shift shift-command">R</span></li>
        <li class="list-item" onclick="openCard(encoder_card);">URI Encoder<span class="info shortcut ctrl-shift shift-command">Y</span></li>
        <li class="list-item" onclick="confirmOverwrite(insertTemplate);">Import HTML Template<span class="info shortcut ctrl-shift shift-command">H</span></li>
        <li class="list-item list-parent">Online Resources...<svg class="info"><use href="#arrow_icon"/></svg>
          <ul class="list">
            <a class="list-item" href="https://webformatter.com"><img src="resources/web-formatter.svg">Code Formatter</a>
            <a class="list-item" href="https://www.sharedrop.io"><img class="invert" src="resources/sharedrop.svg">File Transferer</a>
            <a class="list-item" href="https://www.diffchecker.com/"><img src="resources/diffchecker.svg">Difference Finder</a>
            <a class="list-item" href="https://caniuse.com/"><img src="resources/caniuse.svg">Compatibility Checker</a>
            <a class="list-item" href="https://web.dev/measure/"><img src="resources/webdev.svg">Performance Tester</a>
            <a class="list-item" href="https://realfavicongenerator.net/"><img class="rounded" src="resources/real-favicon-generator.svg">Favicon Generator</a>
            <a class="list-item" href="https://appsco.pe/developer/splash-screens/"><img class="invert" src="resources/appscope.svg">Splash Generator</a>
            <a class="list-item" href="https://www.svgminify.com/"><img src="resources/svgminify.svg">SVG Simplifier</a>
            <a class="list-item" href="https://www.uuidgenerator.net/"><img src="resources/online-uuid-generator.svg">UUID Generator</a>
            <a class="list-item" href="https://cryptii.com/"><img src="resources/cryptii.svg">Text Encryptor</a>
          </ul>
        </li>
      </ul>
    </div>
    <div class="menu alternate">
      <button class="opener" onclick="openCard(settings_card);">Settings</button>
      <ul class="list">
        <li id="install_option" class="list-item hidden" onclick="installApp();"><img src="resources/icon.svg">Install</button>
        <li class="list-item" onclick="openCard(theme_card); Editor.dialog_previous = this.closest('.menu').querySelector('button');">Theme Settings</li>
        <li class="list-item" id="clear_cache_option" class="hidden" onclick="clearCache();">Clear Cache</li>
        <li class="list-item" onclick="resetSettings();">Reset Settings</li>
      </ul>
    </div>
  </section>
  <section class="window-controls">
    <button data-control="minimize">&mdash;</button>
    <button data-control="maximize">
      <span data-icon="maximize">&#9744;</span>
      <!--span data-icon="restore">&#10064;</span-->
    </button>
    <button data-control="close">&#10005;</button>
  </section>
</header>

<main id="main">
  <section id="workspace" class="workspace">
    <section id="files" class="editor-tabs"></section>
  </section>
  <section id="scaler" class="workspace-scaler"></section>
  <iframe id="preview" class="workspace-preview" src="about:blank"></iframe>
  <section id="card_backdrop" class="card-backdrop"></section>
  <section id="settings_card" class="card dialog">
    <section class="header">
      <button class="card-back"><svg><use href="#back_icon"/></svg></button>
      <span class="title">Settings</span>
      <section class="card-controls">
        <button data-control="minimize"><svg><use href="#minimize_icon"/></svg></button>
        <button data-control="close"><svg><use href="#close_icon"/></svg></button>
      </section>
    </section>
    <section class="main">
      <div class="content">
        <div class="item list start">
          <div class="select">
            <label for="view_setting">Default View:</label>
            <div class="menu">
              <button id="view_setting" class="opener">Code<svg><use href="#arrow_icon"/></svg></button>
              <ul class="list">
                <li class="list-item" onclick="updateSelect('view','code');">Code</li>
                <li class="list-item" onclick="updateSelect('view','split');">Split</li>
              </ul>
            </div>
          </div>
          <div class="select">
            <label for="orientation_setting">Default Orientation:</label>
            <div class="menu">
              <button id="orientation_setting" class="opener">Horizontal<svg><use href="#arrow_icon"/></svg></button>
              <ul class="list">
                <li class="list-item" onclick="updateSelect('orientation','horizontal');">Horizontal</li>
                <li class="list-item" onclick="updateSelect('orientation','vertical');">Vertical</li>
              </ul>
            </div>
          </div>
          <div class="checkbox">
            <input id="refresh_setting" type="checkbox" oninput="updateCheckbox('refresh');" checked>
            <label for="refresh_setting"><svg class="check"><use href="#check_icon"/></svg>Automatically Refresh Preview</label>
          </div>
          <div class="checkbox">
            <input id="editing_tools_setting" type="checkbox" oninput="updateCheckbox('editing_tools');">
            <label for="editing_tools_setting"><svg class="check"><use href="#check_icon"/></svg>Open Editing Tools</label>
          </div>
        </div>
      </div>
      <div class="options">
        <button id="install_button" class="hidden" onclick="installApp();"><img src="resources/icon.svg">Install</button>
        <button id="theme_button" onclick="openCard(theme_card);" data-previous-card="theme_card"><svg><use href="#arrow_icon"/></svg></button>
      </div>
      <div class="options">
        <button id="clear_cache_button" class="warning hidden" onclick="clearCache();">Clear Cache</button>
        <button class="warning" onclick="resetSettings();">Reset Settings</button>
      </div>
    </section>
  </section>
  <section id="theme_card" class="card dialog">
    <section class="header">
      <button class="card-back" data-parent-card="settings_card"><svg><use href="#back_icon"/></svg></button>
      <span class="title">Theme</span>
      <section class="card-controls">
        <button data-control="minimize"><svg><use href="#minimize_icon"/></svg></button>
        <button data-control="close"><svg><use href="#close_icon"/></svg></button>
      </section>
    </section>
    <section class="main">
      <div class="content">
        <div class="item list expand">
          <div data-numbered-container>
            <textarea id="theme_setting" placeholder="CSS to modify..."></textarea>
          </div>
        </div>
      </div>
      <div class="options">
        <button onclick="resetTheme();">Reset Theme</button>
      </div>
    </section>
  </section>
  <section id="reset_card" class="card alert">
    <section class="header">
      <img class="icon" src="resources/settings.svg">
      <span class="title">Reset Settings</span>
    </section>
    <section class="main">
      <div class="content">
        <div class="item">Your settings have been reset!</div>
      </div>
    </section>
  </section>
  <section id="clear_cache_success_card" class="card alert">
    <section class="header">
      <img class="icon" src="resources/template.svg">
      <span class="title">Cleared Cache</span>
    </section>
    <section class="main">
      <div class="content">
        <div class="item">Successfully cleared offline cache!</div>
      </div>
    </section>
  </section>
  <section id="editing_tools_card" class="card tool action">
    <section class="main">
      <div class="content">
        <div class="options">
          <button id="undo_tool" onclick="callCommand(Editor.query().textarea,'undo'); this.focus();"><svg><use href="#undo_icon"/></svg></button>
          <button id="redo_tool" onclick="callCommand(Editor.query().textarea,'redo'); this.focus();"><svg><use href="#redo_icon"/></svg></button>
          <button id="refresh_tool" onclick="forceRefresh();" disabled><svg><use href="#refresh_icon"/></svg></button>
        </div>
      </div>
    </section>
  </section>
  <section id="replacer_card" class="card tool widget">
    <section class="header">
      <button class="card-back"><svg><use href="#back_icon"/></svg></button>
      <span class="title">Replace Text</span>
      <section class="card-controls">
        <button data-control="minimize"><svg><use href="#minimize_icon"/></svg></button>
        <button data-control="close"><svg><use href="#close_icon"/></svg></button>
      </section>
    </section>
    <section class="main">
      <div class="content">
        <div class="item list expand">
          <div data-numbered-container>
            <textarea id="replacer_find" placeholder="Text to find..."></textarea>
          </div>
          <div data-numbered-container>
            <textarea id="replacer_replace" placeholder="Replace with..."></textarea>
          </div>
        </div>
      </div>
      <div class="options">
        <button onclick="activateReplacer();">Replace</button>
        <button onclick="flipReplacer();">Flip</button>
        <button onclick="clearReplacer();">Clear</button>
      </div>
    </section>
  </section>
  <section id="picker_card" class="card tool widget">
    <section class="header">
      <button class="card-back"><svg><use href="#back_icon"/></svg></button>
      <span class="title">Color Picker</span>
      <section class="card-controls">
        <button data-control="minimize"><svg><use href="#minimize_icon"/></svg></button>
        <button data-control="close"><svg><use href="#close_icon"/></svg></button>
      </section>
    </section>
    <section class="main">
      <div class="content">
        <div class="item list">
          <div id="picker_preview"></div>
          <input id="picker_input" type="text" value="#ee8800" maxlength="7" placeholder="#rrggbb">
        </div>
        <div class="item list">
          <label for="red_channel">Red</label>
          <input id="red_channel" type="range">
          <label for="green_channel">Green</label>
          <input id="green_channel" type="range">
          <label for="blue_channel">Blue</label>
          <input id="blue_channel" type="range">
        </div>
      </div>
      <div class="options">
        <button onclick="copyPicker();">Copy</button>
        <button onclick="insertPicker();">Insert</button>
        <button onclick="deletePicker();">Delete</button>
      </div>
    </section>
  </section>
  <section id="formatter_card" class="card tool widget">
    <section class="header">
      <button class="card-back"><svg><use href="#back_icon"/></svg></button>
      <span class="title">JSON Formatter</span>
      <section class="card-controls">
        <button data-control="minimize"><svg><use href="#minimize_icon"/></svg></button>
        <button data-control="close"><svg><use href="#close_icon"/></svg></button>
      </section>
    </section>
    <section class="main">
      <div class="content">
        <div class="item expand">
          <div class="expand" data-numbered-container>
            <textarea id="formatter_input" placeholder="JSON data to format..."></textarea>
          </div>
        </div>
      </div>
      <div class="options">
        <button onclick="activateFormatter('  ');">Format</button>
        <button onclick="activateFormatter('');">Collapse</button>
        <button onclick="formatter_input.num_changeValue('');">Clear</button>
      </div>
    </section>
  </section>
  <section id="encoder_card" class="card tool widget">
    <section class="header">
      <button class="card-back"><svg><use href="#back_icon"/></svg></button>
      <span class="title">URI Encoder</span>
      <section class="card-controls">
        <button data-control="minimize"><svg><use href="#minimize_icon"/></svg></button>
        <button data-control="close"><svg><use href="#close_icon"/></svg></button>
      </section>
    </section>
    <section class="main">
      <div class="content">
        <div class="item expand">
          <div class="expand" data-numbered-container>
            <textarea id="encoder_input" placeholder="Text to encode..."></textarea>
          </div>
        </div>
      </div>
      <div class="options">
        <button onclick="activateEncoder(true);">Encode</button>
        <button onclick="activateEncoder(false);">Decode</button>
        <button onclick="encoder_input.num_changeValue('');">Clear</button>
      </div>
      <div class="options">
        <div class="checkbox">
          <input id="component_setting" type="checkbox">
          <label for="component_setting"><svg class="check"><use href="#check_icon"/></svg>Enable URI Component</label>
        </div>
      </div>
    </section>
  </section>
  <section id="context_menu" class="menu context-menu">
    <ul class="list">
      <li class="list-item window" onclick="window.location.reload();">Reload<span class="info shortcut ctrl command">R</span></li>
      <li class="list-item link" onclick="Editor.context_menu_previous.click();">Open in New Tab</li>
      <li class="list-item web-sharing link" onclick="navigator.share({ url: Editor.context_menu_previous.href });">Share Link</li>
      <li class="list-item web-sharing-alt link" onclick="navigator.clipboard.writeText(Editor.context_menu_previous.href).catch(error => alert('Clipboard could not be written to, please check site permissions for clipboard use.'));">Copy Link</li>
      <li class="list-item editing" onclick="callCommand(Editor.context_menu_previous,'undo');">Undo<span class="info shortcut ctrl command">Z</span></li>
      <li class="list-item editing" onclick="callCommand(Editor.context_menu_previous,'redo');">Redo<span class="info shortcut ctrl-shift shift-command">Z</span></li>
      <li class="list-item editing" onclick="callCommand(Editor.context_menu_previous,'cut');">Cut<span class="info shortcut ctrl command">X</span></li>
      <li class="list-item editing" onclick="callCommand(Editor.context_menu_previous,'copy');">Copy<span class="info shortcut ctrl command">C</span></li>
      <li class="list-item editing" onclick="callCommand(Editor.context_menu_previous,'paste');">Paste<span class="info shortcut ctrl command">V</span></li>
      <li class="list-item editing" onclick="Editor.context_menu_previous.select();">Select All<span class="info shortcut ctrl command">A</span></li>
      <li class="list-item web-sharing editing" onclick="navigator.share({ text: Editor.long_touch.selection });">Share Text</li>
    </ul>
  </section>
</main>

<script>
  document.querySelectorAll("a[href]").forEach(anchor => {
    anchor.rel = "noopener";
    anchor.target = "_blank";
    anchor.addEventListener("contextmenu",event => {
      if (Editor.environment.mozilla_browser){
        event.stopPropagation();
        menus.forEach(menu => {
          if (!menu.contains(event.target)) closeMenu(menu);
        });
      } else openContextMenu(event,"link");
    });
    if (Editor.environment.mozilla_browser) return;
    anchor.addEventListener("touchstart",event => {
      if (event.touches.length != 1) return;
      Editor.long_touch.timeout = window.setTimeout(() => openContextMenu(event,"link"),750);
    });
    anchor.addEventListener("touchmove",cancelLongTouch);
    anchor.addEventListener("touchend",cancelLongTouch);
  });
  document.querySelectorAll("img:not([alt])").forEach(image => image.alt = "");
  document.querySelectorAll("textarea").forEach(textarea => {
    addInputCharacteristics(textarea);
  });
  document.querySelectorAll("input[type='text']").forEach(input => addInputCharacteristics(input));
  var menus = document.querySelectorAll(".menu");
  menus.forEach(menu => {
    var button = menu.querySelector("button"), menus = menu.querySelectorAll("ul"), submenus = menu.querySelectorAll("li > ul"), options = menu.querySelectorAll("li, a");
    menu.addEventListener("click",event => event.stopPropagation());
    menu.addEventListener("keydown",event => {
      if (!menu.classList.contains("active")) return;
      if ((event.key == "Escape" || event.key == "Tab") && menu != context_menu){
        event.preventDefault();
        event.stopPropagation();
        if (event.key == "Tab") return;
        closeMenu(menu);
        if (button) button.focus();
      }
    });
    if (button){
      if (!menu.classList.contains("alternate")){
        button.addEventListener("click",() => openMenu(menu));
      } else {
        button.addEventListener("contextmenu",() => openMenu(menu));
        button.addEventListener("touchstart",() => Editor.long_touch.timeout = window.setTimeout(() => openMenu(menu),750));
        button.addEventListener("touchmove",cancelLongTouch);
        button.addEventListener("touchend",cancelLongTouch);
      }
      button.addEventListener("keydown",event => {
        if (!menu.classList.contains("active")) return;
        var navigable = getNavigableElements(menus[0],true);
        if (event.key == "ArrowDown"){
          event.preventDefault();
          navigable[0].focus();
        }
        if (event.key == "ArrowUp"){
          event.preventDefault();
          navigable[navigable.length - 1].focus();
        }
      });
    }
    menus.forEach(menu => {
      menu.addEventListener("keydown",event => {
        var navigable = getNavigableElements(menu,true);
        if (event.key == "ArrowDown"){
          if (document.activeElement == navigable[navigable.length - 1]){
            event.preventDefault();
            event.stopPropagation();
            navigable[0].focus();
          } else {
            event.preventDefault();
            event.stopPropagation();
            navigable[navigable.indexOf(document.activeElement) + 1].focus();
          }
        }
        if (event.key == "ArrowUp"){
          if (document.activeElement == navigable[0]){
            event.preventDefault();
            event.stopPropagation();
            navigable[navigable.length - 1].focus();
          } else {
            event.preventDefault();
            event.stopPropagation();
            navigable[navigable.indexOf(document.activeElement) - 1].focus();
          }
        }
        if (event.key == "Tab") event.preventDefault();
      });
    });
    submenus.forEach(submenu => {
      var menuParent = submenu.parentElement;
      menuParent.addEventListener("click",event => openSubmenu(event));
      menuParent.addEventListener("keydown",event => {
        if (event.key == "Enter" || event.key == " " || event.key == "ArrowRight") openSubmenu(event);
        if (event.key == "ArrowLeft") closeSubmenu(event);
      });
      menuParent.addEventListener("mouseenter",() => menuParent.classList.add("active"));
      function openSubmenu(event){
        event.stopPropagation();
        if (menuParent.classList.contains("active") && event.type == "click") return menuParent.classList.remove("active");
        if (submenu.contains(document.activeElement)) return;
        menuParent.classList.add("active");
        if (event.type == "click") return;
        var navigable = getNavigableElements(submenu,true);
        window.setTimeout(() => navigable[0].focus(),50);
      }
      function closeSubmenu(event){
        if (menuParent.classList.contains("active")) event.stopPropagation();
        menuParent.focus();
        menuParent.classList.remove("active");
      }
    });
    options.forEach(option => {
      option.addEventListener("click",() => {
        if (option.querySelector(":scope > ul") != null) return;
        if (menu == context_menu){
          closeContextMenu();
        } else closeMenu(menu);
      });
      option.addEventListener("keydown",event => {
        if (option.querySelector(":scope > ul") != null) return;
        if (event.key == "Enter" || event.key == " "){
          event.preventDefault();
          event.stopPropagation();
          option.click();
          if (button) button.focus();
        }
        if (!menu.parentElement.classList.contains("select")) return;
        if (event.key == "Escape" || event.key == "Tab"){
          event.preventDefault();
          event.stopPropagation();
          closeMenu(menu);
          button.focus();
        }
      });
      option.addEventListener("mouseenter",() => submenus.forEach(submenu => {
        var menuParent = submenu.parentElement;
        if (option != menuParent && menuParent.classList.contains("active") && !menuParent.contains(Editor.context_menu_previous) && !submenu.contains(option) && !submenu.contains(document.activeElement)) menuParent.classList.remove("active");
      }));
      if (option.tagName.toLowerCase() != "a") option.setAttribute("tabindex","0");
    });
  });
  document.querySelectorAll(".checkbox").forEach(checkbox => {
    checkbox.addEventListener("click",() => input.click());
    checkbox.addEventListener("keydown",event => {
      if (event.key != "Enter" && event.key != " ") return;
      event.preventDefault();
      input.click();
    });
    checkbox.setAttribute("tabindex","0");
    checkbox.setAttribute("aria-label","Checkbox");
    var input = checkbox.querySelector("input[type='checkbox']");
    input.addEventListener("click",event => event.stopPropagation());
  });
  var cards = document.querySelectorAll(".card");
  cards.forEach(card => {
    var backButton = card.querySelector(".card-back");
    if (backButton != null){
      backButton.addEventListener("click",() => openCard(document.querySelector(`#${backButton.getAttribute("data-parent-card")}`),card.id));
      backButton.setAttribute("aria-label","Back");
    }
    var minimizeButton = card.querySelector(".header .card-controls [data-control='minimize']");
    if (minimizeButton != null){
      minimizeButton.addEventListener("click",() => minimizeCard(card));
      minimizeButton.addEventListener("keydown",event => {
        if (event.key != "Enter") return;
        event.preventDefault();
        if (event.repeat) return;
        minimizeButton.click();
      });
      minimizeButton.setAttribute("aria-label","Minimize");
    }
    var closeButton = card.querySelector(".header .card-controls [data-control='close']");
    if (closeButton != null){
      closeButton.addEventListener("click",() => closeCard(card));
      closeButton.setAttribute("aria-label","Close");
    }
    if (!Editor.environment.macOS_device || !minimizeButton || !closeButton) return;
    var header = card.querySelector(".header"), cardControls = card.querySelector(".header .card-controls");
    cardControls.insertBefore(closeButton,minimizeButton);
    header.insertBefore(cardControls,header.firstChild);
    var navigable = getNavigableElements(card);
    card.addEventListener("keydown",event => {
      if (!card.classList.contains("dialog")) return;
      if (event.key == "Tab"){
        if (event.shiftKey){
          if (document.activeElement == navigable[0]){
            event.preventDefault();
            navigable[navigable.length - 1].focus();
          }
        } else if (document.activeElement == navigable[navigable.length - 1]){
          event.preventDefault();
          navigable[0].focus();
        }
      }
    });
  });
  picker_card.querySelectorAll("input[type='range']").forEach(pickerChannel => {
    pickerChannel.addEventListener("input",channelRefresh);
    pickerChannel.min = "0";
    pickerChannel.max = "255";
  });
  window.addEventListener("load",() => {
    if ("serviceWorker" in navigator && Editor.appearance().parent_window && window.location.protocol == "https:"){
      navigator.serviceWorker.register("service-worker.js");
      if (navigator.serviceWorker.controller){
        navigator.serviceWorker.addEventListener("message",event => {
          if (event.data.action == "load-files"){
            var files = Array.from(event.data.files);
            files.forEach(file => {
              var reader = new FileReader();
              reader.readAsText(file,"UTF-8");
              reader.addEventListener("loadend",() => createFile(file.name,reader.result));
            });
          }
          if (event.data.action == "clear-cache-success") openCard(clear_cache_success_card);
        });
        clear_cache_option.classList.remove("hidden");
        clear_cache_button.classList.remove("hidden");
      }
    }
  });
  window.addEventListener("beforeinstallprompt",event => {
    event.preventDefault();
    Editor.install_prompt = event;
    install_option.classList.remove("hidden");
    install_button.classList.remove("hidden");
  });
  window.addEventListener("beforeunload",event => {
    if (!Editor.appearance().parent_window || (files.querySelectorAll(".tab[data-unsaved]").length == 0)) return;
    event.preventDefault();
    event.returnValue = "";
  });
  window.addEventListener("resize",event => {
    if (context_menu.classList.contains("active")) closeContextMenu();
    if (Editor.view() != "preview"){
      setFileTabVisibility(Editor.query().tab);
      setFilesSectionOffset();
    }
    if (Editor.view() != "split" || !document.body.hasAttribute("data-scaling-offset")) return;
    var currentWidth = window.innerWidth, currentHeight = window.innerHeight;
    window.setTimeout(() => {
      if ((Editor.orientation() == "horizontal" && window.innerWidth == currentWidth) || (Editor.orientation() == "vertical" && window.innerHeight == currentHeight)) return;
      changeView("split");
    },50);
  });
  window.addEventListener("orientationchange",refreshSafeAreaInsets);
  window.addEventListener("blur",() => {
    var activeMenus = document.querySelectorAll(".menu.active");
    activeMenus.forEach(activeMenu => {
      if (activeMenu == context_menu){
        closeContextMenu();
      } else closeMenu(activeMenu);
    });
  });
  document.body.addEventListener("keydown",event => {
    var pressed = key => (event.key.toLowerCase() == key.toLowerCase()), ctrl = (event.ctrlKey && !Editor.environment.apple_device), command = (event.metaKey && Editor.environment.apple_device), shift = (event.shiftKey || ((event.key.toUpperCase() == event.key) && (event.key + event.key == event.key * 2))), ctrlShift = (ctrl && shift), shiftCommand = (shift && command), ctrlCommand = (event.ctrlKey && command);
    if (pressed("Escape")){
      event.preventDefault();
      if (event.repeat) return;
      event.stopPropagation();
      if (context_menu.classList.contains("active")) return closeContextMenu();
      if (Editor.active_dialog) closeCard(Editor.active_dialog);
    }
    if ((ctrlShift || shiftCommand) && pressed("x")){
      event.preventDefault();
      if (event.repeat) return;
      createFile();
    }
    if ((ctrlShift || shiftCommand) && pressed("d")){
      event.preventDefault();
      if (event.repeat) return;
      closeFile(Editor.query().tab);
    }
    if ((ctrlShift || ctrlCommand) && (pressed("[") || pressed("{"))){
      event.preventDefault();
      if (event.repeat) return;
      var activeTab = Editor.query().tab, tabs = Array.from(files.querySelectorAll(".tab")), newTab, withinEditor = (document.activeElement == Editor.query().textarea);
      if (activeTab == tabs[0]){
        newTab = tabs[tabs.length - 1];
      } else newTab = tabs[tabs.indexOf(activeTab) - 1];
      openFile(newTab);
      if (withinEditor) Editor.query().textarea.focus();
    }
    if ((ctrlShift || ctrlCommand) && (pressed("]") || pressed("}"))){
      event.preventDefault();
      if (event.repeat) return;
      var activeTab = Editor.query().tab, tabs = Array.from(files.querySelectorAll(".tab")), newTab, withinEditor = (document.activeElement == Editor.query().textarea);
      if (activeTab == tabs[tabs.length - 1]){
        newTab = tabs[0];
      } else newTab = tabs[tabs.indexOf(activeTab) + 1];
      openFile(newTab);
      if (withinEditor) Editor.query().textarea.focus();
    }
    if ((ctrlShift || shiftCommand) && pressed("c")){
      event.preventDefault();
      if (event.repeat) return;
      openEditorWindow();
    }
    if ((ctrl || command) && pressed("o")){
      event.preventDefault();
      if (event.repeat) return;
      loadFiles();
    }
    if ((ctrl || command) && pressed("s")){
      event.preventDefault();
      if (event.repeat) return;
      saveFile();
    }/*
    if ((ctrlShift || ctrlCommand) && (pressed("1") || pressed("!"))){
      event.preventDefault();
      if (event.repeat) return;
      changeView("text");
    }*/
    if ((ctrlShift || ctrlCommand) && (pressed("2") || pressed("@"))){
      event.preventDefault();
      if (event.repeat) return;
      changeView("code");
    }
    if ((ctrlShift || ctrlCommand) && (pressed("3") || pressed("#"))){
      event.preventDefault();
      if (event.repeat) return;
      changeView("split");
    }
    if ((ctrlShift || ctrlCommand) && (pressed("4") || pressed("$"))){
      event.preventDefault();
      if (event.repeat) return;
      changeView("preview");
    }
    if ((ctrlShift || ctrlCommand) && (pressed("5") || pressed("%"))){
      event.preventDefault();
      if (event.repeat) return;
      changeOrientation();
    }
    if ((ctrlShift || ctrlCommand) && (pressed("6") || pressed("^"))){
      event.preventDefault();
      if (event.repeat) return;
      openDisplay();
    }
    if ((ctrlShift || shiftCommand) && pressed("Enter")){
      event.preventDefault();
      if (event.repeat) return;
      if (Editor.view() == "split" || Editor.view() == "preview") forceRefresh();
    }
    if ((ctrlShift || shiftCommand) && pressed("e")){
      event.preventDefault();
      if (event.repeat) return;
      openCard(editing_tools_card);
    }
    if ((ctrlShift || shiftCommand) && pressed("f")){
      event.preventDefault();
      if (event.repeat) return;
      openCard(replacer_card);
    }
    if ((ctrlShift || shiftCommand) && pressed("p")){
      event.preventDefault();
      if (event.repeat) return;
      openCard(picker_card);
    }
    if ((ctrlShift || shiftCommand) && pressed("g")){
      event.preventDefault();
      if (event.repeat) return;
      importColor();
    }
    if ((ctrlShift || shiftCommand) && pressed("r")){
      event.preventDefault();
      if (event.repeat) return;
      openCard(formatter_card);
    }
    if ((ctrlShift || shiftCommand) && pressed("y")){
      event.preventDefault();
      if (event.repeat) return;
      openCard(encoder_card);
    }
    if ((ctrlShift || shiftCommand) && pressed("h")){
      event.preventDefault();
      if (event.repeat) return;
      confirmOverwrite(insertTemplate);
    }
    if ((ctrlShift || shiftCommand) && pressed("m")){
      event.preventDefault();
      if (!Editor.active_widget || event.repeat) return;
      minimizeCard(Editor.active_widget);
    }
    if ((ctrlShift || shiftCommand) && (pressed(".") || pressed(">"))){
      event.preventDefault();
      if (event.repeat) return;
      openCard(settings_card);
    }
  });
  document.body.addEventListener("mousedown",event => {
    if (event.button != 2) return;
    event.preventDefault();
    event.stopPropagation();
  });
  document.body.addEventListener("contextmenu",event => event.preventDefault());
  document.body.addEventListener("drop",() => {
    var activeMenus = document.querySelectorAll(".menu.active");
    if (activeMenus == null) return;
    activeMenus.forEach(activeMenu => {
      if (activeMenu == context_menu){
        closeContextMenu();
      } else closeMenu(activeMenu);
    });
  });
  document.body.addEventListener("dragend",() => document.querySelectorAll("textarea").forEach(textarea => textarea.num_refreshLineCount()));
  var toolbar = document.querySelector("#header .menubar");
  toolbar.querySelectorAll(".menu").forEach(menu => {
    menu.addEventListener("mouseenter",() => {
      if (toolbar.querySelectorAll(".menu:not(.alternate).active").length == 0 || menu.classList.contains("alternate") || menu.classList.contains("active")) return;
      openMenu(menu);
    });
  });
  files.addEventListener("dragover",event => {
    event.preventDefault();
    files.classList.add("drag");
    event.dataTransfer.dropEffect = "copy";
  });
  main.addEventListener("scroll",event => {
    main.scrollLeft = 0;
    main.scrollTop = 0;
  },{ passive: true });
  files.addEventListener("dragleave",() => files.classList.remove("drag"));
  files.addEventListener("drop",event => {
    event.preventDefault();
    files.classList.remove("drag");
    Array.from(event.dataTransfer.items).forEach(async item => {
      if (item.kind == "file"){
        if (!Editor.support.file_system || !("getAsFileSystemHandle" in item)){
          var file = item.getAsFile(), reader = new FileReader();
          reader.readAsText(file,"UTF-8");
          reader.addEventListener("loadend",() => createFile(file.name,reader.result));
        } else {
          var fileHandle = await item.getAsFileSystemHandle();
          if (fileHandle.kind != "file") return;
          var file = await fileHandle.getFile(), identifier = createFile(await file.name,await file.text());
          Editor.file_handles[identifier] = await fileHandle;
        }
      } else if (item.kind == "string") createFile(undefined,event.dataTransfer.getData("text"));
    });
  });
  scaler.addEventListener("touchstart",event => {
    if (event.touches.length != 1) return;
    toggleScaling();
    document.addEventListener("touchmove",setScaling,{ passive: true });
    document.addEventListener("touchend",disableScaling,{ passive: true });
  },{ passive: true });
  scaler.addEventListener("mousedown",() => {
    toggleScaling();
    document.addEventListener("mousemove",setScaling);
    document.addEventListener("mouseup",disableScaling);
  });
  card_backdrop.addEventListener("click",() => closeCard(Editor.active_dialog));
  theme_setting.addEventListener("input",() => {
    theme_styles.innerText = theme_setting.value;
    updateSetting("theme",theme_setting.value);
  });
  picker_input.addEventListener("input",() => {
    pickerInputRefresh();
    if (!Editor.insert_color) return;
    textEdit("insert",Editor.picker_color);
    picker_input.focus();
  });
  createFile();
  if (Editor.support.file_handling && Editor.support.file_system){
    window.launchQueue.setConsumer(launchParams => {
      if (!launchParams.files.length) return;
      var focusEditor;
      if (document.activeElement == Editor.query().textarea) focusEditor = true;
      closeFile(Editor.query().tab);
      launchParams.files.forEach(async fileHandle => {
        var file = await fileHandle.getFile(), identifier = createFile(await file.name,await file.text());
        Editor.file_handles[identifier] = await fileHandle;
      });
      if (focusEditor) Editor.query().textarea.focus();
    });
  }
  if (Editor.appearance().parent_window){
    loadSettings("initial");
    loadTheme();
    window.setTimeout(() => document.documentElement.classList.remove("startup-fade"),50);
    if (!Editor.environment.touch_device) Editor.query().textarea.focus();
  }
  if (Editor.environment.mozilla_browser){
    undo_tool.classList.add("hidden");
    redo_tool.classList.add("hidden");
  }
  refreshSafeAreaInsets();
  pickerInputRefresh();
  var queryParameters = new URLSearchParams(window.location.search);
  if (queryParameters.get("template")){
    confirmOverwrite(insertTemplate);
    removeQueryParameters(["template"]);
  }
  if (queryParameters.get("settings")){
    openCard(settings_card);
    removeQueryParameters(["settings"]);
  }
  function createFile(name,value){
    var identifier = Math.random(), tab = document.createElement("button"), container = document.createElement("div");
    container.classList.add("editor");
    container.setAttribute("data-identifier",identifier);
    container.setAttribute("data-numbered-container",true);
    var textarea = document.createElement("textarea");
    textarea.addEventListener("input",() => {
      sourceChange = true;
      if (!tab.hasAttribute("data-unsaved")) tab.setAttribute("data-unsaved",true);
      if (Editor.view() == "split" || Editor.view() == "preview") refreshPreview();
    });
    textarea.addEventListener("click",() => {
      if (Editor.insert_color) Editor.insert_color = false;
    });
    container.appendChild(textarea);
    workspace.appendChild(container);
    if (!name) name = "Untitled.txt";
    if (value) textarea.value = value;
    textarea.selectionStart = 0;
    textarea.selectionEnd = 0;
    addInputCharacteristics(textarea);
    tab.classList.add("tab");
    tab.setAttribute("data-identifier",identifier);
    var previewOption = document.createElement("li");
    previewOption.setAttribute("data-identifier",identifier);
    previewOption.innerText = name;
    previewOption.addEventListener("click",() => {
      Editor.preview_editor = identifier;
      forceRefresh();
    });
    preview_files.appendChild(previewOption);
    var fileName = document.createElement("span");
    fileName.innerText = name;
    fileName.setAttribute("data-file-name",true);
    tab.appendChild(fileName);
    var renameButton = document.createElement("button");
    renameButton.innerHTML = "<svg><use href='#rename_icon'/></svg>";
    renameButton.addEventListener("click",event => {
      event.stopPropagation();
      var newFileName = prompt(`Enter a new file name for "${fileName.innerText}"`,fileName.innerText);
      if (!newFileName) return;
      previewOption.innerText = newFileName;
      fileName.innerText = newFileName;
      if (tab == Editor.query().tab) titleRefresh(newFileName);
    });
    tab.appendChild(renameButton);
    var closeButton = document.createElement("button");
    closeButton.innerHTML = "<svg><use href='#close_icon'/></svg>";
    closeButton.addEventListener("click",event => {
      event.stopPropagation();
      closeFile(tab);
    });
    tab.appendChild(closeButton);
    files.appendChild(tab);
    tab.addEventListener("click",() => {
      if (!tab.classList.contains("active")) openFile(tab);
    });
    tab.addEventListener("dragover",event => {
      event.preventDefault();
      event.stopPropagation();
      event.dataTransfer.dropEffect = "copy";
      if (!tab.classList.contains("active")) openFile(tab);
    });
    tab.addEventListener("drop",event => {
      event.preventDefault();
      event.stopPropagation();
    });
    var withinEditor = (document.activeElement == Editor.query().textarea);
    openFile(tab);
    if (withinEditor) Editor.query().textarea.focus();
    return identifier;
  }
  function openFile(tab){
    var identifier = tab.getAttribute("data-identifier"), tabs = files.querySelectorAll(".tab");
    tabs.forEach(tab => {
      tab.classList.remove("active");
    });
    tab.classList.add("active");
    workspace.querySelectorAll("[data-numbered-container].active").forEach(activeFile => activeFile.classList.remove("active"));
    var container = workspace.querySelector(`[data-numbered-container][data-identifier="${identifier}"]`);
    container.classList.add("active");
    Editor.active_editor = identifier;
    setFileTabVisibility(tab);
    forceRefresh();
    titleRefresh(tab.querySelector("[data-file-name]").innerText);
  }
  function closeFile(tab){
    var identifier = tab.getAttribute("data-identifier");
    if (tab.hasAttribute("data-unsaved")){
      var ask = confirm(`Are you sure you would like to close "${Editor.query(identifier).name()}"?\nRecent changes have not yet been saved.`);
      if (!ask) return;
    }
    var tabs = Array.from(files.querySelectorAll(".tab")), withinEditor = (document.activeElement == Editor.query().textarea);
    if (tab == tabs[0] && tabs[1] && tab.classList.contains("active")) openFile(tabs[1]);
    if (tab == tabs[tabs.length - 1] && tab != tabs[0] && tab.classList.contains("active")) openFile(tabs[tabs.length - 2]);
    if (tab != tabs[0] && tab.classList.contains("active")) openFile(tabs[tabs.indexOf(tab) + 1]);
    if (withinEditor) Editor.query().textarea.focus();
    files.removeChild(tab);
    var previewOption = preview_files.querySelector(`li[data-identifier="${identifier}"]`);
    preview_files.removeChild(previewOption);
    var container = workspace.querySelector(`[data-numbered-container][data-identifier="${identifier}"]`);
    workspace.removeChild(container);
    if (identifier == Editor.active_editor) Editor.active_editor = null;
    if (Editor.file_handles[identifier]) delete Editor.file_handles[identifier];
  }
  function setFileTabVisibility(tab){
    var obstructedLeft = (tab.offsetLeft <= files.scrollLeft), obstructedRight = (tab.offsetLeft + tab.clientWidth >= files.scrollLeft + files.clientWidth);
    if (!obstructedLeft && !obstructedRight) return;
    var spacingOffset = 0;
    if (obstructedLeft){
      if (!tab.previousElementSibling){
        spacingOffset = parseInt(getElementStyle(files,"padding-left").replace(/px/g,""));
      } else spacingOffset = parseInt(getElementStyle(tab,"margin-left").replace(/px/g,"") * 2);
      files.scrollTo(tab.offsetLeft - spacingOffset,0);
    }
    if (obstructedRight){
      if (tab.nextElementSibling){
        spacingOffset = parseInt(getElementStyle(tab.nextElementSibling,"margin-left").replace(/px/g,"") * 2);
      } else spacingOffset = parseInt(getElementStyle(tab,"::before","width").replace(/px/g,""));
      files.scrollTo(tab.offsetLeft + tab.clientWidth + spacingOffset - files.clientWidth,0);
    }
  }
  function setFilesSectionOffset(){
    if (Editor.view() != "split" || Editor.orientation() != "horizontal" || !Editor.active_widget && !Editor.active_editing_tools) return;
    var overflowOverlap, scalingOffset;
    if (document.body.hasAttribute("data-scaling-offset")){
      scalingOffset = parseInt(document.body.getAttribute("data-scaling-offset"));
    } else scalingOffset = workspace.offsetWidth;
    if (Editor.active_editing_tools) overflowOverlap = parseInt(getElementStyle(editing_tools,"width").replace(/px/g,"")) + parseInt(getElementStyle(editing_tools,"margin").replace(/px/g,"")) + scalingOffset > parseInt(getElementStyle(main,"width").replace(/px/g,""));
    if (Editor.active_widget && !Editor.active_widget.classList.contains("minimize") && !Editor.active_editing_tools) overflowOverlap = parseInt(getElementStyle(Editor.active_widget,"width").replace(/px/g,"")) + parseInt(getElementStyle(Editor.active_widget,"margin").replace(/px/g,"")) + scalingOffset > parseInt(getElementStyle(main,"width").replace(/px/g,""));
    if (overflowOverlap){
      main.classList.add("files-offset");
    } else main.classList.remove("files-offset");
  }
  function titleRefresh(value){
    document.title = `${value} - Smart Text Editor`;
  }
  function installApp(){
    Editor.install_prompt.prompt();
    Editor.install_prompt.userChoice.then(result => {
      if (result.outcome != "accepted") return;
      install_option.classList.add("hidden");
      install_button.classList.add("hidden");
    });
  }
  function loadSettings(input){
    if (!Editor.appearance().parent_window) return;
    var savedView = Editor.storage.getItem("view");
    if (savedView){
      if (input == "initial") changeView(savedView);
      updateSelect("view",savedView);
    }
    var savedOrientation = Editor.storage.getItem("orientation");
    if (savedOrientation){
      if (input == "initial") changeOrientation(savedOrientation);
      updateSelect("orientation",savedOrientation);
    }
    var savedEditingTools = Editor.storage.getItem("editingTools");
    if (savedEditingTools){
      if (input == "initial"){
        if (savedEditingTools == "true") openCard(editing_tools_card);
      }
      updateCheckbox("editing_tools",savedEditingTools);
    }
    var savedRefresh = Editor.storage.getItem("refresh");
    if (savedRefresh){
      Editor.refresh = savedRefresh;
      if (Editor.refresh == "true") refreshPreview();
      updateCheckbox("refresh",savedRefresh);
    }
  }
  function resetSettings(){
    var ask = confirm("Are you sure you want to reset all settings?\nThis cannot be undone.");
    if (!ask) return;
    closeCard(reset_card);
    window.setTimeout(() => {
      updateSelect("view","code");
      updateSelect("orientation","horizontal");
      updateSelect("editing_tools","no");
      Editor.refresh = "true";
      updateCheckbox("refresh","true");
      resetTheme();
      Editor.storage.clear();
    },50);
    openCard(reset_card);
  }
  function updateSetting(item,value){
    Editor.storage.setItem(item,value);
  }
  function updateSelect(item,value){
    updateSetting(item,value);
    var select = document.querySelector(`#${item}_setting`);
    select.innerHTML = select.innerHTML.replace(select.textContent,updateCapitalization(value));
  }
  function updateCheckbox(item,value){
    var checkbox = document.querySelector(`#${item}_setting`);
    if (value == undefined){
      value = checkbox.checked;
    } else {
      if (value == "true") checkbox.checked = "true";
      if (value == "false") checkbox.removeAttribute("checked");
    }
    updateSetting(item,value);
  }
  function updateCapitalization(value){
    return value.charAt(0).toUpperCase() + value.slice(1);
  }
  function clearCache(){
    var ask = confirm("Are you sure you want to clear all cache?\nThis site will no longer work offline.");
    if (!ask) return;
    navigator.serviceWorker.controller.postMessage({
      action: "clear-cache"
    });
  }
  function loadTheme(){
    if (!Editor.appearance().parent_window) return;
    var savedTheme = Editor.storage.getItem("theme");
    if (savedTheme){
      theme_styles.innerText = savedTheme;
      theme_setting.num_changeValue(savedTheme);
    }
  }
  function resetTheme(){
    theme_styles.innerText = "";
    theme_color.content = getElementStyle(document.documentElement,"--container-dark");
    theme_setting.num_changeValue("");
    Editor.storage.removeItem("theme");
  }
  function refreshSafeAreaInsets(){
    document.body.classList.remove("camera-left");
    document.body.classList.remove("camera-right");
    var angle = window.orientation;
    if (angle == 90) document.body.classList.add("camera-left");
    if (angle == -90) document.body.classList.add("camera-right");
  }
  function addInputCharacteristics(input){
    input.spellcheck = false;
    input.autocomplete = "off";
    input.autocapitalize = "off";
    input.setAttribute("autocorrect","off");
    if (input.tagName.toLowerCase() == "input"){
      input.addEventListener("mousedown",event => {
        if (event.button == "2") event.preventDefault();
      });
      input.addEventListener("contextmenu",event => {
        if (Editor.environment.mozilla_browser){
          event.stopPropagation();
          menus.forEach(menu => closeMenu(menu));
        } else openContextMenu(event,"editing");
      });
      if (!Editor.environment.mozilla_browser){
        input.addEventListener("touchstart",event => {
          if (event.touches.length != 1) return;
          Editor.long_touch.timeout = window.setTimeout(() => openContextMenu(event,"editing"),750);
          if (window.getSelection == "") return;
          Editor.long_touch.selection = window.getSelection();
        });
        input.addEventListener("touchmove",cancelLongTouch);
        input.addEventListener("touchend",cancelLongTouch);
      }
    }
    if (input.tagName.toLowerCase() == "textarea"){
      var container = input.parentElement;
      container.num_establishContainer();
      container.addEventListener("mousedown",event => {
        if (event.button == "2") event.preventDefault();
      });
      container.addEventListener("contextmenu",event => {
        if (Editor.environment.mozilla_browser){
          event.stopPropagation();
          menus.forEach(menu => closeMenu(menu));
        } else openContextMenu(event,"editing");
      });
      if (!Editor.environment.mozilla_browser){
        container.addEventListener("touchstart",event => {
          if (event.touches.length != 1) return;
          Editor.long_touch.timeout = window.setTimeout(() => openContextMenu(event,"editing"),750);
          if (window.getSelection == "") return;
          Editor.long_touch.selection = window.getSelection();
        });
        container.addEventListener("touchmove",cancelLongTouch);
        container.addEventListener("touchend",cancelLongTouch);
      }
      container.addEventListener("dragover",event => {
        container.classList.add("drag");
        event.dataTransfer.dropEffect = "copy";
      });
      container.addEventListener("dragleave",() => container.classList.remove("drag"));
      container.addEventListener("drop",event => {
        container.classList.remove("drag");
        if (Array.from(event.dataTransfer.items)[0].kind == "string") return window.setTimeout(() => input.num_refreshLineCount(),5);
        event.preventDefault();
      });
    }
  }
  function addQueryParameters(queryEntries){
    var queryParameters = new URLSearchParams(window.location.search);
    queryEntries.forEach(queryEntry => queryParameters.set(queryEntry,true));
    changeQueryParameters(queryParameters);
  }
  function removeQueryParameters(queryEntries){
    var queryParameters = new URLSearchParams(window.location.search);
    queryEntries.forEach(queryEntry => queryParameters.delete(queryEntry));
    changeQueryParameters(queryParameters);
  }
  function changeQueryParameters(queryParameters){
    var queryString = queryParameters.toString();
    if (queryString) queryString = "?" + queryString;
    var completeAddress = window.location.pathname + queryString;
    history.pushState(null,"",completeAddress);
  }
  function changeView(newView){
    if (document.body.classList.contains("scaling-active")) return;
    if (newView != "preview"){
      var transitionDuration = parseInt(getElementStyle(workspace,"transition-duration").replace(/s/g,"") * 1000);
      window.setTimeout(() => {
        setFileTabVisibility(Editor.query().tab);
        setFilesSectionOffset();
      },transitionDuration);
    }
    document.body.setAttribute("data-view",newView);
    removeScaling();
    if (main.classList.contains("files-offset")) main.classList.remove("files-offset");
    if (newView == "code"){
      undo_tool.disabled = false;
      redo_tool.disabled = false;
      refresh_tool.disabled = true;
    }
    if (newView == "split"){
      undo_tool.disabled = false;
      redo_tool.disabled = false;
      refresh_tool.disabled = false;
    }
    if (newView == "preview"){
      undo_tool.disabled = true;
      redo_tool.disabled = true;
      refresh_tool.disabled = false;
    }
    refreshPreview();
  }
  function changeOrientation(newOrientation){
    if (document.body.classList.contains("scaling-active")) return;
    if (!newOrientation){
      if (Editor.orientation() == "horizontal"){
        newOrientation = "vertical";
      } else newOrientation = "horizontal";
      var transitionDuration;
      if (Editor.view() == "split" || Editor.view() == "preview"){
        changeView("code");
        transitionDuration = parseInt(getElementStyle(workspace,"transition-duration").replace(/s/g,"") * 1000);
      } else transitionDuration = 0;
      window.setTimeout(() => {
        document.body.setAttribute("data-orientation",newOrientation);
        window.setTimeout(() => changeView("split"),25);
      },transitionDuration);
    } else {
      document.body.setAttribute("data-orientation",newOrientation);
    }
  }
  function getNavigableElements(container,scope){
    var navigable;
    if (scope){
      navigable = container.querySelectorAll(":scope > button:not([disabled]), :scope > textarea:not([disabled]), :scope > input:not([disabled]), :scope > select:not([disabled]), :scope > a[href]:not([disabled]), :scope > [tabindex]:not([tabindex='-1'])");
    } else navigable = container.querySelectorAll("button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), a[href]:not([disabled]), [tabindex]:not([tabindex='-1'])");
    return Array.from(navigable).filter(element => (getElementStyle(element,"display") != "none"));
  }
  function getElementStyle(element,pseudo,property){
    if (!property){
      property = pseudo;
      pseudo = null;
    }
    return window.getComputedStyle(element,pseudo).getPropertyValue(property);
  }
  function confirmOverwrite(action,event){
    if (Editor.query().tab.hasAttribute("data-unsaved")){
      var ask = confirm("Changes you made may not be saved.");
      if (!ask) return;
      action(event);
      closeCard(Editor.active_dialog);
    } else {
      action(event);
      closeCard(Editor.active_dialog);
    }
  }
  function openEditorWindow(){
    var windowFeatures = "";
    if (Editor.appearance().standalone || Editor.appearance().fullscreen) windowFeatures = "popup";
    var newEditor = window.open(window.location.href,"_blank",windowFeatures);
    if (Editor.appearance().fullscreen){
      newEditor.resizeTo(window.screen.width * 2/3,window.screen.height * 2/3);
      newEditor.moveTo(window.screen.width / 6,window.screen.height / 6);
    } else if (Editor.appearance().standalone){
      newEditor.resizeTo(window.outerWidth,window.outerHeight);
      newEditor.moveTo(window.screenX,window.screenY);
    }
  }
  async function loadFiles(){
    if (!Editor.support.file_system){
      var input = document.createElement("input");
      input.type = "file";
      input.multiple = true;
      input.click();
      input.addEventListener("change",() => {
        var files = Array.from(input.files);
        files.forEach(file => {
          var reader = new FileReader();
          reader.readAsText(file,"UTF-8");
          reader.addEventListener("loadend",() => createFile(file.name,reader.result));
        });
        input.value = null;
      });
    } else {
      var fileHandles;
      if ("showOpenFilePicker" in window){
        fileHandles = await window.showOpenFilePicker({
          multiple: true
        }).catch(error => {
          if (error.message.toLowerCase().includes("abort")) return;
        });
      } else if ("chooseFileSystemEntries" in window){
        fileHandles = await window.chooseFileSystemEntries({
          type: "open-file",
          multiple: true
        }).catch(error => {
          if (error.message.toLowerCase().includes("abort")) return;
        });
      }
      if (fileHandles) fileHandles.forEach(async fileHandle => {
        var file = await fileHandle.getFile(), identifier = createFile(await file.name,await file.text());
        Editor.file_handles[identifier] = await fileHandle;
      });
    }
  }
  async function saveFile(extension){
    if (!Editor.support.file_system || extension){
      var blob = new Blob([Editor.query().textarea.value],{
        type: "text/plain"
      }), save = document.createElement("a");
      save.href = window.URL.createObjectURL(blob);
      if (!extension){
        save.download = Editor.query().name();
      } else save.download = `${Editor.query().name("name")}.${extension}`;
      save.click();
    } else {
      var identifier = Editor.query().tab.getAttribute("data-identifier"), fileHandle;
      if (!Editor.file_handles[identifier]){
        if ("showOpenFilePicker" in window){
          fileHandle = await window.showSaveFilePicker().catch(error => {
            if (error.message.toLowerCase().includes("abort")) return;
          });
        } else if ("chooseFileSystemEntries" in window){
          fileHandle = await window.chooseFileSystemEntries().catch(error => {
            if (error.message.toLowerCase().includes("abort")) return;
          });
        }
        if (!fileHandle) return;
        Editor.file_handles[identifier] = await fileHandle;
      } else fileHandle = Editor.file_handles[identifier];
      var writable = await Editor.file_handles[identifier].createWritable().catch(error => alert(`"${Editor.query().name()}" could not be saved.`));
      if (!writable) return;
      await writable.write(Editor.query().textarea.value);
      await writable.close();
      var file = await fileHandle.getFile(), fileName = await file.name, tab = Editor.query(identifier).tab;
      tab.querySelector("[data-file-name]").innerText = fileName;
      if (tab == Editor.query().tab) titleRefresh(fileName);
    }
    Editor.query().tab.removeAttribute("data-unsaved");
    forceRefresh();
  }
  function openDisplay(){
    var windowFeatures = "";
    if (Editor.appearance().standalone || Editor.appearance().fullscreen) windowFeatures = "popup";
    var display = window.open("","_blank",windowFeatures);
    if (Editor.appearance().standalone || Editor.appearance().fullscreen){
      display.resizeTo(window.screen.width * 2/3,window.screen.height * 2/3);
      display.moveTo(window.screen.width / 6,window.screen.height / 6);
    }
    display.document.open();
    display.document.write(Editor.query().textarea.value);
    display.document.close();
  }
  function textEdit(type,text){
    var textarea = Editor.query().textarea, cursor = textarea.selectionStart;
    textarea.focus();
    if (type == "insert"){
      textarea.setRangeText(text);
      textarea.setSelectionRange(cursor,cursor + text.length);
    }
    if (type == "delete"){
      textarea.setSelectionRange(cursor,cursor + text);
      textarea.setRangeText("");
    }
    textarea.num_refreshLineCount();
    sourceChange = true;
    Editor.query().tab.setAttribute("data-unsaved",true);
    refreshPreview();
  }
  function openCard(card,previous){
    if (!card) return;
    if (card.classList.contains("active")) return closeCard(card);
    var cardType = card.classList[1];
    if (cardType != "alert"){
      var activeCards = document.querySelectorAll(".card.active");
      activeCards.forEach(activeCard => {
        var activeCardType = activeCard.classList[1];
        if (activeCardType != cardType && activeCardType != "dialog") return;
        activeCard.classList.remove("active");
        if (!activeCard.classList.contains("minimize")) return;
        var transitionDuration = parseInt(getElementStyle(activeCard,"transition-duration").replace(/s/g,"") * 1000);
        window.setTimeout(() => minimizeCard(activeCard),transitionDuration);
      });
    }
    card.classList.add("active");
    if (cardType != ("alert" || "dialog")) card_backdrop.classList.remove("active");
    if (cardType == "alert") window.setTimeout(() => closeCard(card),4000);
    if (card == editing_tools_card) Editor.active_editing_tools = true;
    if (cardType == "dialog"){
      document.body.addEventListener("keydown",catchCardNavigation);
      card_backdrop.classList.add("active");
      if (!Editor.active_dialog && !Editor.dialog_previous){
        var menuChild = (document.activeElement.closest(".menu"));
        if (menuChild){
          Editor.dialog_previous = document.activeElement.closest(".menu").querySelector("button");
        } else Editor.dialog_previous = document.activeElement;
      }
      var activeMenus = document.querySelectorAll(".menu.active");
      activeMenus.forEach(activeMenu => {
        if (activeMenu == context_menu){
          closeContextMenu();
        } else closeMenu(activeMenu);
      });
      var transitionDuration = parseInt(getElementStyle(card,"transition-duration").replace(/s/g,"") * 500);
      window.setTimeout(() => {
        document.activeElement.blur();
        var previousElement = card.querySelector(`[data-previous-card="${previous}"]`);
        if (previousElement) previousElement.focus();
      },transitionDuration);
      Editor.active_dialog = card;
    }
    if (cardType == "widget") Editor.active_widget = card;
    setFilesSectionOffset();
  }
  function closeCard(card){
    if (!card) return;
    var cardType = card.classList[1];
    card.classList.remove("active");
    if (card.classList.contains("minimize")){
      var transitionDuration = parseInt(getElementStyle(card,"transition-duration").replace(/s/g,"") * 1000);
      window.setTimeout(() => minimizeCard(card),transitionDuration);
    }
    if (cardType == "dialog"){
      document.body.removeEventListener("keydown",catchCardNavigation);
      card_backdrop.classList.remove("active");
      Editor.active_dialog = false;
      if (Editor.dialog_previous){
        if (workspace.contains(Editor.dialog_previous) && getElementStyle(Editor.dialog_previous,"visibility") == "hidden"){
          Editor.query().textarea.focus();
        } else Editor.dialog_previous.focus();
        Editor.dialog_previous = null;
      }
    }
    if (card == editing_tools_card) Editor.active_editing_tools = false;
    if (cardType == "widget") Editor.active_widget = false;
    if (card == settings_card) loadSettings();
    if (card == theme_card) loadTheme();
    setFilesSectionOffset();
  }
  function minimizeCard(card){
    card.classList.toggle("minimize");
    var minimizeButton = card.querySelector(".header .card-controls [data-control='minimize']");
    var minimizeButtonIcon = minimizeButton.querySelector("svg");
    var minimizeButtonIconLink = minimizeButtonIcon.querySelector("use");
    var transitionDuration = parseInt(getElementStyle(minimizeButtonIcon,"transition-duration").replace(/s/g,"") * 275);
    if (!card.classList.contains("minimize")){
      window.setTimeout(() => {
        minimizeButton.setAttribute("aria-label","Minimize");
        minimizeButtonIconLink.setAttribute("href","#minimize_icon");
      },transitionDuration);
    } else {
      if (card.contains(document.activeElement) && document.activeElement != minimizeButton) minimizeButton.focus();
      window.setTimeout(() => {
        minimizeButton.setAttribute("aria-label","Maximize");
        minimizeButtonIconLink.setAttribute("href","#arrow_icon");
      },transitionDuration);
    }
    setFilesSectionOffset();
  }
  function catchCardNavigation(event){
    if (!Editor.active_dialog || context_menu.classList.contains("active") || event.key != "Tab" || document.activeElement != document.body) return;
    var navigable = getNavigableElements(Editor.active_dialog);
    if (event.shiftKey){
      event.preventDefault();
      navigable[navigable.length - 1].focus();
    } else {
      event.preventDefault();
      navigable[0].focus();
    }
  }
  function openMenu(event,menu){
    if (Editor.long_touch.timeout) Editor.long_touch.timeout = null;
    if (Editor.long_touch.selection) Editor.long_touch.selection = null;
    var currentMenu;
    if (!menu){
      currentMenu = event;
    } else currentMenu = menu;
    menus.forEach(menu => {
      if (menu != currentMenu && !menu.contains(event.target)) closeMenu(menu);
    });
    currentMenu.classList.toggle("active");
    if (currentMenu.classList.contains("active")){
      document.body.addEventListener("click",catchMenuExit);
      if (currentMenu == context_menu) document.body.addEventListener("contextmenu",catchMenuExit);
    } else {
      document.body.removeEventListener("click",catchMenuExit);
      if (currentMenu == context_menu) document.body.removeEventListener("contextmenu",catchMenuExit);
    }
    function catchMenuExit(){
      if (currentMenu.contains(document.activeElement)) return;
      closeMenu(currentMenu);
      document.body.removeEventListener("click",catchMenuExit);
      if (currentMenu == context_menu) document.body.removeEventListener("contextmenu",catchMenuExit);
    }
  }
  function closeMenu(menu){
    var submenus = menu.querySelectorAll("li > ul");
    submenus.forEach(submenu => submenu.parentElement.classList.remove("active"));
    menu.classList.remove("active");
    if (menu != context_menu) return;
    var menu = menu.querySelectorAll("ul")[0], transitionDuration = parseInt(getElementStyle(menu,"transition-duration").replace(/s/g,"") * 1000);
    window.setTimeout(() => {
      var types = ["window","link","editing"];
      types.forEach(type => {
        if (menu.classList.contains(type)) menu.classList.remove(type);
      });
    },transitionDuration);
  }
  function openContextMenu(event,type){
    event.preventDefault();
    event.stopPropagation();
    if (Editor.long_touch.timeout) Editor.long_touch.timeout = null;
    if (context_menu.classList.contains("active")){
      closeContextMenu();
      var menu = context_menu.querySelectorAll("ul")[0], transitionDuration = parseInt(getElementStyle(menu,"transition-duration").replace(/s/g,"") * 1000);
      return window.setTimeout(() => openContextMenu(event,type),transitionDuration);
    }
    Editor.context_menu_previous = event.target;
    openMenu(event,context_menu);
    context_menu.classList.add(type);
    var pageLocation = {}, transformOrigin = {};
    if (Editor.environment.touch_device && event instanceof TouchEvent){
      pageLocation.left = event.touches[0].pageX;
      pageLocation.top = event.touches[0].pageY;
    } else {
      pageLocation.left = event.pageX;
      pageLocation.top = event.pageY;
    }
    transformOrigin.left = pageLocation.left;
    transformOrigin.top = pageLocation.top;
    var menu = context_menu.querySelectorAll("ul")[0];
    if (pageLocation.left + menu.offsetWidth > window.innerWidth) pageLocation.left = window.innerWidth - menu.offsetWidth;
    if (pageLocation.top + menu.offsetHeight > window.innerHeight) pageLocation.top = window.innerHeight - menu.offsetHeight;
    transformOrigin.left -= pageLocation.left;
    transformOrigin.top -= pageLocation.top;
    context_menu.style.left = `${pageLocation.left}px`;
    context_menu.style.top = `${pageLocation.top}px`;
    menu.style.transformOrigin = `${transformOrigin.left}px ${transformOrigin.top}px`;
    document.body.addEventListener("keydown",catchContextMenuNavigation);
    var transitionDuration = parseInt(getElementStyle(menu,"transition-duration").replace(/s/g,"") * 500);
    window.setTimeout(() => document.activeElement.blur(),transitionDuration);
  }
  function closeContextMenu(){
    closeMenu(context_menu);
    Editor.context_menu_previous.focus();
    Editor.context_menu_previous = null;
    document.body.removeEventListener("keydown",catchContextMenuNavigation);
  }
  function catchContextMenuNavigation(event){
    event.stopPropagation();
    if (!context_menu.classList.contains("active") || document.activeElement != document.body) return;
    var navigable = getNavigableElements(context_menu);
    if (event.key == "Tab") event.preventDefault();
    if (event.key == "ArrowUp"){
      event.preventDefault();
      navigable[navigable.length - 1].focus();
    }
    if (event.key == "ArrowDown"){
      event.preventDefault();
      navigable[0].focus();
    }
  }
  function cancelLongTouch(){
    if (Editor.long_touch.timeout) window.clearTimeout(Editor.long_touch.timeout);
    if (Editor.long_touch.selection) Editor.long_touch.selection = null;
  }
  async function callCommand(element,action){
    element.focus();
    if (action == "paste"){
      var clipboardText = await navigator.clipboard.readText().catch(error => alert("Clipboard text could not be read, please check site permissions for clipboard use."));
      document.execCommand("insertText",false,await clipboardText);
    } else document.execCommand(action);
    if ((action == "undo" || action == "redo" || action == "paste") && element.parentElement.hasAttribute("data-numbered-container")) element.num_refreshLineCount();
  }
  function activateReplacer(){
    Editor.query().textarea.num_changeValue(Editor.query().textarea.value.split(replacer_find.value).join(replacer_replace.value));
    sourceChange = true;
    Editor.query().tab.setAttribute("data-unsaved",true);
    refreshPreview();
  }
  function flipReplacer(){
    var findContent = replacer_find.value;
    replacer_find.num_changeValue(replacer_replace.value);
    replacer_replace.num_changeValue(findContent);
  }
  function clearReplacer(){
    replacer_find.num_changeValue("");
    replacer_replace.num_changeValue("");
  }
  function pickerInputRefresh(){
    var get = picker_input.value.replace("#","");
    if (!(get.length == 3 || get.length == 6)) return;
    Editor.picker_color = get;
    if (Editor.picker_color.length == 3){
      Editor.picker_color = Editor.picker_color.match(/.{1}/g);
      Editor.picker_color.forEach((item,index) => Editor.picker_color[index] = item + item);
    }
    if (Editor.picker_color.length == 6) Editor.picker_color = Editor.picker_color.match(/.{1,2}/g);
    Editor.picker_color.forEach((item,index) => Editor.picker_color[index] = parseInt(item,16));
    red_channel.value = Editor.picker_color[0];
    green_channel.value = Editor.picker_color[1];
    blue_channel.value = Editor.picker_color[2];
    Editor.picker_color = `#${convertHex(red_channel.value)}${convertHex(green_channel.value)}${convertHex(blue_channel.value)}`;
    picker_preview.style.background = Editor.picker_color;
  }
  function channelRefresh(){
    Editor.picker_color = `#${convertHex(red_channel.value)}${convertHex(green_channel.value)}${convertHex(blue_channel.value)}`;
    picker_preview.style.background = Editor.picker_color;
    picker_input.value = Editor.picker_color;
    if (Editor.insert_color) textEdit("insert",Editor.picker_color);
  }
  function convertHex(channel){
    var hex = parseInt(channel).toString(16);
    if (hex.length == 1) hex = `0${hex}`;
    return hex;
  }
  function importColor(){
    Editor.insert_color = true;
    if (!picker.classList.contains("active")) openCard(picker_card);
    if (window.getSelection() == "") return;
    picker_input.value = window.getSelection();
    picker_input.focus();
    pickerInputRefresh();
  }
  function copyPicker(){
    picker_input.select();
    document.execCommand("copy");
  }
  function insertPicker(){
    textEdit("insert",Editor.picker_color);
    channelRefresh();
    Editor.insert_color = true;
  }
  function deletePicker(){
    var selectionCount = Editor.query().textarea.selectionEnd - Editor.query().textarea.selectionStart;
    if (selectionCount) textEdit("delete",selectionCount);
    Editor.insert_color = false;
  }
  function activateFormatter(format){
    try {
      formatter_input.num_changeValue(JSON.stringify(JSON.parse(formatter_input.value),false,format));
    } catch (error){
      alert("Invalid JSON data.");
    }
  }
  function activateEncoder(encode){
    if (component_setting.checked){
      if (encode) encoder_input.num_changeValue(encodeURIComponent(encoder_input.value));
      if (!encode) encoder_input.num_changeValue(decodeURIComponent(encoder_input.value));
    } else {
      if (encode) encoder_input.num_changeValue(encodeURI(encoder_input.value));
      if (!encode) encoder_input.num_changeValue(decodeURI(encoder_input.value));
    }
  }
  function insertTemplate(){
    Editor.query().textarea.num_changeValue(decodeURI("%3C!DOCTYPE%20html%3E%0A%3Chtml%20lang=%22en-US%22%3E%0A%0A%3Chead%3E%0A%0A%3Ctitle%3E%3C/title%3E%0A%3Cmeta%20charset=%22UTF-8%22%3E%0A%3Cmeta%20name=%22viewport%22%20content=%22width=device-width,%20initial-scale=1%22%3E%0A%0A%3Cstyle%3E%0A%20%20*,%20*::before,%20*::after%20%7B%0A%20%20%20%20box-sizing:%20border-box;%0A%20%20%20%20font-family:%20sans-serif;%0A%20%20%7D%0A%3C/style%3E%0A%0A%3C/head%3E%0A%0A%3Cbody%3E%0A%0A%3Cscript%3E%0A%3C/script%3E%0A%0A%3C/body%3E%0A%0A%3C/html%3E"));
    sourceChange = true;
    if (Editor.view() == "preview") changeView("split");
  }
  function forceRefresh(){
    var currentSetting = Editor.refresh;
    Editor.refresh = "true";
    sourceChange = true;
    preview.contentWindow.location.reload();
    refreshPreview();
    Editor.refresh = currentSetting;
  }
  function refreshPreview(){
    if (Editor.refresh != "true" || !sourceChange) return;
    preview.src = "about:blank";
    preview.contentWindow.document.open();
    var sourceEditor;
    if (!Editor.preview_editor){
      sourceEditor = Editor.query().textarea;
    } else sourceEditor = Editor.query(Editor.preview_editor).textarea;
    preview.contentWindow.document.write(sourceEditor.value);
    preview.contentWindow.document.close();
    sourceChange = false;
  }
  function toggleScaling(){
    document.body.classList.toggle("scaling-active");
  }
  function setScaling(event){
    var scalingOffset, scalingRange = {};
    if (Editor.environment.touch_device && event instanceof TouchEvent){
      if (Editor.orientation() == "horizontal") scalingOffset = event.touches[0].pageX;
      if (Editor.orientation() == "vertical") scalingOffset = event.touches[0].pageY - header.offsetHeight;
    } else {
      if (Editor.orientation() == "horizontal") scalingOffset = event.pageX;
      if (Editor.orientation() == "vertical") scalingOffset = event.pageY - header.offsetHeight;
    }
    if (Editor.orientation() == "horizontal"){
      scalingRange.minimum = 80;
      scalingRange.maximum = window.innerWidth - 80;
    }
    if (Editor.orientation() == "vertical"){
      scalingRange.minimum = files.offsetHeight + 80;
      scalingRange.maximum = window.innerHeight - header.offsetHeight - 80;
    }
    if (scalingOffset < scalingRange.minimum) scalingOffset = scalingRange.minimum;
    if (scalingOffset > scalingRange.maximum) scalingOffset = scalingRange.maximum;
    document.body.setAttribute("data-scaling-offset",scalingOffset);
    document.body.style.setProperty("--scaling-offset",`${scalingOffset}px`);
    if (Editor.orientation() == "horizontal") setFilesSectionOffset();
  }
  function disableScaling(event){
    if (Editor.environment.touch_device && event instanceof TouchEvent){
      document.removeEventListener("touchmove",setScaling);
      document.removeEventListener("touchend",disableScaling);
      toggleScaling();
    } else {
      document.removeEventListener("mousemove",setScaling);
      document.removeEventListener("mouseup",disableScaling);
      toggleScaling();
    }
  }
  function removeScaling(){
    if (!document.body.hasAttribute("data-scaling-offset")) return;
    document.body.removeAttribute("data-scaling-offset");
    document.body.style.removeProperty("--scaling-offset");
  }
</script>

</body>

</html>